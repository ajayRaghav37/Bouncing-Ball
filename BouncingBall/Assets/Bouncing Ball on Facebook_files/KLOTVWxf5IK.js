/*1352802289,173217837*/

if (self.CavalryLogger) { CavalryLogger.start_js(["XQYFa"]); }

__d("ActiveXSupport",[],function(a,b,c,d,e,f){var g=null,h={isSupported:function(){if(g!==null)return g;try{g=!!window.ActiveXObject&&!!new ActiveXObject("htmlfile");}catch(i){g=false;}return g;}};e.exports=h;});
__d("FileInput",["event-extensions","ArbiterMixin","CSS","DOM","UserAgent","copyProperties","cx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('CSS'),i=b('DOM'),j=b('UserAgent'),k=b('copyProperties'),l=b('cx'),m=j.ie();function n(o,p,q){this.container=o;this.control=p;this.input=q;var r=i.scry(this.container,'a')[0];r&&r.removeAttribute('href');var s=i.create('div',{className:"_3jk"},this.input);i.appendContent(this.control,s);this._initListeners();}k(n.prototype,g,{getValue:function(){return this.input.value;},getInput:function(){return this.input;},clear:function(){if(m){var o=i.deepClone(this.input);i.replace(this.input,o);this.input=o;while(this._listeners.length)this._listeners.pop().remove();this._initListeners();}else{this.input.value='';this.input.files=null;}},_initListeners:function(){this._listeners=[Event.listen(this.input,'change',m===7?this._handleChangeInIE7.bind(this):this._handleChange.bind(this)),Event.listen(this.input,'focus',this._handleFocusChange.bind(this)),Event.listen(this.input,'blur',this._handleFocusChange.bind(this))];},_handleChangeInIE7:function(event){if(this._blurring){this._blurring=false;return;}this._handleChange(event);(function(){this._blurring=true;this.input.blur();}).bind(this).defer();},_handleChange:function(event){this.inform('change',event);var o=this.input.form;if(o&&m<9)Event.fire(o,'change',event);},_handleFocusChange:function(event){h.conditionClass(this.control,"_3t8",event.type==='focus');}});e.exports=n;});
__d("LinkshimHandler",["event-extensions","LinkshimAsyncLink","URI","LinkshimHandlerConfig"],function(a,b,c,d,e,f){b('event-extensions');var g=b('LinkshimAsyncLink'),h=b('URI'),i=c('LinkshimHandlerConfig'),j={setUpLinkshimHandling:function(p){var q=h(p.getAttribute('href')),r=k(q);if(r&&l(q)){Event.listen(p,'mouseover',g.swap.shield(null,p,r));var s=n(q);Event.listen(p,'click',function(){if(i.supports_meta_referrer){g.referrer_log(p,s,m(q).toString());}else g.swap(p,q);});}}};function k(p){return p.getQueryData().u?new h(p.getQueryData().u):null;}function l(p){return p.getQueryData().hasOwnProperty('s');}function m(p){return h('/si/ajax/l/render_linkshim_log/').setSubdomain('www').setQueryData(p.getQueryData());}function n(p){var q;if(o()){q=h(p).addQueryData({render_verification:true});}else q=k(p);return q;}function o(){var p=i.render_verification_rate||0;return Math.floor(Math.random()*p+1)===p;}e.exports=j;});
__d("TypingDetector",["event-extensions","function-extensions","ArbiterMixin","Class","Input","Run","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('Input'),j=b('Run'),k=b('copyProperties'),l=b('createObjectFrom'),m=b('emptyFunction');function n(o){this._input=o;this._ignoreKeys={};}n.INACTIVE=0;n.TYPING=1;n.QUITTING=2;k(n.prototype,g,{_timeout:7000,_currentState:n.INACTIVE,init:function(){this.init=m;this.reset();Event.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=n.INACTIVE;},setIgnoreKeys:function(o){this._ignoreKeys=l(o);},_onunload:function(){if(this._currentState==n.TYPING)this._transition(n.QUITTING);},_update:function(event){var o=Event.getKeyCode(event),p=this._currentState;if(!this._ignoreKeys[o])if(i.getValue(this._input).trim().length===0){if(p==n.TYPING)this._transition(n.INACTIVE);}else if(p==n.TYPING){this._recordKeystroke();}else if(p==n.INACTIVE){this._transition(n.TYPING);this._recordKeystroke();}},_transition:function(o){this.reset();this._currentState=o;this.inform('change',o);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=this._checkTyping.bind(this).defer(this._timeout);},_checkTyping:function(){var o=this._lastKeystrokeTime+this._timeout,p=Date.now();if(p>o){this._transition(n.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=this._checkTyping.bind(this).defer(o-p+10);}}});e.exports=n;});
__d("GenderConst",[],function(a,b,c,d,e,f){var g={UNKNOWN:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11};e.exports=g;});
__d("Encoding",[],function(a,b,c,d,e,f){var g={toBytes:function(n){for(var o=[],p=0;p<n.length;p++)o.push(n.charCodeAt(p)&255);return o;},fromBytes:function(n){for(var o=[],p=0;p<n.length;p++)o.push(String.fromCharCode(n[p]));return o.join("");}},h={toBytes:function(n){return g.toBytes(window.unescape(encodeURIComponent(n)));},fromBytes:function(n){return decodeURIComponent(window.escape(g.fromBytes(n)));}},i={toBytes:function(n){for(var o=[],p=0;p<n.length*32;p+=8)o.push((n[p>>>5]>>>(24-p%32))&255);return o;},fromBytes:function(n){for(var o=[],p=0,q=0;p<n.length;p++,q+=8)o[q>>>5]|=(n[p]&255)<<(24-q%32);return o;}},j={fromBytes:function(n){for(var o=[],p=0;p<n.length;p++){o.push((n[p]>>>4).toString(16));o.push((n[p]&15).toString(16));}return o.join("");},toBytes:function(n){for(var o=[],p=0;p<n.length;p+=2)o.push(parseInt(n.substr(p,2),16));return o;}},k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l={toBytes:function(n){if(typeof window.atob=="function")return g.toBytes(window.atob(n));n=n.replace(/[^A-Z0-9+\/]/ig,"");for(var o=[],p=0,q=0;p<n.length;q=++p%4){if(q===0)continue;o.push(((k.indexOf(n.charAt(p-1))&(Math.pow(2,-2*q+8)-1))<<(q*2))|(k.indexOf(n.charAt(p))>>>(6-q*2)));}return o;},fromBytes:function(n){if(typeof window.btoa=="function")return window.btoa(g.fromBytes(n));for(var o=[],p=0;p<n.length;p+=3){var q=(n[p]<<16)|(n[p+1]<<8)|n[p+2];for(var r=0;r<4;r++)if(p*8+r*6<=n.length*8){o.push(k.charAt((q>>>6*(3-r))&63));}else o.push("=");}return o.join("");}},m={UTF8:h,binary:g,words:i,hex:j,base64:l};e.exports=m;});
__d("CryptoUtil",[],function(a,b,c,d,e,f){var g={rotl:function(h,i){return (h<<i)|(h>>>(32-i));},rotr:function(h,i){return (h<<(32-i))|(h>>>i);},endian:function(h){if(h.constructor==Number)return g.rotl(h,8)&16711935|g.rotl(h,24)&4278255360;for(var i=0;i<h.length;i++)h[i]=g.endian(h[i]);return h;},randomBytes:function(h){for(var i=[];h>0;h--)i.push(Math.floor(Math.random()*256));return i;}};e.exports=g;});
__d("md5",["Encoding","CryptoUtil"],function(a,b,c,d,e,f){var g=b('Encoding'),h=b('CryptoUtil');function i(o,p,q,r,s,t,u){var v=o+(p&q|~p&r)+(s>>>0)+u;return ((v<<t)|(v>>>(32-t)))+p;}function j(o,p,q,r,s,t,u){var v=o+(p&r|q&~r)+(s>>>0)+u;return ((v<<t)|(v>>>(32-t)))+p;}function k(o,p,q,r,s,t,u){var v=o+(p^q^r)+(s>>>0)+u;return ((v<<t)|(v>>>(32-t)))+p;}function l(o,p,q,r,s,t,u){var v=o+(q^(p|~r))+(s>>>0)+u;return ((v<<t)|(v>>>(32-t)))+p;}function m(o){var p;if(o.constructor==String)o=g.UTF8.toBytes(o);var q=g.words.fromBytes(o),r=o.length*8,s=1732584193,t=-271733879,u=-1732584194,v=271733878;for(p=0;p<q.length;p++)q[p]=((q[p]<<8)|(q[p]>>>24))&16711935|((q[p]<<24)|(q[p]>>>8))&4278255360;q[r>>>5]|=128<<(r%32);q[(((r+64)>>>9)<<4)+14]=r;var w=i,x=j,y=k,z=l;for(p=0;p<q.length;p+=16){var aa=s,ba=t,ca=u,da=v;s=w(s,t,u,v,q[p+0],7,-680876936);v=w(v,s,t,u,q[p+1],12,-389564586);u=w(u,v,s,t,q[p+2],17,606105819);t=w(t,u,v,s,q[p+3],22,-1044525330);s=w(s,t,u,v,q[p+4],7,-176418897);v=w(v,s,t,u,q[p+5],12,1200080426);u=w(u,v,s,t,q[p+6],17,-1473231341);t=w(t,u,v,s,q[p+7],22,-45705983);s=w(s,t,u,v,q[p+8],7,1770035416);v=w(v,s,t,u,q[p+9],12,-1958414417);u=w(u,v,s,t,q[p+10],17,-42063);t=w(t,u,v,s,q[p+11],22,-1990404162);s=w(s,t,u,v,q[p+12],7,1804603682);v=w(v,s,t,u,q[p+13],12,-40341101);u=w(u,v,s,t,q[p+14],17,-1502002290);t=w(t,u,v,s,q[p+15],22,1236535329);s=x(s,t,u,v,q[p+1],5,-165796510);v=x(v,s,t,u,q[p+6],9,-1069501632);u=x(u,v,s,t,q[p+11],14,643717713);t=x(t,u,v,s,q[p+0],20,-373897302);s=x(s,t,u,v,q[p+5],5,-701558691);v=x(v,s,t,u,q[p+10],9,38016083);u=x(u,v,s,t,q[p+15],14,-660478335);t=x(t,u,v,s,q[p+4],20,-405537848);s=x(s,t,u,v,q[p+9],5,568446438);v=x(v,s,t,u,q[p+14],9,-1019803690);u=x(u,v,s,t,q[p+3],14,-187363961);t=x(t,u,v,s,q[p+8],20,1163531501);s=x(s,t,u,v,q[p+13],5,-1444681467);v=x(v,s,t,u,q[p+2],9,-51403784);u=x(u,v,s,t,q[p+7],14,1735328473);t=x(t,u,v,s,q[p+12],20,-1926607734);s=y(s,t,u,v,q[p+5],4,-378558);v=y(v,s,t,u,q[p+8],11,-2022574463);u=y(u,v,s,t,q[p+11],16,1839030562);t=y(t,u,v,s,q[p+14],23,-35309556);s=y(s,t,u,v,q[p+1],4,-1530992060);v=y(v,s,t,u,q[p+4],11,1272893353);u=y(u,v,s,t,q[p+7],16,-155497632);t=y(t,u,v,s,q[p+10],23,-1094730640);s=y(s,t,u,v,q[p+13],4,681279174);v=y(v,s,t,u,q[p+0],11,-358537222);u=y(u,v,s,t,q[p+3],16,-722521979);t=y(t,u,v,s,q[p+6],23,76029189);s=y(s,t,u,v,q[p+9],4,-640364487);v=y(v,s,t,u,q[p+12],11,-421815835);u=y(u,v,s,t,q[p+15],16,530742520);t=y(t,u,v,s,q[p+2],23,-995338651);s=z(s,t,u,v,q[p+0],6,-198630844);v=z(v,s,t,u,q[p+7],10,1126891415);u=z(u,v,s,t,q[p+14],15,-1416354905);t=z(t,u,v,s,q[p+5],21,-57434055);s=z(s,t,u,v,q[p+12],6,1700485571);v=z(v,s,t,u,q[p+3],10,-1894986606);u=z(u,v,s,t,q[p+10],15,-1051523);t=z(t,u,v,s,q[p+1],21,-2054922799);s=z(s,t,u,v,q[p+8],6,1873313359);v=z(v,s,t,u,q[p+15],10,-30611744);u=z(u,v,s,t,q[p+6],15,-1560198380);t=z(t,u,v,s,q[p+13],21,1309151649);s=z(s,t,u,v,q[p+4],6,-145523070);v=z(v,s,t,u,q[p+11],10,-1120210379);u=z(u,v,s,t,q[p+2],15,718787259);t=z(t,u,v,s,q[p+9],21,-343485551);s=(s+aa)>>>0;t=(t+ba)>>>0;u=(u+ca)>>>0;v=(v+da)>>>0;}return h.endian([s,t,u,v]);}function n(o){if(null===o||undefined===o)return null;var p=g.words.toBytes(m(o));return g.hex.fromBytes(p);}e.exports=n;});
__d("Dock",["event-extensions","function-extensions","Arbiter","ArbiterMixin","ChatQuietLinks","CSS","DataStore","DOM","Parent","Style","Toggler","Vector","copyProperties","emptyFunction","ge"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatQuietLinks'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Parent'),n=b('Style'),o=b('Toggler'),p=b('Vector'),q=b('copyProperties'),r=b('emptyFunction'),s=b('ge');function t(){}q(t,h,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(u){this.init=r;this.rootEl=u;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();i.removeEmptyHrefs(this.rootEl);Event.listen(u,'click',this._onClick.bind(this));Event.listen(window,'resize',this._onWindowResize.bind(this));o.subscribe(['show','hide'],function(v,w){var x=w.getActive();if(!l.contains(u,x))return;if(j.hasClass(x,'fbNub')){this.notifyNub(x,v);if(v==='show')this._resizeNubFlyout(x);}else{var y=m.byClass(x,'fbNubFlyout');if(y)j.conditionClass(y,'menuOpened',v==='show');}}.bind(this));this.inform('init',{},g.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=p.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+p.getElementDimensions(this.rootEl).y;var u=s('blueBar');if(u){var v=n.isFixed(u)?'viewport':'document';this.flyoutHeightOffset+=p.getElementPosition(u,v).y+p.getElementDimensions(u).y;}},toggle:function(u){var v=this._findFlyout(u);if(!v)return;this.subscribe('init',function(){o.toggle(u);});},show:function(u){this.subscribe('init',function(){o.show(u);});},showNub:function(u){j.show(u);},hide:function(u){this.subscribe('init',function(){var v=o.getInstance(u);l.contains(u,v.getActive())&&v.hide();});},hideNub:function(u){j.hide(u);this.hide(u);},setUseMaxHeight:function(u,v){j.conditionClass(u,'maxHeight',v!==false);this._resizeNubFlyout(u);},_resizeNubFlyout:function(u){var v=this._findFlyout(u);if(!v||!(j.hasClass(u,'openToggler')||j.hasClass(u,'opened')))return;var w=l.find(v,'div.fbNubFlyoutOuter'),x=l.find(w,'div.fbNubFlyoutInner'),y=l.find(x,'div.fbNubFlyoutBody'),z=y.scrollTop,aa=y.offsetHeight;n.set(y,'height','auto');var ba=p.getElementPosition(v,'viewport'),ca=p.getElementDimensions(v),da=p.getElementDimensions(y),ea=this.getMaxFlyoutHeight(u);n.set(v,'max-height',ea+'px');n.set(w,'max-height',ea+'px');ca=p.getElementDimensions(v);var fa=p.getElementDimensions(x),ga=fa.y-da.y;if(ca.y>ga)n.set(y,'height',(ca.y-ga)+'px');j.removeClass(v,'swapDirection');var ha=p.getElementPosition(v).x;j.conditionClass(v,'swapDirection',function(){if(ha<0)return true;return (ha+ca.x>this.viewportDimensions.x);}.bind(this)());if(z+aa>=da.y){y.scrollTop=y.scrollHeight;}else y.scrollTop=z;this.notifyNub(u,'resize');},getMaxFlyoutHeight:function(u){var v=this._findFlyout(u),w=p.getElementPosition(v,'viewport'),x=p.getElementDimensions(v),y=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-w.y-x.y);return Math.max(y,0);},resizeAllFlyouts:function(){var u=l.scry(this.rootEl,'div.fbNub.openToggler');u=u.concat(l.scry(this.rootEl,'div.fbNub.opened'));var v=u.length;while(v--)this._resizeNubFlyout(u[v]);},_onClick:function(event){var u=event.getTarget(),v=m.byClass(u,'fbNub');if(v){if(m.byClass(u,'fbNubFlyoutTitlebar')){var w=m.byTag(u,'a');if(!w){this.hide(v);return false;}}this.notifyNub(v,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(u){return j.hasClass(u,'fbNubFlyout')?u:l.scry(u,'div.fbNubFlyout')[0]||null;},registerNubController:function(u,v){k.set(u,'dock:nub:controller',v);v.subscribe('nub/button/content-changed',this.inform.shield(this,'resize',u));v.subscribe('nub/flyout/content-changed',this._resizeNubFlyout.shield(this,u));},unregisterNubController:function(u){k.remove(u,'dock:nub:controller');},notifyNub:function(u,v,w){var x=k.get(u,'dock:nub:controller');x&&x.inform(v,w);}});e.exports=a.Dock||t;});
__d("NubController",["ArbiterMixin","Class","Dock","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('Class'),i=b('Dock'),j=b('copyProperties');function k(){}j(k.prototype,g,{init:function(l){this.el=l;i.registerNubController(l,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){i.hide(this.el);},show:function(){i.show(this.el);}});e.exports=k;});
__d("DropdownContextualHelpLink",["copyProperties","DOM","ge"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('DOM'),i=b('ge'),j={set:function(k){var l=i('navHelpCenter');if(l!==null)h.replace(l,k);}};e.exports=j;});
__d("isRTL",[],function(a,b,c,d,e,f){var g='A-Za-z\xC0-\xD6\xD8-\xF6\xF8-\u02B8\u0300-\u0590\u0800-\u1FFF'+'\u200E\u2C00-\uFB1C\uFE00-\uFE6F\uFEFD-\uFFFF',h='\u0591-\u07FF\u200F\uFB1D-\uFDFF\uFE70-\uFEFC',i=new RegExp('^[^'+g+']*['+h+']'),j=new RegExp('['+g+']');function k(l){var m=0,n=0;l.split(/\s+/,20).forEach(function(o){if(/^https?:\/\//.test(o))return;if(i.test(o)){n++;m++;}else if(j.test(o))m++;});return !!(m&&(n/m>.4));}e.exports=k;});
__d("IntlDateFormats",[],function(a,b,c,d,e,f){var g={},h={setFormats:function(i,j){g=j;},getFormat:function(i){if(!(i in g))return i;return g[i];}};e.exports=h;});
__d("date-extensions",["IntlDateFormats","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('IntlDateFormats'),h=b('copyProperties'),i=b('tx'),j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=["January","February","March","April","May","June","July","August","September","October","November","December"];function n(o,p){p=p||2;o=''+o;while(o.length<p)o='0'+o;return o;}Date.format=function(o,p,q){var r=p?new Date(p*1000):new Date();return r.format(o,q);};h(Date.prototype,{format:function(o,p){if(!o)return '';var q=[],r=null,s=null,t=(p?'getUTC':'get'),u=this[t+'Date'](),v=this[t+'Day'](),w=this[t+'Month'](),x=this[t+'FullYear'](),y=this[t+'Hours'](),z=this[t+'Minutes'](),aa=this[t+'Seconds'](),ba=this[t+'Milliseconds']();for(var ca=0;ca<o.length;ca++){s=o.charAt(ca);if(s=='\\'){ca++;q.push(o.charAt(ca));continue;}switch(s){case 'd':r=n(u);break;case 'D':r=j[v];break;case 'j':r=u;break;case 'l':r=k[v];break;case 'F':r=m[w];break;case 'm':r=n(w+1);break;case 'M':r=l[w];break;case 'n':r=w+1;break;case 'Y':r=x;break;case 'y':r=(''+x).slice(2);break;case 'a':r=y<12?'am':'pm';break;case 'A':r=y<12?'AM':'PM';break;case 'g':r=(y==0||y==12)?12:y%12;break;case 'G':r=y;break;case 'h':r=(y==0||y==12)?12:n(y%12);break;case 'H':r=n(y);break;case 'i':r=n(z);break;case 's':r=n(aa);break;case 'S':r=n(ba,3);break;default:r=s;}q.push(r);}return q.join('');}});a.IntlDateFormats=g;},3);
__d("FileFormResetOnSubmit",["DOMQuery","copyProperties"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h=b('copyProperties');function i(j){this._form=j;}h(i.prototype,{enable:function(){this._subscription=this._form.subscribe('submit',Function.prototype.defer.bind(this._reset.bind(this)));},disable:function(){this._subscription.unsubscribe();this._subscription=null;},_reset:function(){var j=g.scry(this._form.getRoot(),'input[type="file"]');j.forEach(function(k){k.value='';});}});e.exports=i;});
__d("SubscriptionsHandler",["JSLogger","copyProperties"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=b('copyProperties'),i=g.create('subscriptions_handler');function j(k){this._name=k||'unnamed';this._subscriptions=[];}h(j.prototype,{addSubscriptions:function(){if(this._subscriptions){Array.prototype.push.apply(this._subscriptions,arguments);}else{i.warn(this._name+'.subscribe_while_released');for(var k=0,l=arguments.length;k<l;k++)this._unsubscribe(arguments[k]);}},engage:function(){this._subscriptions=this._subscriptions||[];},release:function(){if(this._subscriptions)this._subscriptions.forEach(this._unsubscribe.bind(this));this._subscriptions=null;},_unsubscribe:function(k){if(k.remove){k.remove();}else if(k.reset){k.reset();}else if(k.unsubscribe){k.unsubscribe();}else i.error(this._name+'.invalid',k);}});e.exports=j;});
__d("Token",["CSS","DataStore","DOM","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('copyProperties'),k=b('tx');function l(m,n){this.info=m;this.paramName=n;}j(l.prototype,{getInfo:function(){return this.info;},getText:function(){return this.info.text;},getValue:function(){return this.info.uid;},isFreeform:function(){return !!this.info.freeform;},getElement:function(){if(!this.element)this.setElement(this.createElement());return this.element;},setElement:function(m){h.set(m,'Token',this);this.element=m;return this;},isRemovable:function(){return g.hasClass(this.element,'removable');},createElement:function(){var m=this.paramName,n=this.getText(),o=this.getValue(),p=i.create('a',{href:'#','aria-label':k._("Remove {item}",{item:n}),className:'remove uiCloseButton uiCloseButtonSmall'}),q=i.create('input',{type:'hidden',value:o,name:m+'[]',autocomplete:'off'}),r=i.create('input',{type:'hidden',value:n,name:'text_'+m+'[]',autocomplete:'off'}),s=i.create('span',{className:'removable uiToken'},[n,q,r,p]);return s;}});e.exports=l;});
__d("Tokenizer",["array-extensions","event-extensions","Arbiter","ArbiterMixin","Class","CSS","DataStore","DOM","DOMQuery","Input","Keys","Parent","StickyPlaceholderInput","Style","TextMetrics","Token","UserAgent","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('DOMQuery'),n=b('Input'),o=b('Keys'),p=b('Parent'),q=b('StickyPlaceholderInput'),r=b('Style'),s=b('TextMetrics'),t=b('Token'),u=b('UserAgent'),v=b('copyProperties'),w=b('createObjectFrom'),x=b('emptyFunction');function y(z,aa){this.element=z;this.typeahead=aa;this.input=aa.getCore().getElement();k.set(this.element,'Tokenizer',this);}y.getInstance=function(z){var aa=p.byClass(z,'uiTokenizer');return aa?k.get(aa,'Tokenizer'):null;};v(y.prototype,h,{inline:false,maxTokens:null,excludeDuplicates:true,placeholder:'',init:function(z,aa,ba,ca){this.init=x;this.tokenarea=z;this.paramName=aa;if(!this.placeholder)this.placeholder=this.input.getAttribute('data-placeholder')||'';v(this,ca||{});this.initEvents();this.initTypeahead();this.reset(ba);this.initBehaviors();g.inform('Tokenizer/init',this,g.BEHAVIOR_PERSISTENT);},reset:function(z){this.tokens=[];this.unique={};if(z){this.populate(z);}else l.empty(this.tokenarea);this.updateTokenarea();},populate:function(z){var aa=[];this.tokens=this.getTokenElements().map(function(ba,ca){var da=z[ca];aa.push(this._tokenKey(da));return this.createToken(da,ba);},this);this.unique=w(aa,this.tokens);},getElement:function(){return this.element;},getTypeahead:function(){return this.typeahead;},getInput:function(){return this.input;},initBehaviors:function(){this.behaviors=this.behaviors||[];if(this.behaviors instanceof Array){this.behaviors.forEach(function(ba){ba.behavior(this,ba.config);}.bind(this));}else for(var z in (this.behaviors||{})){var aa=window.TokenizerBehaviors&&window.TokenizerBehaviors[z];aa.call(null,this,this.behaviors[z]);}},initTypeahead:function(){var z=this.typeahead.getCore();z.resetOnSelect=true;z.setValueOnSelect=false;z.preventFocusChangeOnTab=true;if(this.inline){var aa=this.typeahead.getView();j.addClass(aa.getElement(),'uiInlineTokenizerView');}this.typeahead.subscribe('select',function(ba,ca){var da=ca.selected;if('uid' in da){this.updateInput();this.addToken(this.createToken(da));}}.bind(this));this.typeahead.subscribe('blur',this.handleBlur.bind(this));},handleBlur:function(event){this.inform('blur',{event:event});this.updatePlaceholder();},initEvents:function(){var z=this.handleEvents.bind(this),aa=u.firefox()<4?'keypress':'keydown';Event.listen(this.tokenarea,{click:z,keydown:z});Event.listen(this.input,'paste',this.paste.bind(this));Event.listen(this.input,aa,this.keydown.bind(this));},handleEvents:function(event){var z=event.getTarget(),aa=z&&this.getTokenElementFromTarget(z);if(!aa)return;if(event.type!='keydown'||Event.getKeyCode(event)==o.RETURN)this.processEvents(event,z,aa);},processEvents:function(event,z,aa){if(p.byClass(z,'remove')){var ba=aa.nextSibling;ba=ba&&m.scry(aa.nextSibling,'.remove')[0];var ca=this.getTokenFromElement(aa);ca=this.addTokenData(ca,z);this.removeToken(ca);this.focusOnTokenRemoval(event,ba);event.kill();}},focusOnTokenRemoval:function(event,z){n.focus(event.type=='keydown'&&z||this.input);},addTokenData:function(z,aa){return z;},keydown:function(event){this.inform('keydown',{event:event});var z=Event.getKeyCode(event),aa=this.input;if(this.inline&&z==o.BACKSPACE&&n.isEmpty(aa)){var ba=this.getLastToken();if(ba&&ba.isRemovable())this.removeToken(ba);}this.updateInput();},paste:function(event){this.inform('paste',{event:event});this.updateInput(true);},focusInput:function(){n.focus(this.input);},updateInput:function(z){if(!this.inline)return;setTimeout(function(){this.adjustWidth(this.input.value);if(z)this.input.value=this.input.value;}.bind(this),20);q.setPlaceholderText(this.input,'');},setPlaceholder:function(z){this.placeholder=z;if(this.stickyPlaceholder)q.setPlaceholderText(this.input,z);this.updatePlaceholder();},updatePlaceholder:function(){if(!this.inline||this.input.value)return;var z=!this.tokens.length,aa='';if(z||this.stickyPlaceholder){this.adjustWidth(this.placeholder);aa=this.placeholder;}q.setPlaceholderText(this.input,aa);},adjustWidth:function(z){if(!this.inline||!this._getIsInDOM())return;if(!z&&this.stickyPlaceholder&&this.input.value==='')z=this.placeholder;var aa=this._getMetrics().measure(z),ba=aa.width+this._getWidthOffset()+10;r.set(this.input,'width',ba+'px');},getToken:function(z){return this.unique[z]||null;},getTokens:function(){return this.tokens||[];},getTokenElements:function(){return m.scry(this.tokenarea,'span.uiToken');},getTokenElementFromTarget:function(z){return p.byClass(z,'uiToken');},getTokenFromElement:function(z){return k.get(z,'Token');},getTokenValues:function(){if(!this.tokens)return [];return this.tokens.map(function(z){return z.getValue();});},getFirstToken:function(){return this.tokens[0]||null;},getLastToken:function(){return this.tokens[this.tokens.length-1]||null;},hasMaxTokens:function(){return this.maxTokens&&this.maxTokens<=this.tokens.length;},createToken:function(z,aa){var ba=this.getToken(this._tokenKey(z));ba=ba||new t(z,this.paramName);aa&&ba.setElement(aa);return ba;},addToken:function(z){if(this.hasMaxTokens())return;var aa=this._tokenKey(z.getInfo());if(aa in this.unique)return;this.unique[aa]=z;this.tokens.push(z);this.insertToken(z);this.updateTokenarea();this.inform('addToken',z);g.inform('Form/change',{node:this.element});},insertToken:function(z){l.appendContent(this.tokenarea,z.getElement());},removeToken:function(z){if(!z)return;var aa=this.tokens.indexOf(z);if(aa<0)return;this.tokens.splice(this.tokens.indexOf(z),1);delete this.unique[this._tokenKey(z.getInfo())];l.remove(z.getElement());this.updateTokenarea();this.inform('removeToken',z);g.inform('Form/change',{node:this.element});},removeAllTokens:function(){this.reset();this.inform('removeAllTokens');},updateTokenarea:function(){var z=this.typeahead.getCore(),aa=this.getTokenValues();if(this.excludeDuplicates){this._exclusions||(this._exclusions=z.getExclusions());z.setExclusions(aa.concat(this._exclusions));}z.setEnabled(!this.hasMaxTokens());this.updateTokenareaVisibility();this.updatePlaceholder();this.adjustWidth(this.placeholder);},updateTokenareaVisibility:function(){j.conditionShow(this.tokenarea,this.tokens.length!==0);},_tokenKey:function(z){return z.uid+(z.freeform?':':'');},_widthOffset:null,_getWidthOffset:function(){if(this._widthOffset===null){var z=this.input.clientWidth,aa=r.getFloat(this.input,'width');if(z==aa){this._widthOffset=r.getFloat(this.input,'paddingLeft')+r.getFloat(this.input,'paddingRight');}else this._widthOffset=0;}return this._widthOffset;},_metrics:null,_getMetrics:function(){if(!this._metrics)this._metrics=new s(this.input,this.inline);return this._metrics;},_getIsInDOM:function(){return this._isInDOM||(this._isInDOM=m.contains(document.body,this.input));}});e.exports=y;});
__d("endsWith",[],function(a,b,c,d,e,f){function g(h,i){return h.indexOf(i,h.length-i.length)>-1;}e.exports=g;});
__d("escapeRegex",[],function(a,b,c,d,e,f){function g(h){return h.replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1");}e.exports=g;});
__d("htmlHyperlink",["Env","htmlize","UntrustedLink","URI","URLScraper"],function(a,b,c,d,e,f){var g=b('Env'),h=b('htmlize'),i=b('UntrustedLink'),j=b('URI'),k=b('URLScraper');function l(m,n,o,p){if(typeof m==='undefined'||!m.toString)return '';if(typeof n!=='function')n=h;if(typeof o!=='function')o=h;var m=m.toString(),q=[],r;while((r=k.match(m))){var s=m.indexOf(r);if(s>=0)q.push(n(m.substring(0,s)));var t=o(r),u=r.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(r)))u='http://'+u;q.push('<a target="_blank" rel="nofollow" href="'+u+'"');if(p&&!j(u).isFacebookURI()){a.UntrustedLink=i;q.push(' onmousedown="UntrustedLink.bootstrap(this, \''+g.lhsh+'\', event)"');}q.push('>'+t+'</a>');m=m.substring(s+r.length);}m&&q.push(n(m));return q.join('');}e.exports=l;});
__d("BlackbirdUpsell",["event-extensions","Arbiter","AsyncRequest","ContextualDialogX","DOM","LayerDestroyOnHide","LayerHideOnTransition","PresencePrivacy","copyProperties","BlackbirdUpsellConfig","BlackbirdUpsellConstants","BlackbirdUpsellTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ContextualDialogX'),j=b('DOM'),k=b('LayerDestroyOnHide'),l=b('LayerHideOnTransition'),m=b('PresencePrivacy'),n=b('copyProperties'),o=c('BlackbirdUpsellConfig'),p=c('BlackbirdUpsellConstants'),q=c('BlackbirdUpsellTemplates'),r='/ajax/chat/blackbird/update_clicks.php',s='/ajax/chat/blackbird/update_impressions.php',t=235,u=null,v=null,w=false,x=false;function y(){}n(y,{shouldShow:function(){if(this._dialogDismissed)return false;if(this.isEducation()){return !!o.EducationGK&&o.EducationImpressions<o.EducationImpressionLimit;}else return !!o.UpsellGK&&o.UpsellImpressions<o.UpsellImpressionLimit&&o.FriendCount>=o.UpsellMinFriendCount;},isEducation:function(){return o.TimeOffline<=o.EducationTimeOfflineThresdhold;},getOfflineContent:function(){if(this.isEducation()){return this._getEducationContent();}else return this._getUpsellContent();},_getEducationContent:function(){ca();var ga=q[':fb:chat:blackbird:offline-educate'].build(),ha=ga.getNode('chatSettingsButton');Event.listen(ha,'click',function(){g.inform('chat/advanced-settings-dialog-opened');fa(p.CLICK_TYPE_OPEN_SETTINGS);});return ga.getRoot();},_getUpsellContent:function(){ba();var ga=q[':fb:chat:blackbird:upsell'].build(),ha=ga.getNode('chatSettingsButton');Event.listen(ha,'click',function(){g.inform('chat/advanced-settings-dialog-opened');ea(p.CLICK_TYPE_OPEN_SETTINGS);});var ia=ga.getNode('enableChatButton');Event.listen(ia,'click',function(){ea(p.CLICK_TYPE_ENABLE_CHAT);});return ga.getRoot();},getBlackbirdContent:function(ga){ca();switch(ga){case m.ONLINE:return q[':fb:chat:blackbird:most-friends-educate'].build().getRoot();case m.OFFLINE:return q[':fb:chat:blackbird:some-friends-educate'].build().getRoot();}},showOfflineDialog:function(ga){this.showDialog(ga,this.getOfflineContent.bind(this));},showBlackbirdDialog:function(ga,ha){this.showDialog(ga,this.getBlackbirdContent.curry(ha));},showDialog:function(ga,ha){!u&&this._constructDialog();j.setContent(v,ha());u.setContext(ga);u.show();},hide:function(){if(u&&u.isShown())u.hide();},dismiss:function(){this.hide();z();},handleDialogDismissClick:function(){if(this.isEducation()){fa(p.CLICK_TYPE_DISMISS_PROMO);}else ea(p.CLICK_TYPE_DISMISS_PROMO);},isVisible:function(){return x&&!w;},_constructDialog:function(){var ga=q[':fb:chat:blackbird:dialog-frame'].build();v=ga.getNode('dialogContent');u=new i();u.init(ga.getRoot());u.setPosition('above').setWidth(t).setFixed(true).disableBehavior(k).disableBehavior(l);Event.listen(ga.getNode('dialogCloseButton'),'click',this.dismiss.bind(this));Event.listen(ga.getNode('dialogCloseButton'),'click',this.handleDialogDismissClick.bind(this));}});function z(){if(!w&&x){w=true;m.inform('privacy-user-presence-changed');var ga=new h(s);ga.setData({action:p.ACTION_EDUCATE,impressions:o.EducationImpressions,force:true});ga.setErrorHandler(function(){w=false;});ga.send();}}function aa(ga,ha){if(!x){x=true;var ia=new h(s);ia.setData({action:ga,impressions:ha,time_offline:o.TimeOffline});ia.setErrorHandler(function(){x=false;});ia.send();}}function ba(){aa(p.ACTION_UPSELL,o.UpsellImpressions);}function ca(){aa(p.ACTION_EDUCATE,o.EducationImpressions);}function da(ga,ha,ia,ja){var ka=new h(r);ka.setData({action:ga,source:ha,impressions:ia,time_offline:ja});ka.send();}function ea(ga){da(ga,p.ACTION_UPSELL,o.UpsellImpressions,o.TimeOffline);}function fa(ga){da(ga,p.ACTION_EDUCATE,o.EducateImpressions,o.TimeOffline);}g.subscribe('chat/advanced-settings-dialog-opened',y.dismiss.bind(y));g.subscribe('chat-visibility/go-online',y.dismiss.bind(y));g.subscribe('chat-visibility/go-offline',y.dismiss.bind(y));e.exports=y;});
__d("ChatQuietLinks",["event-extensions","DOM","DOMQuery","UserAgent","DataStore","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOM'),h=b('DOMQuery'),i=b('UserAgent'),j=b('DataStore'),k=b('Parent'),l={},m={silenceLinks:function(q){n(q,this.removeEmptyHrefs.bind(this));},nukeLinks:function(q){n(q,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(q){o(q,function(r){return !r||r==='#';});},removeAllHrefs:function(q){o(q);}};function n(q,r){var s=!!i.chrome(),t=!!i.chrome()||i.ie()>=9||i.firefox()>=4;if(l[g.getID(q)])return;l[g.getID(q)]=true;if(!t)return;if(!s){r&&r(q);return;}Event.listen(q,'mouseover',function u(v){var w=k.byTag(v.getTarget(),'a');if(w){var x=w.getAttribute('href');if(p(x)){j.set(w,'stashedHref',w.getAttribute('href'));w.removeAttribute('href');}}});Event.listen(q,'mouseout',function u(v){var w=k.byTag(v.getTarget(),'a'),x=w&&j.remove(w,'stashedHref');if(p(x))w.setAttribute('href',x);});Event.listen(q,'mousedown',function(u){if(!u.isDefaultRequested())return true;var v=k.byTag(u.getTarget(),'a'),w=v&&j.get(v,'stashedHref');if(p(w))v.setAttribute('href',w);});}function o(q,r){var s=g.scry(q,'a');if(r)s=s.filter(function(t){return r(t.getAttribute('href'));});s.forEach(function(t){t.removeAttribute('href');t.setAttribute('tabindex',0);});}function p(q){return q&&q!=='#';}e.exports=m;});
__d("AsyncLoader",["copyProperties","AsyncRequest","BaseAsyncLoader"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('AsyncRequest'),i=b('BaseAsyncLoader');function j(k,l){this._endpoint=k;this._type=l;}g(j.prototype,i.prototype);j.prototype.send=function(k,l,m,n,o){new h(k).setData({ids:l}).setHandler(n).setErrorHandler(o).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};e.exports=j;});
__d("ChatHovercard",["Arbiter","AsyncLoader","Hovercard","JSLogger","debounce"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncLoader'),i=b('Hovercard'),j=b('JSLogger'),k=b('debounce'),l=5,m=new h('/ajax/chat/hovercard/sidebar.php','hover'),n=j.create('chat_hovercard');g.subscribe('Hovercard/dirty',m.reset.bind(m));function o(s,t){m.get(s,function(u){(function(){if(!u){n.error('fetch_failure',{id:s});return;}var v=i.getDialog(u);if(!v){n.error('no_hovercard',{id:s,endpoint:u});return;}if(s==t.getActiveID())t.showHovercard(s,v);}).defer();});}function p(s,t){var u=[];function v(y){if(y>=0&&y<s.length)u.push(s[y]);}var w=s.indexOf(t);if(w>-1){v(w);for(var x=1;x<l;x++){v(w+x);v(w-x);}}return u;}function q(s,t){var u=t.getActiveID();if(u){var v=s.getShowingUsers(),w=p(v,u);m.get(w,function(){});}}function r(s){var t=s.getHoverController();t.registerDefault(o);t.subscribe('hover',k(q.curry(s,t),100));}e.exports=r;});
__d("ChatOrderedListHover",["event-extensions","function-extensions","ArbiterMixin","Class","CSS","DOM","ErrorUtils","LayerFadeOnHide","LayerHideOnBlur","Parent","copyProperties","setTimeoutAcrossTransitions","tx"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('CSS'),j=b('DOM'),k=b('ErrorUtils'),l=b('LayerFadeOnHide'),m=b('LayerHideOnBlur'),n=b('Parent'),o=b('copyProperties'),p=b('setTimeoutAcrossTransitions'),q=b('tx');function r(u){i.addClass(u,'fetching');}function s(u){i.removeClass(u,'fetching');}function t(u){this._orderedList=u;this._root=u.getRoot();Event.listen(this._root,'mouseover',this._mouseOver.bind(this));Event.listen(this._root,'mouseleave',this._mouseLeave.bind(this));u.subscribe('click',this._hide.shield(this));}o(t.prototype,g,{_root:null,_activeItem:null,_hideTimeout:null,_showTimeout:null,_showingDialog:null,_showingID:null,_alreadyShowing:false,_handlers:{},_defaultHandler:null,_mouseOver:function(u){var v=u.getTarget(),w=n.byClass(v,'item');w&&this._setActiveItem(w);},_mouseLeave:function(u){this._setActiveItem(null);},_clearTimeouts:function(){this._showTimeout&&clearTimeout(this._showTimeout);this._showTimeout=null;this._hideTimeout&&clearTimeout(this._hideTimeout);this._hideTimeout=null;},_checkAlreadyShowing:function(){var u=this.getActiveID();if(!u&&!this._showingID)this._alreadyShowing=false;},_hide:function(){if(this._showingDialog){this._showingDialog.enableBehavior(l);this._showingDialog.hide();this._showingDialog=null;this._showingID=null;}this._checkAlreadyShowing();},_show:function(){this._alreadyShowing=true;var u=this.getActiveID(),v=false;if(this._handlers[u]){v=true;k.applyWithGuard(this._handlers[u],{},[u,this]);}else if(this._defaultHandler){v=true;k.applyWithGuard(this._defaultHandler,{},[u,this]);}if(v&&this._showingID!=this.getActiveID())r(this._activeItem);},_setActiveItem:function(u){if(u!=this._activeItem){this._clearTimeouts();this._activeItem&&s(this._activeItem);this._activeItem=null;var v=u?0:100;this._hideTimeout=p(function(){if(this.getActiveID()!=this._showingID)this._hide();}.bind(this),v);if(u){var w=this._orderedList.getUserForNode(u);this._activeItem=u;var x=v+(this._alreadyShowing?75:500);this._showTimeout=p(function(){this._show();}.bind(this),x);this.inform('hover',w);}else this.inform('leave');this._checkAlreadyShowing();}},register:function(u,v){if(!this._handlers[u]){this._handlers[u]=v;return {unregister:function(){if(u==this._showingID)this._hide();delete this._handlers[u];var w=this._orderedList.getAllNodes(),x=w[u];x&&s(x);}.bind(this)};}},registerDefault:function(u){this._defaultHandler=u;},getActiveID:function(){var u=this._activeItem&&this._orderedList.getUserForNode(this._activeItem);return u||null;},showHovercard:function(u,v){if(u==this.getActiveID()&&u!=this._showingID){this._clearTimeouts();s(this._activeItem);this._hide();this._showingDialog=v;this._showingID=u;var w=v.subscribe('mouseenter',this._setActiveItem.bind(this,this._activeItem)),x=v.subscribe('mouseleave',function(){w.unsubscribe();this._setActiveItem(null);}.bind(this)),y=v.subscribe('hide',function(){w.unsubscribe();x.unsubscribe();y.unsubscribe();});v.enableBehavior(m).setContext(this._activeItem).setPosition('left').setOffsetY(9).show();}}});e.exports=t;});
__d("ChatOrderedList",["event-extensions","Animation","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AvailableList","AvailableListConstants","Chat","ChatConfig","ChatOrderedListHover","ChatQuietLinks","ChatVisibility","CSS","DataStore","DOM","HTML","JSLogger","OrderedFriendsList","Parent","PresencePrivacy","ShortProfiles","Tooltip","TypeaheadUtil","URI","XHPTemplate","copyProperties","createObjectFrom","debounceAcrossTransitions","goURI","tx","guid","MercuryConfig","ChannelImplementation"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AsyncDialog'),k=b('AsyncRequest'),l=b('AvailableList'),m=b('AvailableListConstants'),n=b('Chat'),o=b('ChatConfig'),p=b('ChatOrderedListHover'),q=b('ChatQuietLinks'),r=b('ChatVisibility'),s=b('CSS'),t=b('DataStore'),u=b('DOM'),v=b('HTML'),w=b('JSLogger'),x=b('OrderedFriendsList'),y=b('Parent'),z=b('PresencePrivacy'),aa=b('ShortProfiles'),ba=b('Tooltip'),ca=b('TypeaheadUtil'),da=b('URI'),ea=b('XHPTemplate'),fa=b('copyProperties'),ga=b('createObjectFrom'),ha=b('debounceAcrossTransitions'),ia=b('goURI'),ja=b('tx'),ka=b('guid'),la=c('MercuryConfig'),ma=c('ChannelImplementation').instance;function na(sa,ta,ua,va){this._root=sa;this._items={};this._isVisible=false;this._excludedIds={};this._numTopFriends=5;this._hasRendered=false;this._preventRendering=false;this._hoverController=null;this._template=ta;this._messageTemplate=ua;this._contextualDialog=va;Event.listen(this._root,'click',this._onClick.bind(this));Event.listen(this._root,'mouseenter',this._mouseEnter.bind(this));Event.listen(this._root,'mouseleave',this._mouseLeave.bind(this));l.subscribe(m.ON_AVAILABILITY_CHANGED,this.update.shield(this));z.subscribe('privacy-changed',this.update.shield(this));ma.subscribe([ma.CONNECTED,ma.RECONNECTING,ma.SHUTDOWN,ma.MUTE_WARNING,ma.UNMUTE_WARNING],this.update.shield(this));this.inform('initialized',this,h.BEHAVIOR_PERSISTENT);this.render();h.subscribe(w.DUMP_EVENT,function(wa,xa){xa.chat_lists=xa.chat_lists||{sorted_list:this.getSortedList(),ordered_list:x.getList(),available_list:na.getAvailableList(this._excludedIds),excluded_list:this._excludedIds};}.bind(this));}function oa(sa,ta){var ua=pa(sa,ta);if(ua!==0)return ua;var va=qa(sa,ta);if(va!==0)return va;return x.compare(sa,ta);}function pa(sa,ta){var ua=z.allows(sa),va=z.allows(ta);if(ua!==va)return ua?-1:1;return 0;}function qa(sa,ta){var ua=aa.getNow(sa),va=aa.getNow(ta),wa=ca.flatten((ua||{}).name||'~'),xa=ca.flatten((va||{}).name||'~');if(wa!==xa)return wa<xa?-1:1;return 0;}function ra(sa,ta){var ua=l.get(sa)===m.MOBILE,va=l.get(ta)===m.MOBILE;if(ua!==va)return va?-1:1;return qa(sa,ta);}fa(na,{getSortedList:function(sa,ta){var ua=x.getList().filter(function(kb){return !(kb in sa);});ua=ua.filter(function(kb){return z.getFriendVisibility(kb)!==z.BLACKLISTED;});var va=[],wa=r.isOnline();if(wa){if(z.getOnlinePolicy()===z.ONLINE_TO_WHITELIST){var xa=ua,ya={},za,ab;ua=[];for(za=0;za<xa.length;++za){ab=xa[za];if(z.allows(ab)){ya[ab]=true;ua.push(ab);}}var bb=z.getWhitelist();for(za=0;za<bb.length;++za){ab=bb[za];if(!(ab in ya))ua.push(ab);}for(za=0;za<xa.length;++za){ab=xa[za];if(!z.allows(ab))ua.push(ab);}}var cb=o.get('ordered_list.top_friends',0),db=o.get('ordered_list.available_target',0),eb=Math.floor(ta*db),fb=[];for(var za=0,gb=ua.length;za<gb&&eb>0;za++){var ab=ua[za],hb=l.get(ab),ib=hb===m.ACTIVE;if(o.get('chat_sidebar_mobile_available'))ib=ib||(hb===m.MOBILE);if(ib||za<cb){va.push(ab);ib&&eb--;}else fb.push(ab);}if(za<gb)Array.prototype.push.apply(fb,ua.slice(za));if(va.length<ta)Array.prototype.push.apply(va,fb);}else Array.prototype.push.apply(va,ua);va=va.slice(0,ta);if(va.length===ta){var jb=na.getAvailableList(va.concat(sa)).length;jb&&va.splice(-1);}va.sort(oa);return va;},getAvailableList:function(sa){return l.getOnlineIDs().filter(function(ta){return !(ta in sa);});}});fa(na.prototype,i,{getAllNodes:function(){var sa={},ta=u.scry(this._root,'li.item');for(var ua=0;ua<ta.length;ua++){var va=t.get(ta[ua],'id');if(va)sa[va]=ta[ua];}return sa;},getShowingUsers:function(){return u.scry(this._root,'li.item').map(function(sa){return t.get(sa,'id');});},getUserForNode:function(sa){return t.get(sa,'id');},getHoverController:function(){if(!this._hoverController)this._hoverController=new p(this,this._contextualDialog);return this._hoverController;},_getListItem:function(sa){var ta=this._items[sa];if(ta){var ua=l.get(sa),va=z.allows(sa)&&!ma.disconnected(),wa={active:false,mobile:false,greenphone:false};wa.active=ua===m.ACTIVE;if(o.get('sidebar_mobile_icon_green')){wa.greenphone=ua===m.MOBILE;}else wa.mobile=ua===m.MOBILE;for(var xa in wa)s.conditionClass(ta,xa,wa[xa]&&va);s.conditionClass(ta,'invis',!va);}return ta;},getRoot:function(){return this._root;},getSortedList:function(){return na.getSortedList(this._excludedIds,this._numTopFriends);},hide:function(){if(!this._isVisible)return;this._isVisible=false;s.hide(this._root);this.inform('hide');},_onClick:function(event){var sa=event.getTarget(),ta=y.byTag(sa,'li');if(ta){if(s.hasClass(ta,'blackbirdWhitelist')){var ua=new da('/ajax/chat/privacy/settings_dialog.php').addQueryData({ref:'whitelist_separator'});j.send(new k(ua));event.prevent();return false;}var va=t.get(ta,'id');if(va){var wa='ordered_list';while(ta.previousSibling){ta=ta.previousSibling;if(s.hasClass(ta,'separator')){if(s.hasClass(ta,'moreOnlineFriends')){wa='more_online_friends';break;}if(s.hasClass(ta,'blackbirdWhitelist')){wa='blackbird_offline_section';break;}}}var xa=[];if(o.get('chat_realtime_coefficient_impressions'))xa=this.getSortedList();aa.get(va,function(ya){n.openTab(va,ya.name,'friend',wa,xa);});this.inform('click',{id:va});}else if(s.hasClass(ta,'separator')&&y.byClass(sa,'inner'))this.scrollTo(ta);return false;}},_mouseEnter:function(){this._preventRendering=true;},_mouseLeave:function(){this._preventRendering=false;},setExcludedIds:function(sa){this._excludedIds=ga(sa||[]);},setNumTopFriends:function(sa){if(sa!==this._numTopFriends){this._numTopFriends=sa;this.render();}},_getOfflineToSectionItems:function(){var sa='subheader-text-'+ka(),ta=u.create('a',{href:'#','aria-describedby':sa},u.tx._("Edit")),ua=[],va=la.ChatControlLanguageChangeGK?u.tx._("MORE FRIENDS"):u.tx._("OFFLINE FRIENDS");ua.push(v('<li class="separator">'+'<div class="outer">'+'<div class="inner">'+'<span class="text">'+va+'</span>'+'<div class="dive"><span class="bar"></span></div>'+'</div>'+'</div>'+'</li>'));ua.push(v('<li class="separator blackbirdWhitelist">'+'<div class="outer">'+'<div class="inner">'+'<div class="subheader">'+'<span id="'+sa+'" class="subheaderText">'+u.tx._("These friends can't see you on chat. {=link}",{'=link':ta})+'</span>'+'</div>'+'</div>'+'</li>'));return ua;},render:function(){this.render=ha(function(){if(!this._isVisible||(this._preventRendering&&this._hasRendered))return;this._hasRendered=true;var sa=this.getSortedList(),ta=[],ua,va,wa=z.getVisibility()&&z.getOnlinePolicy()==z.ONLINE_TO_WHITELIST;for(var xa=0,ya=sa.length;xa<ya;xa++){ua=sa[xa];if(wa)if(!z.allows(ua)){if(xa+2>=sa.length)break;wa=false;var za=this._getOfflineToSectionItems();ta.push(za[0]);ta.push(za[1]);ya-=2;}va=this._getListItem(ua);if(va){ta.push(va);}else this._renderListItem(ua,this.render.bind(this));}var ab=na.getAvailableList(this._excludedIds),bb=ga(sa);ab=ab.filter(function(hb){return !(hb in bb);});ab.sort(ra);var cb=la.ChatControlLanguageChangeGK?"MORE FRIENDS":"MORE ONLINE FRIENDS";if(ab.length&&ta.length)ta.push(v('<li class="separator moreOnlineFriends">'+'<div class="outer">'+'<div class="inner">'+'<span class="text">'+ja._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':cb,'=count':ab.length})+'</span>'+'<div class="dive"><span class="bar"></span></div>'+'</div>'+'</div>'+'</li>'));for(var db=0,eb=ab.length;db<eb;db++){ua=ab[db];va=this._getListItem(ua);if(va){ta.push(va);}else this._renderListItem(ua,this.render.bind(this));}if(!sa.length&&!ab.length){var fb=this._messageTemplate.render(),gb=ea.getNode(fb,'message');u.setContent(gb,"No one is available to chat.");ta.push(fb);}if(ta.length){u.setContent(this._root,ta);q.nukeLinks(this.getRoot());this.inform('render');}},300,this);this.render();},_renderListItem:function(sa,ta){aa.get(sa,function(ua){if(ua.type==='friend'){var va=this._template.render(),wa=ea.getNode(va,'profile-photo');wa.setAttribute('src',ua.thumbSrc);var xa=ea.getNode(va,'name');u.setContent(xa,ua.name);var ya=ea.getNode(va,'anchor');ya.setAttribute('href','/messages/'+sa);var za=ea.getNode(va,'timeline_icon');if(za){var ab=ja._("Go to {name}'s timeline",{name:ua.firstName});ba.set(za,ab,'above','center');Event.listen(za,'click',function(event){event.kill();ia(ua.uri);});}t.set(va,'id',sa);this._items[sa]=va;ta&&ta(va);}}.bind(this));},show:function(){if(this._isVisible)return;this._isVisible=true;s.show(this._root);this.render();this.inform('show');},isVisible:function(){return this._isVisible;},update:function(){this._hasRendered=false;this.render();},setScrollContainer:function(sa){if(u.contains(sa,this._root))this._scrollContainer=sa;},scrollTo:function(sa){if(!this._scrollContainer)return;var ta=this._scrollContainer.scrollHeight,ua=this._scrollContainer.clientHeight,va=this._scrollContainer.scrollTop,wa=Math.min(sa.offsetTop,ta-ua);if(va!==wa){var xa=Math.abs(wa-va)/this._scrollContainer.clientHeight*500;g(this._scrollContainer).to('scrollTop',wa).ease(g.ease.end).duration(xa).go();}}});e.exports=na;});
__d("TypingIndicator",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","Keys","PresencePrivacy","ShortProfiles","TypingDetector","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChannelConnection'),k=b('ChatVisibility'),l=b('Keys'),m=b('PresencePrivacy'),n=b('ShortProfiles'),o=b('TypingDetector'),p=b('copyProperties'),q=b('emptyFunction');function r(t){if(!k.isOnline())return false;if(t){var u=n.getNow(t);return u&&u.type=="friend"&&m.allows(t);}return true;}function s(t,u,v,w,x){this.userID=t;this.input=u;this.source=v;this.threadID=x;this.remoteState=o.INACTIVE;this.notifyTimer=null;w=w||{};this.notifyDelay=w.notifyDelay||this.notifyDelay;this._typingDetector=new o(u);this._typingDetector.init(w);this._typingDetector.subscribe('change',this._stateChange.bind(this));}p(s.prototype,{notifyDelay:1000,setUserAndThread:function(t,u){if(this.userID!==t||this.threadID!==u){this.resetState();this.userID=t;this.threadID=u;}},setIgnoreEnter:function(t){var u=t?[l.RETURN]:[];this._typingDetector.setIgnoreKeys(u);},resetState:function(){this.remoteState=s.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;},_stateChange:function(t,u){if(u!=o.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=this._notifyState.shield(this,u).defer(this.notifyDelay,false);}else this._notifyState(u,true);},_notifyState:function(t,u){if(!this.userID&&!this.threadID)return;var v=this.userID,w=r(v);if(w&&t!=this.remoteState){this.remoteState=t;if(j.disconnected())return;var x={typ:t,to:v,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,v)).setErrorHandler(q).setData(x).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!u).send();}},_onTypResponse:function(t,u){var v=u.getPayload()||{};if(v.offline)h.set(t,i.OFFLINE,'typing_response');}});e.exports=s;});
__d("ChatSidebarSheet",["event-extensions","function-extensions","ArbiterMixin","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatBehavior","ChatConfig","ChatVisibility","CSS","DOM","JSLogger","PresencePrivacy","copyProperties","tx","MercuryConfig"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ArbiterMixin'),h=b('BlackbirdUpsell'),i=b('ChannelConnection'),j=b('ChannelConstants'),k=b('ChatBehavior'),l=b('ChatConfig'),m=b('ChatVisibility'),n=b('CSS'),o=b('DOM'),p=b('JSLogger'),q=b('PresencePrivacy'),r=b('copyProperties'),s=b('tx'),t=c('MercuryConfig'),u=p.create('sidebar_sheet');function v(y){switch(y){case j.HINT_AUTH:return "Your session has timed out. Please log in.";case j.HINT_CONN:return s._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});case j.HINT_MAINT:return s._("Facebook {Chat} is currently down for maintenance.",{Chat:"Chat"});default:return s._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});}}function w(y){var z;if(y===null){z="Unable to connect to chat. Check your Internet connection.";}else if(y>l.get('warning_countdown_threshold_msec')){var aa=o.create('a',{href:'#',className:'fbChatReconnectLink'},"Try again");z=o.tx._("Unable to connect to chat. {try-again-link}",{'try-again-link':aa});}else if(y>1000){z=s._("Unable to connect to chat. Reconnecting in {seconds}...",{seconds:Math.floor(y/1000)});}else z="Unable to connect to chat. Reconnecting...";return z;}function x(y){this._root=y;this._message=o.find(y,'div.fbChatSidebarMessage div.message');i.subscribe([i.CONNECTED,i.SHUTDOWN,i.RECONNECTING],this._handleConnectionChange.bind(this));i.subscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this._render.bind(this));q.subscribe('privacy-user-presence-changed',this._render.bind(this));k.subscribe(k.ON_CHANGED,this._render.bind(this));this._render();}r(x.prototype,g,{_channelStatus:null,_channelData:null,_handleConnectionChange:function(y,z){this._channelStatus=y;this._channelData=z;this._render();},_showWarningTimeout:null,_warningMsgEventListener:null,_renderChannelDisconnect:function(){if(this._channelStatus===i.SHUTDOWN){return o.setContent(this._message,v(this._channelData));}else if(this._channelStatus===i.RECONNECTING){var y=this._channelData;o.setContent(this._message,w(y));if(y>1000){if(y>l.get('warning_countdown_threshold_msec'))this._warningMsgEventListener=Event.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),'fbChatReconnectLink')){i.reconnect();return false;}});this._showWarningTimeout=setTimeout(this._handleConnectionChange.bind(this,i.RECONNECTING,y-1000),1000,false);}}},_goOnlineEventListener:null,_renderOffline:function(){var y='fbChatGoOnlineLink',z=t.ChatControlLanguageChangeGK?"Turn on chat":"Go online",aa=o.create('a',{href:'#',className:y},z),ba;if(t.ChatControlLanguageChangeGK){ba=o.tx._("{=Go online} to see who's available.",{'=Go online':aa});}else ba=o.tx._("{=Go online} to see who's online to chat.",{'=Go online':aa});o.setContent(this._message,ba);this._goOnlineEventListener=Event.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),y)){u.log('sidebar_go_online');m.goOnline();return false;}});},_renderBlackbirdUpsell:function(){o.setContent(this._message,h.getOfflineContent());},_renderBlackbird:function(y){o.setContent(this._message,h.getBlackbirdContent(y));},_clear:function(){if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}n.removeClass(this._root,'upsell');n.removeClass(this._root,'offline');n.removeClass(this._root,'blackbird');n.removeClass(this._root,'error');n.removeClass(this._root,'notice');o.empty(this._message);},_render:function(){this._clear();if(h.shouldShow()){if(m.hasBlackbirdEnabled()){var y=m.isOnline()?'blackbird':'upsell';n.addClass(this._root,y);this._renderBlackbird(q.getVisibility());}else if(!m.isOnline()){n.addClass(this._root,'upsell');this._renderBlackbirdUpsell();}}else if(!m.isOnline()){n.addClass(this._root,'offline');this._renderOffline();}else if(i.disconnected()){n.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!k.notifiesUserMessages()){n.addClass(this._root,'notice');o.setContent(this._message,"Alerts are off while you use another client to chat.");}this.inform('updated');}});e.exports=x;});
__d("ChatSidebar",["JSXDOM","ChatOrderedList","ChatTypeaheadBehavior","ChatTypeaheadCore","ChatTypeaheadDataSource","ChatTypeaheadRenderer","event-extensions","Typeahead","Arbiter","ArbiterMixin","AsyncRequest","ChatConfig","ChatHovercard","ChatOptions","ChatSidebarSheet","CSS","DOM","DOMDimensions","FBDesktopPlugin","JSLogger","OrderedFriendsList","PresencePrivacy","ScrollableArea","Style","UserAgent","ViewportBounds","copyProperties","createArrayFrom","debounce","emptyFunction"],function(a,b,c,d,e,f){var g=b('JSXDOM');b('ChatOrderedList');b('ChatTypeaheadBehavior');b('ChatTypeaheadCore');b('ChatTypeaheadDataSource');b('ChatTypeaheadRenderer');b('event-extensions');b('Typeahead');var h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AsyncRequest'),k=b('ChatConfig'),l=b('ChatHovercard'),m=b('ChatOptions'),n=b('ChatSidebarSheet'),o=b('CSS'),p=b('DOM'),q=b('DOMDimensions'),r=b('FBDesktopPlugin'),s=b('JSLogger'),t=b('OrderedFriendsList'),u=b('PresencePrivacy'),v=b('ScrollableArea'),w=b('Style'),x=b('UserAgent'),y=b('ViewportBounds'),z=b('copyProperties'),aa=b('createArrayFrom'),ba=b('debounce'),ca=b('emptyFunction'),da,ea=false,fa=false,ga=false,ha=false,ia=false,ja,ka,la,ma,na=null,oa=s.create('chat_sidebar'),pa=32;function qa(){o.removeClass(document.documentElement,'sidebarMode');if(!ha||!wa.isVisible()){h.inform('reflow');return;}ga=false;na=null;o.hide(ka);ja.hide();la.getCore().reset();oa.rate('sidebar_hide',ha);wa.inform('sidebar/hide',wa);h.inform('sidebar/hide',wa);h.inform('reflow');}function ra(){var xa=wa.shouldShowSidebar();o.conditionClass(document.documentElement,'sidebarCapable',xa);if(wa.isEnabled()&&xa){sa();var ya=ma.height;aa(ka.childNodes).forEach(function(za){if(za!==da)ya-=q.getElementDimensions(za).height;});ya=Math.max(0,ya);w.set(da,'height',ya+'px');this._maxItems=Math.floor((ya-8)/pa);ja.setNumTopFriends(this._maxItems);la.getData().setMaxResults(this._maxItems);wa.inform('sidebar/resized',wa);h.inform('sidebar/resized',wa);h.inform('reflow');}else qa();if(!ha){va();ha=true;}na=null;}function sa(){if(wa.isVisible())return;ga=true;na=null;o.show(ka);o.addClass(document.documentElement,'sidebarMode');ja.show();oa.rate('sidebar_show',ha);wa.inform('sidebar/show',wa);h.inform('sidebar/show',wa);}function ta(){m.setSetting('sidebar_mode',wa.isEnabled(),'sidebar');new j('/ajax/chat/settings.php').setHandler(ca).setErrorHandler(ca).setData({sidebar_mode:wa.isEnabled()}).setAllowCrossPageTransition(true).send();}function ua(){return t.getList().length<=k.get('sidebar.min_friends');}function va(){var xa=true;if(!wa.isEnabled()){oa.log('state_not_enabled');xa=false;}if(!wa.isViewportCapable()){oa.log('state_not_shown_viewport');xa=false;}if(fa){oa.log('state_not_shown_hidden');xa=false;}if(ua()){oa.log('state_not_shown_num_friends');xa=false;}if(r.shouldSuppressSidebar()){oa.log('state_not_shown_fbdesktop');xa=false;}oa.log(xa?'state_shown':'state_not_shown');}var wa={init:function(xa,ya,za){wa.init=ca;ia=true;ka=xa;ja=ya;la=za;da=p.find(xa,'div.fbChatSidebarBody');if(k.get('chat_sidebar_hovercards'))new l(ya);var ab=new n(xa);ab.subscribe('updated',ra);h.subscribe('sidebar/invalidate',ra);ya.setScrollContainer(p.find(da,'div.uiScrollableAreaWrap'));ya.subscribe(['render','show','hide'],ba(function(){var bb=ya.getRoot(),cb=v.getInstance(bb);cb&&cb.adjustGripper();}));Event.listen(window,'resize',ra);if(x.firefox()>=17)Event.listen(window,'storage',function(bb){if(bb.key=='_socialfox_active'&&bb.oldValue!=bb.newValue)ra();});h.subscribe('chat/option-changed',function(bb,cb){if(cb.name=="sidebar_mode"){ea=!!m.getSetting('sidebar_mode');ra();}});za.subscribe(['respond','reset'],function(bb,cb){if(ga)if(cb&&cb.value&&cb.value===za.getCore().getValue()&&za.getView().isVisible()){ja.hide();}else ja.show();});za.getData().subscribe('beforeQuery',ra);h.subscribe('buddylist-nub/initialized',function(bb,cb){Event.listen(cb.getButton(),'click',function(event){wa.enable();return !wa.shouldShowSidebar();});});ea=!!m.getSetting('sidebar_mode');u.subscribe('privacy-user-presence-changed',ra);ra();y.addRight(wa.getVisibleWidth);wa.inform('sidebar/initialized',wa,h.BEHAVIOR_PERSISTENT);h.inform('sidebar/initialized',wa,h.BEHAVIOR_PERSISTENT);},isInitialized:function(){return ha;},disable:function(){if(!wa.isEnabled())return;ea=false;ta();qa();},enable:function(){if(wa.isEnabled())return;ea=true;ta();ra();!function(){if(wa.isVisible())la.getCore().getElement().focus();}.defer();},ensureLoaded:function(){if(ia)return;d(['UIPagelet'],function(xa){var ya=g.div({id:"pagelet_sidebar"});p.appendContent(document.body,ya);xa.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});ia=true;},hide:function(){if(fa)return;fa=true;qa();},unhide:function(){if(!fa)return;fa=false;ra();},getBody:function(){return da;},getRoot:function(){return ka;},getVisibleWidth:function(){if(!ga||!ka)return 0;if(na===null)na=ka.offsetWidth;return na;},isEnabled:function(){return ea;},isViewportCapable:function(){ma=q.getViewportWithoutScrollbarDimensions();var xa=k.get('sidebar.minimum_width');return ma.width>xa;},shouldShowSidebar:function(){return wa.isViewportCapable()&&!fa&&!ua()&&!r.shouldSuppressSidebar();},isVisible:function(){return ga;},resize:ra,toggle:function(){wa.isEnabled()?wa.disable():wa.enable();}};z(wa,i);e.exports=wa;});
__d("VideoCallingTour",["event-extensions","Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Chat'),j=b('ChatSidebar'),k=b('ChatVisibility'),l=b('CSS'),m=b('DOM'),n=b('PresencePrivacy'),o=b('Run'),p=b('Toggler'),q=b('Vector'),r=b('copyProperties'),s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=y.defer();}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=y.defer();}));});x.inform('videocallingtour/start');}});e.exports=x;});
__d("MercuryFileUploader",["event-extensions","ArbiterMixin","CSS","DOM","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachment","MercuryAttachmentTemplates","copyProperties","csx","cx","getObjectValues","startsWith"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('CSS'),i=b('DOM'),j=b('FileForm'),k=b('FileFormResetOnSubmit'),l=b('FileInput'),m=b('FormSubmitOnChange'),n=b('MercuryAttachment'),o=b('MercuryAttachmentTemplates'),p=b('copyProperties'),q=b('csx'),r=b('cx'),s=b('getObjectValues'),t=b('startsWith'),u=0;function v(x,y,z,aa){this._parentElem=x;this._attachments={};this._uploading={};this._uploadTemplates={};this._fileForm=new j(y,[m,k]);if(!z){var ba=i.scry(y,"._3kt")[0];z=i.create('input',{type:'file',className:"_n",name:'attachment[]',multiple:1,tabindex:1});new l(ba,i.find(ba,"._213"),z);}this._subscriptions=[this._fileForm.subscribe('submit',function(){var ca='upload_'+u++;aa.value=ca;if(z.files){for(var da=0;da<z.files.length;da++)this._addFileUploadRow(ca,z.files[da].name);}else this._addFileUploadRow(ca,z.value);}.bind(this)),this._fileForm.subscribe('success',this._onFileUploadSuccess.bind(this))];}p(v.prototype,g,{isUploading:function(){return !!Object.keys(this._uploading).length;},getAttachments:function(){return s(this._attachments);},removeAttachments:function(){this._attachments={};this._uploadTemplates={};this._uploading={};i.empty(this._parentElem);this.inform('dom-updated');},destroy:function(){this._subscriptions.forEach(function(x){x.unsubscribe();});this._fileForm.destroy();},_addFileUploadRow:function(x,y){var z=o[':fb:mercury:upload-file-row'].build(),aa=w(y),ba=x+'/'+aa;this._uploadTemplates[ba]=z;this._uploading[ba]=true;i.appendContent(z.getNode('iconText'),aa);Event.listen(z.getNode('closeFileUpload'),'click',this._removeFileUploader.bind(this,ba));i.appendContent(this._parentElem,z.getRoot());this.inform('dom-updated');},_removeFileUploader:function(x,event){delete this._attachments[x];delete this._uploading[x];var y=this._uploadTemplates[x];delete this._uploadTemplates[x];if(y){i.remove(y.getRoot());this.inform('dom-updated');}this.inform('upload-canceled');return false;},_updateFileUploader:function(x,y){var z=this._uploadTemplates[x],aa=n.getAttachIconClassByMime(y.filetype);h.addClass(z.getNode('iconText'),aa);h.addClass(z.getRoot(),'done');},_onFileUploadSuccess:function(event,x){var y=x.response.getPayload(),z=y.uploadID,aa=y.metadata;for(var ba=0;ba<aa.length;ba++){var ca=z+'/'+aa[ba].filename;if(this._uploading[ca]){delete this._uploading[ca];this._attachments[ca]=aa[ba];this._updateFileUploader(ca,aa[ba]);}}if(!this.isUploading())this.inform('all-uploads-completed');},_onFileUploadFailure:function(event,x){}});function w(x){if(x&&t(x,'C:\\fakepath\\'))return x.substring(12);return x;}e.exports=v;});
__d("ChatActivity",["event-extensions","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","MercuryThreads","PresenceState","UserActivity","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('JSLogger'),k=b('MercuryConfig'),l=b('MercuryThreads'),m=b('PresenceState'),n=b('UserActivity'),o=b('copyProperties'),p=k.activity_limit||60000,q=k.idle_limit||1800000,r=k.idle_poll_interval||300000,s=j.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=o(new g(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}h.subscribe(i.ON_AVAILABILITY_CHANGED,function(){if(!h.isUserIdle())u=Date.now();});Event.listen(window,'focus',function(){v=true;y();});Event.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});g.subscribe(j.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;});
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryMessages","MercuryParticipants","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('MercuryMessages'),i=b('MercuryParticipants'),j=b('MercuryThreads'),k=b('tx');function l(m,n){g.isThreadID(m);j.getThreadMeta(m,function(o){h.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1];if(q&&q.author!=i.user){i.get(q.author,function(r){if(o.name){n(k._("{senderName} messaged {groupName}",{senderName:r.short_name,groupName:o.name}));}else n(k._("{name} messaged you",{name:r.short_name}));});}else n("New message!");});});}e.exports={renderDocumentTitle:l};});
__d("MercuryTimestampTracker",["MercuryConstants","MercuryServerRequests"],function(a,b,c,d,e,f){var g=b('MercuryConstants'),h=b('MercuryServerRequests'),i=0;e.exports={getLastUserMessageTimestamp:function(){return i;}};h.subscribe('update-messages',function(j,k){if(!k.actions||!k.actions.length)return;var l=g.MercuryPayloadSource;if(k.payload_source==l.CLIENT_SEND_MESSAGE||k.payload_source==l.UNKNOWN)return;for(var m=0;m<k.actions.length;m++){var n=k.actions[m],o=n.action_type;if(o==g.MercuryActionType.USER_GENERATED_MESSAGE&&n.thread_id&&n.timestamp>i)i=n.timestamp;}});});
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryThreadInformer","MercuryNotificationRenderer","PresenceState","MercuryTimestampTracker","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('DocumentTitle'),i=b('JSLogger'),j=b('MercuryThreadInformer'),k=b('MercuryNotificationRenderer'),l=b('PresenceState'),m=b('MercuryTimestampTracker'),n=b('MercuryUnseenState'),o=i.create('chat_title'),p=null,q=0,r=false;function s(){if(p){p.stop();p=null;return true;}return false;}function t(y){var z=y||m.getLastUserMessageTimestamp();if(q<=z){q=z;if(s()||r)l.doSync();}}var u={blink:function(y,z){if(!p&&q<z)k.renderDocumentTitle(y,function(aa){if(!p)p=h.blink(aa);});},stopBlinking:function(){t();},blinkingElsewhere:function(){r=true;}};function v(y){var z=l.verifyNumber(y.sb2);if(!z||z<=q)return null;return z;}function w(y){var z=y&&v(y);if(z){q=z;o.debug('load',q);s();r=false;}}function x(y){var z=v(y);if(!z){o.debug('store',q);y.sb2=q;r=false;}return y;}l.registerStateStorer(x);l.registerStateLoader(w);j.subscribe('thread-read-changed',function(y,z){var aa=m.getLastUserMessageTimestamp(),ba=0;for(var ca in z)if(z[ca].mark_as_read&&z[ca].timestamp>=aa&&z[ca].timestamp>ba)ba=z[ca].timestamp;ba&&t(ba);});g.subscribe('activity',function(){t();});(function(){var y=l.getInitial();if(y)q=v(y)||0;})();e.exports=u;});
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryConstants","MercuryParticipants","Sound","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatActivity'),i=b('ChatConfig'),j=b('ChatOptions'),k=b('ChatTitleBarBlinker'),l=b('MercuryConstants'),m=b('MercuryParticipants'),n=b('Sound'),o=b('copyProperties');n.init(['audio/ogg','audio/mpeg']);function p(r){if(j.getSetting('sound'))n.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],r,false);}var q={messageReceived:function(r){var s=l.MessagingTag;if(r.author==m.user||!r.is_unread||(r.folder!=s.INBOX&&r.folder!=s.ARCHIVED))return;var t=h.isActive(),u=r.thread_id,v=r.timestamp;if(t){var w=false;q.inform('before-alert',{threadID:u,cancelAlert:function(){w=true;}});!w&&p(v);}else{k.blink(u,v);p(v);}k.blinkingElsewhere();}};e.exports=o(q,g);});
__d("VideoCallRecordMessageDialog",["AsyncDialog","AsyncRequest","Dialog","MercuryConfig","URI","tx"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('Dialog'),j=b('MercuryConfig'),k=b('URI'),l=b('tx'),m={get:function(n,o){var p=j.MessagesMercuryIntegrationGK?"Would you like to leave a message?":"Would you like to leave a video message?",q=j.MessagesMercuryIntegrationGK?"New Message":"Record Message";return new i().setTitle(l._("{firstname} is Unavailable",{firstname:o})).setBody(p).setButtons([{name:'record-message',label:q},i.CANCEL]).setHandler(function(){var r=k('/ajax/messaging/composer.php').setQueryData({ids:[n],autoloadvideo:true}).toString();g.send(new h(r));});}};e.exports=m;});
__d("VideoCallCore",["event-extensions","ActiveXSupport","Arbiter","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","Cookie","CSS","Dialog","MercuryConfig","UserAgent","emptyFunction","ge","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ActiveXSupport'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AvailableList'),k=b('AvailableListConstants'),l=b('Bootloader'),m=b('ChannelConstants'),n=b('Cookie'),o=b('CSS'),p=b('Dialog'),q=b('MercuryConfig'),r=b('UserAgent'),s=b('emptyFunction'),t=b('ge'),u=[],v={isSupported:function(){if(r.windows()){if(r.ie()>=9&&!r.ie64()){return g.isSupported();}else return (r.ie()>=7&&!r.ie64())||r.firefox()>=3.6||r.chrome()>=5||r.opera()>=12;}else if(r.osx()>10.4)return (r.firefox()>=3.6||r.chrome()>=5||r.safari()>=500||r.opera()>=12);return false;},isInstalled:function(){var z=false;if(this.isSupported())if(w()){var aa=null;try{aa=new ActiveXObject('SkypeLimited.SkypeWebPlugin');z=!!aa;}catch(ba){}aa=null;}else{z=x();if(q.VideoCallingNoJavaGK)if(z&&r.osx()>=10.8)if(z.description&&z.description.charAt(0)!='v')z=false;}return z;},mightReloadPostInstall:function(){return r.windows();},onVideoMessage:function(z){u.push(z);l.loadModules(['VideoCallController'],s);},setMessageHandler:function(z){this.onVideoMessage=z;if(z)while(u.length)z(u.shift());},availableForCall:function(z){var aa=j.get(z);return aa==k.ACTIVE||aa==k.IDLE;},onProfileButtonClick:function(z){v.startCallOrLeaveMessage(z,'profile_button_click');},attachListenerToProfileButton:function(z){var aa=t('videoCallProfileButton');if(aa){if(!v.isSupported()){o.hide(aa);return;}Event.listen(aa,'click',function(event){v.startCallOrLeaveMessage(z,'profile_button_click_timeline');});}},startCallOrLeaveMessage:function(z,aa){if(this.availableForCall(z)){v.showOutgoingCallDialog(z,aa);}else b('ShortProfiles').get(z,function(ba){b('VideoCallRecordMessageDialog').get(z,ba.firstName).show();});},showOutgoingCallDialog:function(z,aa){var ba=aa||'unknown';v.logClick(z,ba);var ca=v.isInstalled()?'outgoing_dialog.php':'intro.php',da='/ajax/chat/video/'+ca+'?idTarget='+z;new p().setAllowCrossPageTransition(true).setAsync(new i(da)).show();},logClick:function(z,aa){new i().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:z,clickSource:aa}).setAllowCrossPageTransition(true).setErrorHandler(s).send();}};function w(){return r.ie()&&r.windows()&&!r.opera();}function x(){if(!navigator)return null;navigator.plugins.refresh(false);var z=navigator.mimeTypes['application/skypesdk-plugin'];return z&&z.enabledPlugin;}function y(){if(!v.mightReloadPostInstall())return;var z=n.get('vcpwn');if(z){n.clear('vcpwn');var aa=n.get('vctid');if(aa){n.clear('vctid');if(n.get('vctid'))return;if(aa&&v.isInstalled()){var ba='/ajax/chat/video/outgoing_dialog.php?idTarget='+aa;new p().setAllowCrossPageTransition(true).setAsync(new i(ba)).show();}}}}h.subscribe(m.getArbiterType('video'),function(z,aa){v.onVideoMessage(aa.obj);});h.subscribe(m.getArbiterType('chat_event'),function(z,aa){if(aa.obj.event_name=="missed-call")l.loadModules(['VideoCallController'],function(ba){ba.onMissedCallEvent(aa.obj);});});y();e.exports=v;});
__d("ChatApp",["CSS","JSLogger"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('JSLogger'),i=false,j=false,k=false,l=null,m={init:function(n,o,p){if(l){h.create('chat_app').error('repeated_init');return;}l=n;d(['TabsViewport','ChatTabController','ChatTabViewCoordinator','MercuryServerRequests','MercuryChannelHandler','MercuryStateCheck'],function(q,r,s,t,u,v){t.handleUpdate(p);this.tabsViewport=new q(o);this.tabController=new r(this.tabsViewport);this.tabViewCoordinator=new s(o,this.tabsViewport);i=j=true;}.bind(this));},hide:function(){if(!i||k)return;g.hide(l);k=true;},unhide:function(){if(i){if(k){g.show(l);this.tabsViewport.checkWidth();d(['Dock'],function(n){n.resizeAllFlyouts();});k=false;}}else if(!j){d(['UIPagelet'],function(n){n.loadFromEndpoint('DockChatPagelet','pagelet_chat');});j=true;}}};e.exports=m;});
__d("ChatTabModel",["function-extensions","Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","JSLogger","MercuryAssert","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker","PresenceInitialData","PresenceState","PresenceUtil","areObjectsEqual","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatBehavior'),j=b('ChatConfig'),k=b('JSLogger'),l=b('MercuryAssert'),m=b('MercuryServerRequests'),n=b('MercuryThreads'),o=b('MercuryTimestampTracker'),p=b('PresenceInitialData'),q=b('PresenceState'),r=b('PresenceUtil'),s=b('areObjectsEqual'),t=b('copyProperties'),u=[],v=null,w=null,x=null,y=null;function z(){return parseInt(p.serverTime,10);}var aa=j.get('tab_max_load_age')||3600000,ba=z()-aa,ca=0,da=20,ea=k.create('chat_tab_model'),fa=false;function ga(xa){var ya=q.verifyNumber(xa.uct2);if(!ya||typeof ya!=='number'){ea.warn('bad_cookie_version',xa.uct2);return null;}if(ya<=ca||ya<ba)return null;return ya;}function ha(xa){var ya=ga(xa);if(!ya){var za={};za.old_tabs=xa&&xa.t2&&JSON.stringify(xa.t2);za.old_promoted=xa&&xa.lm2;za.old_time=xa&&xa.uct2;za.old_reason=xa&&xa.tr;za.old_window=xa&&xa.tw;var ab;if(w&&xa.t2)for(var bb=0;bb<xa.t2.length;bb++){var cb=xa.t2[bb];if(cb.i===w)ab=cb.r;}var db=[];u.forEach(function(eb){if(!eb.fragile){var fb={i:eb.id,si:eb.server_id};if(eb.raised||(eb.id===w&&ab))fb.r=1;db.push(fb);}});xa.t2=db;xa.uct2=ca;xa.lm2=v;xa.tr=y;xa.tw=r.getSessionID();za.new_tabs=JSON.stringify(xa.t2);za.new_promoted=xa.lm2;za.new_time=xa.uct2;za.new_reason=xa.tr;za.new_window=xa.tw;ea.debug('store',za);}return xa;}function ia(xa){if(xa){var ya=ga(xa);if(ya){var za={};za.old_tabs=JSON.stringify(u);za.old_promoted=v;za.old_time=ca;za.old_reason=y;za.window_id=r.getSessionID();za.cookie_tabs=xa&&xa.t2&&JSON.stringify(xa.t2);za.cookie_promoted=xa&&xa.lm2;za.cookie_time=xa&&xa.uct2;za.cookie_reason=xa&&xa.tr;za.cookie_window=xa&&xa.tw;ca=ya;y='load';var ab=ja(xa.t2,xa.lm2||null);za.load_result=ab;za.new_tabs=JSON.stringify(u);za.new_promoted=v;za.new_time=ca;za.new_reason=y;var event='load';if(!fa)event+='_init';ea.log(event,za);return ab;}}return false;}function ja(xa,ya){if(ka(xa,ya)){var za=u.filter(function(cb){return cb.fragile;}),ab={};v=null;u=xa.map(function(cb){var db={id:cb.i,server_id:cb.si};if(db.id==ya)v=db.id;if(w==cb.i){var eb=pa(w);if(eb!=-1){db.raised=u[eb].raised;return db;}else return null;}if(cb.r)db.raised=true;ab[db.id]=db;return db;});u=u.filter(function(cb){return cb!=null;});if(x)for(var bb in x)if(!ab[bb]||!ab[bb].raised)delete x[bb];za=za.filter(function(cb){return !ab[cb.id];});u=u.concat(za);oa();return true;}return false;}function ka(xa,ya){if(ya!=v)return true;var za=u.filter(function(cb){return !cb.fragile;});if(xa.length!=za.length)return true;for(var ab=0,bb=xa.length;ab<bb;ab++){if(xa[ab].id===w)continue;if(!s(xa[ab],za[ab]))return true;}return false;}function la(xa,ya,za){var ab=ia(q.get());if(ya===undefined||ya>ca){if(xa()){ab=true;y=za||null;na(ya);}}else ea.error('rejected',{change_time:ya,state_time:ca});ab&&ma();}function ma(){if(fa)va.inform('chat/tabs-changed',va.get());}function na(xa){if(xa===undefined)xa=Math.max(o.getLastUserMessageTimestamp()||1,ca+1);ca=xa;q.doSync();}function oa(){var xa=u.length-da;if(xa>0)u=u.filter(function(ya){return ya.raised||xa--<=0;});}function pa(xa){for(var ya=0;ya<u.length;ya++)if(u[ya].id==xa)return ya;return -1;}function qa(xa){var ya=n.getThreadMetaNow(xa);if(!ya)return false;if(ya.is_canonical_user){return sa(xa);}else{var za=ra(xa);if(za)m.getServerThreadID(xa,function(ab){if(ta(xa,ab)){na();ma();}});return za;}}function ra(xa){if(pa(xa)===-1){u.push({id:xa,fragile:true});ea.log('open_fragile_tab',{tabs:JSON.stringify(u),opened:xa,window_id:r.getSessionID()});return true;}return false;}function sa(xa){var ya=pa(xa);if(ya!=-1)if(u[ya].fragile){u.splice(ya,1);}else return false;for(var za=0;za<=u.length;za++)if(za==u.length||u[za].fragile){u.splice(za,0,{id:xa});oa();ea.log('open_tab',{tabs:JSON.stringify(u),opened:xa,window_id:r.getSessionID()});return true;}}function ta(xa,ya){var za=pa(xa);if(za!=-1&&u[za].fragile){var ab=u[za];ab.fragile=false;ab.server_id=ya;var bb=[];u.forEach(function(cb){if(cb.id!=xa){if(ab&&cb.fragile){bb.push(ab);ab=null;}bb.push(cb);}});if(ab)bb.push(ab);u=bb;ea.log('make_permanent',{tabs:JSON.stringify(u),tab_id:xa,window_id:r.getSessionID()});return true;}return false;}function ua(xa){var ya=pa(xa);if(xa==v)v=null;if(ya!=-1){u.splice(ya,1);ea.log('close_tab',{tabs:JSON.stringify(u),closed:xa,window_id:r.getSessionID()});return true;}return false;}q.registerStateStorer(ha);q.registerStateLoader(function(xa){if(ia(xa))ma();});function va(){}t(va,h,{indexOf:function(xa){return pa(xa);},getTab:function(xa){l.isThreadID(xa);var ya=this.indexOf(xa);if(ya>-1){var za=u[ya];return t({},za);}return null;},closeAllTabs:function(){if(u.length){ea.log('close_all_tabs',{closed_tabs:JSON.stringify(u),window_id:r.getSessionID()});u=[];v=null;if(x)x={};na();ma();}},closeFragileTabs:function(){var xa=[];for(var ya=0;ya<u.length;ya++)if(u[ya].fragile){xa.push(u[ya]);u.splice(ya);ma();break;}ea.log('close_fragile_tabs',{tabs:JSON.stringify(u),fragile_closed:xa,window_id:r.getSessionID()});},closeTab:function(xa,ya){l.isThreadID(xa);var za=false;if(x){delete x[xa];za=true;}la(function(){if(ua(xa))za=true;return za;},undefined,ya);},closeTabAndDemote:function(xa,ya,za){l.isThreadID(xa);var ab=false;if(x){delete x[xa];ab=true;}la(function(){if(ua(xa)){if(v){var bb=pa(v);if(bb>ya){var cb=u.splice(bb,1)[0];u.splice(ya,0,cb);v=null;}}ab=true;}return ab;},undefined,za);},raiseTab:function(xa,ya){l.isThreadID(xa);var za=false;if(x&&ya){x[xa]=true;za=true;}if(!ya&&xa===w){za&&ma();return;}la(function(){if(qa(xa))za=true;var ab=pa(xa);if(ab!=-1&&!u[ab].raised){u[ab].raised=true;za=true;ea.log('raise_tab',{tabs:JSON.stringify(u),raised:xa,window_id:r.getSessionID()});}return za;});},get:function(){var xa=u.map(function(ya){var za=t({},ya);delete za.fragile;if(x)za.raised=x[za.id];return za;});return {tabs:xa,promoted:v};},openFragileTab:function(xa){l.isThreadID(xa);if(ra(xa))ma();},openTab:function(xa){l.isThreadID(xa);la(qa.curry(xa));},lowerTab:function(xa){l.isThreadID(xa);var ya=false;if(x){delete x[xa];ya=true;}la(function(){var za=pa(xa);if(za!=-1&&u[za].raised){delete u[za].raised;ea.log('lower_tab',{tabs:JSON.stringify(u),lowered:xa,window_id:r.getSessionID()});ya=true;}return ya;});},raiseAndPromoteTab:function(xa,ya,za,ab){l.isThreadID(xa);var bb=false;if(x&&ya){x[xa]=true;bb=true;}if(!ya&&xa===w){bb&&ma();return;}la(function(){if(qa(xa))bb=true;var cb=pa(xa);if(cb!=-1&&(!u[cb].raised||v!=xa)){u[cb].raised=true;v=xa;bb=true;ea.log('raise_and_promote_tab',{tabs:JSON.stringify(u),promoted:xa,window_id:r.getSessionID()});}return bb;},za,ab);},squelchTab:function(xa){l.isThreadID(xa);w=xa;this.lowerTab(xa);ea.log('squelch_tab',{squelched:xa,tabs:JSON.stringify(u),window_id:r.getSessionID()});},clearSquelchedTab:function(){if(w)ea.log('unsquelch_tab',{squelched:w,tabs:JSON.stringify(u),window_id:r.getSessionID()});w=null;},persistLocalRaised:function(){if(x){la(function(){var xa=false;u.forEach(function(ya){if(ya.raised!=x[ya.id]){xa=true;if(x[ya.id]){ya.raised=true;}else delete ya.raised;}});return xa;});ea.log('persist_local_raise',{tabs:JSON.stringify(u),window_id:r.getSessionID()});}}});g.subscribe(k.DUMP_EVENT,function(xa,ya){ya.chat_tabs={promoted:v,tabs:u.map(function(za){return t({},za);}),time:ca,max_load_age:aa};});function wa(){var xa=i.ignoresRemoteTabRaise();if(xa&&!x){ea.log('start_ignore_remote_raise');x={};ma();}else if(!xa&&x){ea.log('stop_ignore_remote_raise');x=null;ma();}}i.subscribe(i.ON_CHANGED,wa);wa();ia(q.getInitial(),true);if(ca===0)ca=z()-600000;fa=true;e.exports=va;});
__d("VideoCallPromo",["ArbiterMixin","AsyncRequest","AvailableList","AvailableListConstants","ChatConfig","ChatVisibility","ContextualDialogX","CSS","MercuryParticipants","MercuryThreads","ChatTabTemplates","VideoCallCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('ChatConfig'),l=b('ChatVisibility'),m=b('ContextualDialogX'),n=b('CSS'),o=b('MercuryParticipants'),p=b('MercuryThreads'),q=b('ChatTabTemplates'),r=b('VideoCallCore'),s=b('copyProperties'),t=b('emptyFunction');function u(){this._dialog=null;}function v(x){if(!(r.isSupported()&&k.get('video.show_promo')))return false;var y=p.getCanonicalUserInThread(x);if(!y)return false;return l.isOnline()&&r.availableForCall(y);}function w(x){new h().setURI('/ajax/chat/video/log_promo.php').setData({viewedUserID:x}).setAllowCrossPageTransition(true).setErrorHandler(t).send();}s(u.prototype,g);s(u.prototype,{render:function(x,y){var z=v(y);if(!z)return;var aa=p.getCanonicalUserInThread(y);o.get('fbid:'+aa,function(ba){if(!ba.call_promo)return;var ca=q[':fb:mercury:call:promo'].build();this._dialog=new m();this._dialog.init(ca.getRoot()).setWidth(250).setAlignH('center').setContext(x).show();n.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');n.addClass(x,'video_call_promo');w(p.getCanonicalUserInThread(y));this.inform('chat/dialog-rendered',{dialog:this,thread_id:y});}.bind(this));},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=u;});
__d("VideoCallTourDialog",["ArbiterMixin","ContextualDialogX","CSS","MercuryThreads","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ContextualDialogX'),i=b('CSS'),j=b('MercuryThreads'),k=b('ChatTabTemplates'),l=b('VideoCallCore'),m=b('VideoCallingTour'),n=b('copyProperties');function o(){this._dialog=null;}n(o.prototype,g);n(o.prototype,{render:function(p,q){var r=j.getCanonicalUserInThread(q);if(!r||!l.availableForCall(r))return;var s=k[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});m.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;});
__d("ChatContextualDialogController",["event-extensions","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallPromo","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('ChatTabModel'),i=b('VideoCallingTour'),j=b('VideoCallPromo'),k=b('VideoCallTourDialog'),l=b('copyProperties'),m=b('setTimeoutAcrossTransitions'),n=60000,o=false,p=false,q=function(x,y){this._videoCallPromo=new j();this._videoCallTour=new k();this._threadID=x;this._tabMainElement=y;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function r(x,event,y){if(x._openDialog)x._openDialog.updatePosition();}function s(x){if(x._openDialog)x._openDialog.updatePosition();}function t(x){if(x._openDialog){x._openDialog.hide();x._openDialog=null;}if(x._timeout){clearTimeout(x._timeout);x._timeout=null;}while(x._subscriptionTokens.length)x._subscriptionTokens.pop().unsubscribe();if(x._scrollListener){x._scrollListener.remove();x._scrollListener=null;}}function u(x,event,y){if(y.thread_id===x._threadID){x._openDialog=y.dialog;o=true;w(x);x._timeout=m(x.destroy.bind(x,x._threadID),n);x._scrollListener=Event.listen(window,'scroll',s.curry(x));}}function v(x,y){if(!x._openDialog){x._subscriptionTokens.push(y.subscribe('chat/dialog-rendered',u.curry(x)));y.render(x._tabMainElement,x._threadID);}}function w(x){x._subscriptionTokens.push(h.subscribe('chat/tabs-changed',r.curry(x)),q.subscribe('dialog/close-all',t.curry(x)));}l(q,g);l(q.prototype,{destroy:function(){t(this);},tabFocused:function(){if(p){v(this,this._videoCallTour);return;}if(!o)v(this,this._videoCallPromo);},tabNotActive:function(){t(this);},hideVideoCallouts:function(){t(this);}});i.subscribe('videocallingtour/start',function(){p=true;q.inform('dialog/close-all');});i.subscribe('videocallingtour/end',function(){p=false;});e.exports=q;});
__d("ChatPrivacyActionController",["Arbiter","ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatVisibility'),i=b('JSLogger'),j=b('PresencePrivacy'),k=b('copyProperties'),l=function(m,n){this._userID=m;this._logger=i.create('blackbird');this._getState=function(){if(h.isOnline())return j.allows(this._userID)?l.NORMAL:l.BLOCKED;return l.OFFLINE;};this._togglePrivacy=function(){var o=this._getState();switch(this._getState()){case l.OFFLINE:if(h.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});h.goOnline(function(){if(!j.allows(this._userID)){if(this._getState()!==l.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case l.BLOCKED:j.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case l.NORMAL:j.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};(function(){var o=function(){n&&n(this._getState());}.bind(this);o();this._subscribeToken=j.subscribe('privacy-changed',o);}.bind(this)).defer();};l.OFFLINE='offline';l.BLOCKED='blocked';l.NORMAL='normal';k(l.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){j.unsubscribe(this._subscribeToken);}});e.exports=l;});
__d("MercuryAttachmentRenderer",["MercuryAttachmentTemplates","MercuryConstants","CSS","DOM","MercuryAttachment","MercuryMessages","MercuryParticipants","Style","URI","md5","tx"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentTemplates'),h=b('MercuryConstants'),i=b('CSS'),j=b('DOM'),k=b('MercuryAttachment'),l=b('MercuryMessages'),m=b('MercuryParticipants'),n=b('Style'),o=b('URI'),p=b('md5'),q=b('tx');function r(v,w){var x=g[w].build().setNodeContent('filename',v.name),y=x.getNode('link');y.setAttribute('href',v.url);v.rel&&y.setAttribute('rel',v.rel);i.addClass(x.getRoot(),k.getAttachIconClass(v.icon_type));return x;}function s(v,w){var x=g[w].build().setNodeContent('filename',v.name);i.addClass(x.getRoot(),k.getAttachIconClass(v.icon_type));return x;}function t(v){var w=h.SocialReportHoldout;if(!w)return false;var x=p(v.substring(5).toString());x=x.substring(w.start,w.start+w.length);x=parseInt(x,16);var y=w.buckets;return (((x%y)+y)%y)<w.limit;}var u={renderError:function(v){var w=g[':fb:mercury:attachment:error'].build();j.appendContent(w.getNode('error'),v.error_msg);return w.getRoot();},renderExternalLink:function(v){var w=g[':fb:mercury:attachment:external-link'].build().setNodeContent('name',v.name);v.base_url&&w.setNodeContent('shortLink',v.base_url);var x=w.getNode('preview'),y=w.getNode('image-link');y.setAttribute('href',v.url);v.rel&&y.setAttribute('rel',v.rel);if(v.preview_url){var z=w.getNode('preview-image');z.setAttribute('src',v.preview_url);i.addClass(x,v.preview_class);i.show(z);}else{i.addClass(w.getRoot(),'noMedia');i.hide(x);}w.getNode('name').setAttribute('href',v.url);d(['LinkshimHandler'],function(aa){aa.setUpLinkshimHandling(w.getNode('name'));aa.setUpLinkshimHandling(w.getNode('image-link'));});if(v.rel)w.getNode('name').setAttribute('rel',v.rel);return w.getRoot();},renderFileLink:function(v){var w=null;if(v.url===''){w=':fb:mercury:attachment:file-name';return s(v,w).getRoot();}else{w=':fb:mercury:attachment:file-link';return r(v,w).getRoot();}},renderExtendedFileLink:function(v){var w=null;if(v.url===''){w=':fb:mercury:attachment:file-name';return s(v,w).getRoot();}var w=':fb:mercury:attachment:extended-file-link',x=r(v,w);if(v.open_url){var y=x.getNode('openLinkContainer');i.show(y);var z=x.getNode('openFile');z.setAttribute('href',v.open_url);}var aa=x.getNode('downloadFile');aa.setAttribute('href',v.url);v.rel&&aa.setAttribute('rel',v.rel);return x.getRoot();},renderMusic:function(v){var w=g[':fb:mercury:attachment:music'].build().setNodeContent('filename',v.name),x=w.getNode('link');x.setAttribute('href',v.url);x.setAttribute('target','_blank');v.rel&&x.setAttribute('rel',v.rel);var y=w.getNode('preview');y.setAttribute('href',v.url);v.rel&&y.setAttribute('rel',v.rel);var z=w.getNode('preview-image');z.setAttribute('src',v.preview_url);i.show(z);i.addClass(w.getNode('icon_link'),'MercuryMusicIcon');return w.getRoot();},renderPreview:function(v,w,x,y,z,aa){var ba=g[':fb:mercury:attachment:preview'].build(),ca=ba.getNode('image-link'),da='';if(v){ca.setAttribute('href',v.url);v.rel&&ca.setAttribute('rel',v.rel);da=v.preview_url;if(x&&o(da).getPath()=='/ajax/messaging/attachment.php')da+=x;if(y)this.renderReportRespondLink(ba.getRoot(),v,y.message_id);i.addClass(ca,v.preview_class);}else{da='/images/blank.gif';i.addClass(ca,'imagePreview');i.addClass(ca,'thumbnail');}var ea=ba.getNode('preview-image');if(!w){if(!v){n.set(ea,'height','194px');n.set(ea,'width','194px');}}else{i.addClass(ea,'invisible_elem');ea.onload=function(){var fa=ea.offsetWidth,ga=ea.offsetHeight,ha,ia;if(fa>ga){n.set(ea,'maxHeight',w+'px');ia=Math.min(ga,w);ha=Math.ceil(fa*ia/ga);}else{n.set(ea,'maxWidth',w+'px');ha=Math.min(fa,w);ia=Math.ceil(ga*ha/fa);}n.set(ea,'marginTop','-'+(ia>>>1)+'px');n.set(ea,'marginLeft','-'+(ha>>>1)+'px');i.removeClass(ea,'invisible_elem');};}ea.setAttribute('src',da);return ba.getRoot();},renderMultiplePreviews:function(v){return this._renderMultiplePreviews(v,v.length);},renderMultipleThumbnails:function(v){return this._renderMultiplePreviews(null,v);},renderShareLink:function(v){var w=g[':fb:mercury:attachment:share-link'].build().setNodeContent('name',v.name),x=w.getNode('link');x.setAttribute('href',v.url);v.rel&&x.setAttribute('rel',v.rel);return w.getRoot();},renderVideoThumb:function(v){var w=g[':fb:mercury:attachment:video-thumb'].build(),x=w.getNode('thumb');x.setAttribute('href',v.url);x.setAttribute('rel',v.rel);var y=j.find(w.getRoot(),'img');y.src=v.preview_url;return w.getRoot();},_renderMultiplePreviews:function(v,w){var x='singleImagePreview',y=0;if(w==2||w==4){x='doubleImagePreview';y=194;}else if(w>1){x='multipleImagePreview';y=129;}var z=j.create('div',{className:'imagePreviews'});i.addClass(z,x);i.addClass(z,'clearfix');if(v){var aa='&numPreviews='+w;for(var ba=0;ba<w;++ba){var ca=this.renderPreview(v[ba],y,aa);j.appendContent(z,ca);}}else for(ba=0;ba<w;++ba){ca=this.renderPreview(null,y);j.appendContent(z,ca);}return z;},renderShareXHP:function(v,w){var x=j.create('div');if(v){var y=v.share_xhp;j.appendContent(x,y);this.renderReportRespondLink(x,v,w);}return x;},renderReportRespondLink:function(v,w,x){if(!w.is_social_report_attachment)return null;switch(w.share_data_type){case h.MercurySupportedShareType.FB_PHOTO:break;case h.MercurySupportedShareType.FB_SOCIAL_REPORT_PHOTO:return null;default:return null;}var y=null;if(x)y=l.getMessagesFromIDs([x])[0];if(!y)return null;if(y.author===m.user)return null;if(t(y.author))return null;var z=null;m.get(y.author,function(aa){z=j.create('a',{rel:'dialog-post',className:'SocialReportLink',id:'respond-link',ajaxify:o('/ajax/report/social_resolution/photo/').setQueryData({attachment_fbid:w.attach_id,photo_fbid:w.shared_object_id,sender_id:m.getUserID(aa.id)}).toString()});j.setContent(z,q._("Respond to {name}'s request",{name:aa.name}));j.appendContent(v,z);});}};e.exports=u;});
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryConstants","MercuryParticipants","MercuryServerRequests","MercuryThreads","TypingDetector","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryConstants'),j=b('MercuryParticipants'),k=b('MercuryServerRequests'),l=b('MercuryThreads'),m=b('TypingDetector'),n=b('setTimeoutAcrossTransitions'),o,p={},q=30000,r=new g();function s(x){var y=p[x]||{},z=Object.keys(y);z.sort(function(aa,ba){return y[aa]-y[ba];});return z;}function t(){o=null;var x=Date.now(),y={},z=false;for(var aa in p){var ba=false;for(var ca in p[aa]||{})if(p[aa][ca]<x-q){delete p[aa][ca];ba=true;}else z=true;if(ba)y[aa]=s(aa);}for(var da in y){r.inform('state-changed',y);break;}if(z)o=n(t,3000);}function u(x,y){if(x in p)if(y in p[x]){delete p[x][y];v(x);}}function v(x){var y={};y[x]=s(x);r.inform('state-changed',y);}function w(x){if(x.thread)return k.getClientThreadIDNow(x.thread);if(x.type==='typ')return l.getThreadIdForUser(x.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(x,y){var z=y.obj,aa=w(z);if(aa){var ba=j.getIDForUser(z.from);if(z.st==m.TYPING){p[aa]=p[aa]||{};var ca=p[aa][ba];p[aa][ba]=Date.now();if(!o)o=n(t,3000);!ca&&v(aa);}else if(z.st==m.INACTIVE)u(aa,ba);}});k.subscribe('update-typing-state',function(x,y){var z=y.payload_source;if(z!=i.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE)return;var aa=y.actions;if(!aa||!aa.length)return;var ba=i.MercuryActionType.USER_GENERATED_MESSAGE;aa.forEach(function(ca){if(ca.action_type==ba&&ca.author!=j.user)u(ca.thread_id,ca.author);});});e.exports=r;});
__d("ChatTabIndicatorController",["date-extensions","ArbiterMixin","DOM","MercuryConfig","MercuryConstants","MercuryDelayedRoger","MercuryParticipants","MercuryRoger","MercuryThreads","MercuryTypingReceiver","copyProperties","tx"],function(a,b,c,d,e,f){b('date-extensions');var g=b('ArbiterMixin'),h=b('DOM'),i=b('MercuryConfig'),j=b('MercuryConstants'),k=b('MercuryDelayedRoger'),l=b('MercuryParticipants'),m=b('MercuryRoger'),n=b('MercuryThreads'),o=b('MercuryTypingReceiver'),p=b('copyProperties'),q=b('tx'),r=[];function s(t){this._threadID=t;this._canonicalUser=n.getCanonicalUserInThread(t);r.push(this);}p(s.prototype,g,{destroy:function(){r.remove(this);},setLastMessage:function(t){this._lastMsg=t;this._handleStateChange();},_informStateChanged:function(t){if(t.activity=='none'&&this._currentActivity=='none')return;this._currentActivity=t.activity;this.inform('state-changed',t);},_notifySentFrom:function(){var t=j.MercurySourceType,u,v,w=this._lastMsg.location_text;if(w){u=q._("Sent from {location}",{location:w});v='sentFromMobile';}else switch(this._lastMsg.source){case t.CHAT_ORCA:case t.TITAN_ORCA:u=h.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},"Sent from Messenger");v='sentFromMobile';break;case t.MOBILE:case t.CHAT_IPHONE:case t.TITAN_API_MOBILE:case t.TITAN_WAP:u=h.create('a',{href:'/mobile','class':'fcg',target:'_blank'},"Sent from Mobile");v='sentFromMobile';break;case t.EMAIL:case t.TITAN_EMAIL_REPLY:u="Sent from email";v='sentFromEmail';break;default:this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:v,text:u});},_notifySeenTimestamp:function(t){var u=m.getSeenTimestamp(this._threadID,t[0])*.001,v=Date.now()*.001,w=i['24h_times']?'H:i':'g:i A';if(u<v-518400){w='M j';}else if(u<v-86400)w='D '+w;var x=Date.format(w,u);this._informStateChanged({activity:'seen-timestamp',text:q._("Seen {timestamp}",{timestamp:x})});},_notifySeenBy:function(t){var u=this._lastMsg,v=true;l.getMulti(t,function(w){v=false;if(this._lastMsg!=u)return;var x=n.getThreadMetaNow(this._threadID),y=x?x.participants.length:0,z=t.length+(u.author!=l.user),aa,ba=false;if(y>2&&z>=y-1){aa="Seen by everyone";}else if(t.length==1){aa=q._("Seen by {user}",{user:w[t[0]].short_name});}else if(t.length==2){aa=q._("Seen by {user1}, {user2}",{user1:w[t[0]].short_name,user2:w[t[1]].short_name});}else if(t.length==3){aa=q._("Seen by {user1}, {user2}, {user3}",{user1:w[t[0]].short_name,user2:w[t[1]].short_name,user3:w[t[2]].short_name});}else if(t.length>3){var ca=Object.keys(w).length-2,da=q._("{num} more",{num:ca}),ea=h.create('span',{className:'more'},da);aa=h.tx._("Seen by {user1}, {user2}, {=num more link}",{user1:w[t[0]].short_name,user2:w[t[1]].short_name,'=num more link':ea});ba=true;}this._informStateChanged({activity:'seen-by',text:aa,seenBy:t,tooltip:ba});}.bind(this));v&&this._informStateChanged({activity:'none'});},_notifyTyping:function(t){var u=this._lastMsg,v=true;l.getMulti(t,function(w){v=false;if(this._lastMsg!=u)return;if(this._canonicalUser||i.ChatMultiTypGK){var x=n.getThreadMetaNow(this._threadID),y=x?x.participants.length:0,z,aa=false;if(y>2&&t.length>=y-1){z="Everyone is typing...";}else if(t.length==1){z=q._("{name} is typing...",{name:w[t[0]].short_name});}else if(t.length==2){z=q._("{user1} and {user2} are typing...",{user1:w[t[0]].short_name,user2:w[t[1]].short_name});}else if(t.length==3){z=q._("{user1}, {user2}, and {user3} are typing...",{user1:w[t[0]].short_name,user2:w[t[1]].short_name,user3:w[t[2]].short_name});}else if(t.length>3){var ba=Object.keys(w).length-2,ca=q._("{num} more",{num:ba}),da=h.create('a',{href:'#'},ca);z=h.tx._("{user1}, {user2}, and {=num more link} are typing...",{user1:w[t[0]].short_name,user2:w[t[1]].short_name,'=num more link':da});aa=true;}this._informStateChanged({activity:'typing',text:z,typing:t,tooltip:aa});}}.bind(this));v&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var t=j.MercuryActionType.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==t){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=l.user){this._notifySentFrom();return;}var u=k.getSeenBy(this._threadID,true);if(u.length)if(this._canonicalUser){this._notifySeenTimestamp(u);return;}else{this._notifySeenBy(u);return;}this._informStateChanged({activity:'none'});}});o.subscribe('state-changed',function(t,u){r.forEach(function(v){var w=u[v._threadID];if(w!==undefined){v._typing=w;v._handleStateChange();}});});k.subscribe('state-changed',function(t,u){r.forEach(function(v){u[v._threadID]&&v._handleStateChange();});});e.exports=s;});
__d("ChatTabIndicatorLine",["ChatTabIndicatorController","CSS","DOM","DOMQuery","MercuryParticipants","Tooltip","copyProperties","csx"],function(a,b,c,d,e,f){var g=b('ChatTabIndicatorController'),h=b('CSS'),i=b('DOM'),j=b('DOMQuery'),k=b('MercuryParticipants'),l=b('Tooltip'),m=b('copyProperties'),n=b('csx');function o(p,q,r){this._typingIndicator=q;this._messagesView=r;this._controller=new g(p);this._subscription=this._controller.subscribe('state-changed',this._handleStateChanged.bind(this));}m(o.prototype,{destroy:function(){this._setClass(null);this._subscription.unsubscribe();this._controller.destroy();},setLastMessage:function(p){this._controller.setLastMessage(p);},_handleStateChanged:function(p,q){var r=this._messagesView.isScrolledToBottom();this._rerender(q);r&&this._messagesView.scrollToBottom();},_rerender:function(p){if(p.activity=='none'){this._setClass(null);return;}var q=i.find(this._typingIndicator,"._9q");if(p.text){i.setContent(q,p.text);}else i.empty(q);if(p.activity.substring(0,4)=='seen'){this._setClass('seen');if(p.activity=='seen-by'&&p.tooltip)k.getMulti(p.seenBy,function(r){var s=i.create('div'),t=0;for(var u in r)if(t++>=2){var v=i.create('div');i.setContent(v,r[u].name);i.appendContent(s,v);}var w=j.find(this._typingIndicator,'span.more');l.set(w,s,'above','center');}.bind(this));}else this._setClass(p.activity);},_setClass:function(p){if(this._lastClass===p)return;this._lastClass&&h.removeClass(this._typingIndicator,this._lastClass);p&&h.addClass(this._typingIndicator,p);this._lastClass=p;}});e.exports=o;});
__d("MercuryMessageRenderer",["MercuryAttachmentRenderer","MercuryConstants","CSS","DOM","DOMQuery","HTML","MercuryEmoji","MercuryParticipants","Tooltip","htmlHyperlink","tx"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentRenderer'),h=b('MercuryConstants'),i=b('CSS'),j=b('DOM'),k=b('DOMQuery'),l=b('HTML'),m=b('MercuryEmoji'),n=b('MercuryParticipants'),o=b('Tooltip'),p=b('htmlHyperlink'),q=b('tx'),r=["January","February","March","April","May","June","July","August","September","October","November","December"],s={renderDate:function(ja){var ka=new Date();ka.setHours(0);ka.setMinutes(0);ka.setSeconds(0);ka.setMilliseconds(0);var la=24*60*60*1000,ma=ka.getTime()-ja.getTime();if(ma<=0){return "Today";}else if(ma<la)return "Yesterday";var na=r[ja.getMonth()],oa=ja.getDate(),pa=ja.getFullYear();if(pa!=ka.getFullYear()){return q._("{month} {date}, {year}",{month:na,date:oa,year:pa});}else return q._("{month} {date}",{month:na,date:oa});},renderTooltipFlyout:function(ja,ka){ka.forEach(function(la){var ma=j.create('div');j.setContent(ma,la.name);j.appendContent(ja,ma);});},renderLogMessage:function(ja,ka,la,ma){v(ja,ma);w(ka,ma);x(la,ma);},formatMessageBody:function(ja,ka,la){var ma=(ja||'').replace(/\s+$/,'');if(!ka)return u(ma,false,la);var na=Object.keys(ka).map(function(qa){return window.parseInt(qa);}).sort(function(qa,ra){return qa-ra;}),oa=[],pa=0;na.forEach(function(qa){var ra=ma.slice(pa,qa);if(ra)oa.push(u(ra,false,la));pa=qa+ka[qa].length;var sa=ma.slice(qa,pa);if(sa)oa.push(u(sa,true,la));});if(pa<ma.length)oa.push(u(ma.slice(pa),false,la));return oa.length===0?null:oa.length===1?oa[0]:j.create('span',{},oa);}};function t(ja,ka){var la=ja.replace(/\r\n?/g,'\n').split(/\n{2,}/),ma=[];for(var na=0;na<la.length;na++){var oa=la[na];if(oa.length){ma.push('<p>');ma.push(ka(oa));ma.push('</p>');}}return ma.join('');}function u(ja,ka,la){var ma=null;if(ja.length===0&&!ka)return ma;function na(oa){return p(oa,m.htmlEmojiAndEmote,null,true);}ma=la?t(ja,na):na(ja);if(ka)return j.create('span',{className:'highlight'},l(ma));return l(ma);}function v(ja,ka){var la='',ma;switch(ka.log_message_type){case h.MercuryLogMessageType.SUBSCRIBE:la='mercurySubscribeIcon';break;case h.MercuryLogMessageType.UNSUBSCRIBE:la='mercuryUnsubscribeIcon';break;case h.MercuryLogMessageType.THREAD_NAME:la='mercuryThreadNameIcon';break;case h.MercuryLogMessageType.THREAD_IMAGE:la='mercuryThreadImageIcon';break;case h.MercuryLogMessageType.VIDEO_CALL:ma=ka.log_message_data.answered;if(ma||ia(ka)){la='mercuryVideoCallIcon';}else la='mercuryMissedVideoCallIcon';break;case h.MercuryLogMessageType.PHONE_CALL:ma=ka.log_message_data.answered;if(ma){la='mercuryPhoneCallIcon';}else la='mercuryMissedPhoneCallIcon';break;case h.MercuryLogMessageType.SERVER_ERROR:la='mercuryErrorIcon';break;}i.addClass(ja,la);}function w(ja,ka){switch(ka.log_message_type){case h.MercuryLogMessageType.SUBSCRIBE:fa(ja,ka);break;case h.MercuryLogMessageType.UNSUBSCRIBE:ga(ja,ka);break;case h.MercuryLogMessageType.VIDEO_CALL:if(ia(ka)){y(ja,ka);}else aa(ja,ka);break;case h.MercuryLogMessageType.PHONE_CALL:z(ja,ka);break;case h.MercuryLogMessageType.THREAD_NAME:ba(ja,ka);break;case h.MercuryLogMessageType.THREAD_IMAGE:ca(ja,ka);break;case h.MercuryLogMessageType.SERVER_ERROR:ha(ja,ka);break;}}function x(ja,ka){var la=ka.log_message_type;if(la==h.MercuryLogMessageType.THREAD_IMAGE){var ma=ka.log_message_data.image;if(ma){if(ma.preview_url){j.setContent(ja,g.renderPreview(ma));}else j.setContent(ja,g.renderPreview());i.show(ja);}}}var y=function(ja,ka){n.get(ka.author,function(la){var ma=la.short_name,na;switch(ka.log_message_data.event_name){case 'installing':na=j.tx._("{firstname} is setting up video calling...",{firstname:ma});break;case 'installed':na=j.tx._("{firstname} finished setting up video calling.",{firstname:ma});break;case 'install_canceled':na=j.tx._("You canceled the video calling installation. ",{firstname:ma});break;}if(na)j.setContent(ja,na);});},z=function(ja,ka){var la=ka.log_message_data.caller,ma=ka.log_message_data.callee,na=[la,ma];n.getMulti(na,function(oa){if(la==n.user){var pa=oa[ma].short_name,qa;if(ka.log_message_data.answered){qa=j.tx._("You called {firstname}.",{firstname:pa});}else qa=j.tx._("{firstname} missed a call from you. ",{firstname:pa});}else{var ra=oa[la].short_name;if(ka.log_message_data.answered){qa=j.tx._("{firstname} called you.",{firstname:ra});}else qa=j.tx._("You missed a call from {firstname}. ",{firstname:ra});}j.setContent(ja,qa);});},aa=function(ja,ka){var la=ka.log_message_data.caller,ma=ka.log_message_data.callee,na=[la,ma];n.getMulti(na,function(oa){if(la==n.user){var pa=oa[ma].short_name,qa;if(ka.log_message_data.answered){qa=j.tx._("You called {firstname}.",{firstname:pa});}else qa=j.tx._("{firstname} missed a call from you. ",{firstname:pa});}else{var ra=oa[la].short_name;if(ka.log_message_data.answered){qa=j.tx._("{firstname} called you.",{firstname:ra});}else qa=j.tx._("You missed a call from {firstname}. ",{firstname:ra});}j.setContent(ja,qa);});},ba=function(ja,ka){var la=ka.log_message_data.name,ma=j.create('b',{},la);if(ka.author==n.user){if(la){j.setContent(ja,j.tx._("You named the conversation: {name}.",{name:ma}));}else j.setContent(ja,j.tx._("You removed the conversation name."));}else n.get(ka.author,function(na){var oa,pa=da(na);if(la){oa=j.tx._("{actor} named the conversation: {name}.",{actor:pa,name:ma});}else oa=j.tx._("{actor} removed the conversation name.",{actor:pa});j.setContent(ja,oa);});},ca=function(ja,ka){if(ka.author==n.user){if(ka.log_message_data.image){j.setContent(ja,j.tx._("You changed the conversation picture."));}else j.setContent(ja,j.tx._("You removed the conversation picture."));}else n.get(ka.author,function(la){var ma=da(la),na;if(ka.log_message_data.image){na=j.tx._("{actor} changed the conversation picture.",{actor:ma});}else na=j.tx._("{actor} removed the conversation picture.",{actor:ma});j.setContent(ja,na);});},da=function(ja){if(ja.href)return j.create('a',{href:ja.href},ja.name);return ja.name;},ea=function(ja){var ka=ja.indexOf(n.user);if(ka>0)return ja.splice(ka,1).concat(ja);return ja;},fa=function(ja,ka){var la=ea(ka.log_message_data.added_participants),ma=null,na;if(la.length==1){ma=[ka.author,la[0]];n.getMulti(ma,function(oa){if(ka.author==n.user){na=j.tx._("You added {subscriber1}.",{subscriber1:da(oa[la[0]])});}else if(la[0]==n.user){na=j.tx._("{actor} added you.",{actor:da(oa[ka.author])});}else na=j.tx._("{actor} added {subscriber1}.",{actor:da(oa[ka.author]),subscriber1:da(oa[la[0]])});j.setContent(ja,na);});}else if(la.length==2){ma=[ka.author].concat(la);n.getMulti(ma,function(oa){if(ka.author==n.user){na=j.tx._("You added {subscriber1} and {subscriber2}.",{subscriber1:da(oa[la[0]]),subscriber2:da(oa[la[1]])});}else if(la[0]==n.user){na=j.tx._("{actor} added you and {subscriber2}.",{actor:da(oa[ka.author]),subscriber2:da(oa[la[1]])});}else na=j.tx._("{actor} added {subscriber1} and {subscriber2}.",{actor:da(oa[ka.author]),subscriber1:da(oa[la[0]]),subscriber2:da(oa[la[1]])});j.setContent(ja,na);});}else if(la.length==3){ma=[ka.author].concat(la);n.getMulti(ma,function(oa){if(ka.author==n.user){na=j.tx._("You added {subscriber1}, {subscriber2} and {subscriber3}.",{subscriber1:da(oa[la[0]]),subscriber2:da(oa[la[1]]),subscriber3:da(oa[la[2]])});}else if(la[0]==n.user){na=j.tx._("{actor} added you, {subscriber2} and {subscriber3}.",{actor:da(oa[ka.author]),subscriber2:da(oa[la[1]]),subscriber3:da(oa[la[2]])});}else na=j.tx._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",{actor:da(oa[ka.author]),subscriber1:da(oa[la[0]]),subscriber2:da(oa[la[1]]),subscriber3:da(oa[la[2]])});j.setContent(ja,na);});}else{ma=[ka.author].concat(la);n.getMulti(ma,function(oa){var pa=j.tx._("{num} more",{num:la.length-2}),qa=j.create('span',{className:'more'},pa),ra=j.create('div');s.renderTooltipFlyout(ra,la.slice(2).map(function(ta){return oa[ta];}));if(ka.author==n.user){na=j.tx._("You added {subscriber1}, {subscriber2} and {more_people}.",{subscriber1:da(oa[la[0]]),subscriber2:da(oa[la[1]]),more_people:qa});}else if(la[0]==n.user){na=j.tx._("{actor} added you, {subscriber2} and {more_people}.",{actor:da(oa[ka.author]),subscriber2:da(oa[la[1]]),more_people:qa});}else na=j.tx._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",{actor:da(oa[ka.author]),subscriber1:da(oa[la[0]]),subscriber2:da(oa[la[1]]),more_people:qa});j.setContent(ja,na);var sa=k.find(ja,'span.more');o.set(sa,ra,'above','center');});}},ga=function(ja,ka){n.get(ka.author,function(la){var ma;if(ka.author==n.user){ma=j.tx._("You left the conversation.");}else ma=j.tx._("{actor} left the conversation.",{actor:da(la)});j.setContent(ja,ma);});},ha=function(ja,ka){var la="We were unable to fetch previous messages in this conversation.";j.setContent(ja,la);},ia=function(ja){return ja.log_message_data.event_name==='installing'||ja.log_message_data.event_name==='install_canceled';};e.exports=s;});
__d("ChatTabMessagesView",["date-extensions","event-extensions","Arbiter","ArbiterMixin","MercuryAttachmentRenderer","ChannelConstants","ChatConfig","ChatTabIndicatorLine","ChatVisibility","MercuryConfig","MercuryConstants","CSS","DOM","Env","MercuryMessages","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreads","MercuryMessageRenderer","MercuryParticipants","ChatTabTemplates","MercuryThreadInformer","Tooltip","VideoCallCore","copyProperties","isRTL","throttle","tx"],function(a,b,c,d,e,f){b('date-extensions');b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('MercuryAttachmentRenderer'),j=b('ChannelConstants'),k=b('ChatConfig'),l=b('ChatTabIndicatorLine'),m=b('ChatVisibility'),n=b('MercuryConfig'),o=b('MercuryConstants'),p=b('CSS'),q=b('DOM'),r=b('Env'),s=b('MercuryMessages'),t=b('MercuryThreadMetadataRawRenderer'),u=b('MercuryThreadMetadataRenderer'),v=b('MercuryThreads'),w=b('MercuryMessageRenderer'),x=b('MercuryParticipants'),y=b('ChatTabTemplates'),z=b('MercuryThreadInformer'),aa=b('Tooltip'),ba=b('VideoCallCore'),ca=b('copyProperties'),da=b('isRTL'),ea=b('throttle'),fa=b('tx');function ga(pa){return Date.format(k.get('24h_times')?'H:i':'g:ia',pa/1000);}function ha(pa){var qa=y[':fb:chat:conversation:message-group'].build();qa.setNodeContent('timestamp',ga(pa.timestamp));x.get(pa.author,function(ra){var sa=qa.getNode('profileLink');sa.href=ra.href;var ta=ra.fbid==r.user?"You":ra.name;aa.set(sa,ta,'left');qa.setNodeProperty('profilePhoto','src',ra.image_src);});return qa;}function ia(pa){var qa=y[':fb:chat:conversation:message:event'].build();qa.setNodeContent('timestamp',ga(pa.timestamp));w.renderLogMessage(qa.getNode('icon'),qa.getNode('message'),qa.getNode('attachment'),pa);var ra=ja(pa);if(ra)q.appendContent(qa.getNode('message'),ra);return qa.getRoot();}function ja(pa){var qa,ra;if(pa.log_message_type==o.MercuryLogMessageType.VIDEO_CALL)if(pa.log_message_data.event_name=='install_canceled'){qa=q.tx._("Retry setup and call back.");ra='callback_cancelinstall_link';return ka(qa,pa.thread_id,pa.log_message_data.to,ra);}else if(!pa.log_message_data.event_name&&pa.log_message_data.callee==x.user&&!pa.log_message_data.answered){qa=q.tx._("Call Back");ra='callback_link';return ka(qa,pa.thread_id,pa.log_message_data.caller.split(':')[1],ra);}return null;}function ka(pa,qa,ra,sa){if(ba.isSupported()){var ta=!m.isOnline()||!ba.availableForCall(ra),ua=q.create('a',{href:'#',className:'callBackLink'},pa);if(ta)p.hide(ua);ua.setAttribute('data-gt',JSON.stringify({videochat:'clicked_callback_link'}));Event.listen(ua,'click',function(){na.inform('video-call-clicked',{userID:ra,threadID:qa,clickSource:sa});});return ua;}return null;}function la(pa){var qa=y[':fb:mercury:chat:message:forward'].build(),ra=qa.getNode('forwardText');if(ra){p.hide(qa.getRoot());u.renderTitanLink(pa.thread_id,qa.getNode('forwardLink'),p.show.bind(p,qa.getRoot()));if(pa.forward_count>1){q.appendContent(ra,fa._("{count} forwarded messages",{count:pa.forward_count}));}else q.appendContent(ra,"1 forwarded message");}return qa.getRoot();}var ma=[];function na(pa,qa,ra,sa,ta,ua){this.loadingIcon=ta;this.threadID=pa;this.sheetController=qa;this.scrollContainer=ra;this.conversationElem=sa;this.messageElements={};this.messageGroup=null;this.prevMessage=null;this._fetchMultiplier=1;this._oldestMessageDisplayedTimestamp=null;this._loadingMoreMessages=false;this._currentMessageCount=0;this._hasReachedClearedMessages=false;var va=o.MercuryThreadlistConstants.MESSAGE_TIMESTAMP_THRESHOLD;this._oldestMessageDisplayedTimestamp=Date.now()-va;ma.push(this);this._subscription=g.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this));Event.listen(this.scrollContainer,'scroll',ea(this.scrolling,50,this));if(ua)this.indicatorLine=new l(this.threadID,ua,this);var wa=n.InfiniteScrollChatTabGK?this._updateTimestamp.bind(this):function(){};s.getThreadMessagesRange(this.threadID,0,o.MercuryThreadlistConstants.RECENT_MESSAGES_LIMIT,wa);this.rerender();}ca(na,h);ca(na.prototype,{scrolling:function(){if(n.InfiniteScrollChatTabGK&&!this._loadingMoreMessages&&this.isScrolledNearTop()&&!this.isScrolledToBottom()&&!this._hasReachedClearedMessages)this.loadMoreMessages();if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},destroy:function(){q.empty(this.conversationElem);this._subscription.unsubscribe();ma.remove(this);this.indicatorLine&&this.indicatorLine.destroy();this.destroyed=true;},_appendMessage:function(pa){if(pa==this.prevMessage)return;var qa=o.MercuryThreadlistConstants,ra=qa.GROUPING_THRESHOLD,sa=pa.action_type==o.MercuryActionType.LOG_MESSAGE&&pa.log_message_type==o.MercuryLogMessageType.SERVER_ERROR;if(pa.is_cleared){this._hasReachedClearedMessages=true;return;}var ta=null;if(this.prevMessage)ta=new Date(this.prevMessage.timestamp);var ua=new Date(pa.timestamp);if(!sa&&(!ta||ta.getDate()!=ua.getDate()||ta.getMonth()!=ua.getMonth()||ta.getFullYear()!=ua.getFullYear())){var va=y[':fb:chat:conversation:date-break'].build();q.setContent(va.getRoot(),w.renderDate(ua));q.appendContent(this.conversationElem,va.getRoot());this.messageGroup=null;}if(pa.action_type==o.MercuryActionType.LOG_MESSAGE){q.appendContent(this.conversationElem,ia(pa));this.messageGroup=null;this.prevMessage=pa;return;}if(!this.messageGroup||this.prevMessage.author!=pa.author||this.prevMessage.timestamp<pa.timestamp-ra){this.messageGroup=ha(pa);q.appendContent(this.conversationElem,this.messageGroup.getRoot());}var wa=this._renderSingleMessage(pa);this.messageElements[pa.message_id]=wa;q.appendContent(this.messageGroup.getNode('messages'),wa);this.prevMessage=pa;},rerender:function(){if(!this._oldestMessageDisplayedTimestamp)return;var pa=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollHeight,qa=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollTop,ra=this.isScrolledToBottom();q.empty(this.conversationElem);this.messageElements={};this.messageGroup=null;this.prevMessage=null;var sa=s.getThreadMessagesSinceTimestamp(this.threadID,this._oldestMessageDisplayedTimestamp);this._renderOlderMessages(sa,pa,qa,ra);this._finishedFetchingMoreMessages=false;},update:function(pa){for(var qa in pa){var ra=this.messageElements[qa];if(ra){var sa=this.isScrolledToBottom(),ta=this._renderSingleMessage(s.getMessagesFromIDs([qa])[0]);this.messageElements[qa]=ta;q.replace(ra,ta);if(sa)this.scrollToBottom();}}},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_appendMessages:function(pa){pa.forEach(this._appendMessage.bind(this));this.indicatorLine&&this.indicatorLine.setLastMessage(this.prevMessage);this.sheetController.displayMessengerPromoTabSheet(this.prevMessage);},_appendNewMessages:function(pa){var qa=this.isScrolledToBottom();this._appendMessages(pa);if(qa){this.scrollToBottom();}else{this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}},_renderOlderMessages:function(pa,qa,ra,sa){if(!pa)return;this._appendMessages(pa);if(sa){this.scrollToBottom();}else if(this._finishedFetchingMoreMessages)this.scrollToPosition(this.scrollContainer.scrollHeight-qa-this.loadingHeight+ra);},_updateTimestamp:function(pa){if(pa&&pa.length){this._oldestMessageDisplayedTimestamp=pa[0].timestamp;this._currentMessageCount=pa.length;}this._loadingMoreMessages=false;this._finishedFetchingMoreMessages=true;p.hide(this.loadingIcon);},isScrolledToBottom:function(){var pa=this.scrollContainer;return pa.scrollTop+pa.clientHeight>=pa.scrollHeight-1;},isScrolledNearTop:function(){return this.scrollContainer.scrollTop<this.scrollContainer.clientHeight;},scrollToBottom:function(){this.scrollToPosition(this.scrollContainer.scrollHeight);},scrollToPosition:function(pa){this.scrollContainer.scrollTop=pa;},loadMoreMessages:function(){if(s.hasLoadedExactlyNMessages(this.threadID,this._currentMessageCount)&&s.hasLoadedAllMessages(this.threadID))return;p.show(this.loadingIcon);this.loadingHeight=this._getLoadingHeight();this._loadingMoreMessages=true;if(this._fetchMultiplier<10)this._fetchMultiplier+=1;var pa=o.MercuryThreadlistConstants.RECENT_MESSAGES_LIMIT*this._fetchMultiplier,qa=this._currentMessageCount+pa,ra=s.hasLoadedNMessages(this.threadID,qa);s.getThreadMessagesRange(this.threadID,0,qa,this._updateTimestamp.bind(this),null,o.MercuryAPIArgsSource.CHAT);if(ra)this.rerender();},_renderSingleMessage:function(pa){var qa=y[':fb:chat:conversation:message'].render();if(pa.subject){var ra=y[':fb:chat:conversation:message:subject'].render();q.setContent(ra,pa.subject);q.appendContent(qa,ra);}if(pa.body.substr(0,4)=='?OTR'){q.setContent(qa,"[encrypted message]");p.addClass(qa,'cyphertext');}else{p.addClass(qa,da(pa.body)?'direction_rtl':'direction_ltr');q.appendContent(qa,w.formatMessageBody(pa.body));}if(pa.has_attachment)this._appendMessageAttachments(qa,pa);if(pa.forward_count)q.appendContent(qa,la(pa));if(pa.is_spoof_warning){var sa=y[':fb:chat:conversation:message:undertext'].build();q.appendContent(sa.getNode('message'),qa);x.get(pa.author,function(va){u.renderChatSpoofWarning(sa.getNode('status'),pa.is_spoof_warning,va);});return sa.getRoot();}var ta=t.renderStatusIndicator(pa.status,s.resendMessage.shield(s,pa));if(ta){p.addClass(qa,'errorStatus');var ua=y[':fb:chat:conversation:message:status'].build();q.appendContent(ua.getNode('message'),qa);q.appendContent(ua.getNode('status'),ta);return ua.getRoot();}return qa;},_appendMessageAttachments:function(pa,qa){var ra=o.MercuryAttachmentType,sa=qa.attachments;for(var ta=0,ua=sa.length;ta<ua;++ta){var va=sa[ta],wa=va.attach_type,xa=va.share_data_type;if(wa==ra.ERROR)q.appendContent(pa,i.renderError(va));if(wa==ra.FILE)q.appendContent(pa,i.renderFileLink(va));var ya=null,za,ab=o.MercurySupportedShareType.FB_SOCIAL_REPORT_PHOTO;if(wa==ra.SHARE&&xa==o.MercurySupportedShareType.FB_VIDEO){ya=i.renderVideoThumb(va);za=q.find(ya,'img');Event.listen(za,'load',this._thumbLoaded.shield(this,za));}else if(wa==ra.SHARE&&(xa==o.MercurySupportedShareType.FB_MUSIC_ALBUM||xa==o.MercurySupportedShareType.FB_SONG)){ya=i.renderMusic(va);za=q.find(ya,'img');Event.listen(za,'load',this._thumbLoaded.shield(this,za));}else if(wa==ra.SHARE&&(xa==o.MercurySupportedShareType.EXTERNAL||xa==o.MercurySupportedShareType.FB_TEMPLATE||xa==o.MercurySupportedShareType.FB_COUPON)){ya=i.renderExternalLink(va);za=q.find(ya,'img');Event.listen(za,'load',this._thumbLoaded.shield(this,za));}else if(xa==ab){ya=i.renderExternalLink(va);za=q.find(ya,'img');Event.listen(za,'load',this._thumbLoaded.shield(this,za));}else if(va.preview_url){x.get(qa.author,function(bb){var cb=x.getUserID(bb.id);ya=i.renderPreview(va,0,null,qa,bb,cb);za=q.find(ya,'img');Event.listen(za,'load',this._thumbLoaded.shield(this,za));}.bind(this));}else if(wa==ra.SHARE)ya=i.renderShareLink(va);if(ya)q.appendContent(pa,ya);}},_thumbLoaded:function(pa){var qa=this.scrollContainer.scrollTop+this.scrollContainer.clientHeight;if(qa+pa.offsetHeight>=this.scrollContainer.scrollHeight)this.scrollToBottom();}});z.subscribe('messages-reordered',function(pa,qa){ma.forEach(function(ra){qa[ra.threadID]&&ra.rerender();});});z.subscribe('messages-updated',function(pa,qa){ma.forEach(function(ra){qa[ra.threadID]&&ra.update(qa[ra.threadID]);});});z.subscribe('messages-received',function(pa,qa){ma.forEach(function(ra){var sa=qa[ra.threadID];if(n.InfiniteScrollChatTabGK&&sa&&sa.length)ra._currentMessageCount+=sa.length;sa&&ra._appendNewMessages(sa);});});g.subscribe(j.getArbiterType('chat_event'),function(pa,qa){if(oa(qa.obj)){var ra=(r.user==qa.obj.from)?qa.obj.to:qa.obj.from,sa=v.getThreadIdForUser(ra),ta=ma.filter(function(wa){return wa.threadID===sa;});if(ta.length>0){var ua=ta[0],va=s.constructLogMessageObject(o.MercurySourceType.CHAT_WEB,sa,o.MercuryLogMessageType.VIDEO_CALL,qa.obj);va.author='fbid:'+qa.obj.from;ua._appendNewMessages([va]);}}});function oa(pa){return (pa.event_name==='installing'||pa.event_name==='install_canceled');}e.exports=na;});
__d("MercuryTypeahead",["event-extensions","ArbiterMixin","DOM","Input","MercuryTypeaheadTemplates","Tokenizer","Typeahead","TypeaheadCore","copyProperties","cx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('DOM'),i=b('Input'),j=b('MercuryTypeaheadTemplates'),k=b('Tokenizer'),l=b('Typeahead'),m=b('TypeaheadCore'),n=b('copyProperties'),o=b('cx'),p=function(q,r){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._dataSource=q;this._view=r;};n(p.prototype,g);n(p.prototype,{setPlaceholder:function(q){this._placeholder=q;return this;},setExcludedParticipants:function(q){this._exclusions=[];q.forEach(function(r){var s=r.indexOf(':');if(r.substr(0,s)=='fbid')this._exclusions.push(r.substr(s+1));}.bind(this));return this;},setViewNodeID:function(q){this._viewNodeOrID=q;},setViewNode:function(q){this._viewNodeOrID=q;},setFullWidthView:function(q){var r=h.create('div',{className:"_4ck uiTypeaheadView"});h.setContent(q,r);this.setViewNode(r);},setViewOption:function(q,r){this._viewOptions[q]=r;},addTokenizerBehavior:function(q){this._tokenizerBehaviors.push(q);},build:function(q){if(this._domElement)return;var r=j[':fb:mercury:tokenizer'].build(),s=j[':fb:mercury:typeahead'].build();this._domElement=r.getRoot();h.appendContent(this._domElement,s.getRoot());var t=s.getNode('textfield');i.setPlaceholder(t,this._placeholder);t.setAttribute('data-placeholder',this._placeholder);var u={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},v={ctor:m,options:{setValueOnSelect:true}};this._typeahead=new l(this._dataSource,u,v,s.getRoot());this._typeahead.init();var w={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new k(this._domElement,this._typeahead);this._tokenizer.init(r.getNode('tokenarea'),'participants',[],w);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],function(){this.inform('tokens-changed');}.bind(this));Event.listen(t,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));Event.listen(this._domElement,'click',this.focus.bind(this));},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var q=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(r){q.push('fbid:'+r);});return q;},getTokens:function(){var q=[];if(this._tokenizer)q=this._tokenizer.getTokens();return q;},getTokenizer:function(){return this._tokenizer;},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);}});e.exports=p;});
__d("ChatAddFriendsTabSheetRawRenderer",["event-extensions","ContextualTypeaheadView","DOM","MercuryTypeahead","ChatTabTemplates","tx","MercuryDataSourceWrapper"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ContextualTypeaheadView'),h=b('DOM'),i=b('MercuryTypeahead'),j=b('ChatTabTemplates'),k=b('tx'),l=b('MercuryDataSourceWrapper').source,m={render:function(n,o,p,q,r){var s=j[':fb:mercury:chat:tab-sheet:add-friends'].build(),t=new i(l,g);t.setExcludedParticipants(q.participants);t.setPlaceholder("Enter a friend's name");t.build();h.replace(s.getNode('participantsTypeahead'),t.getElement());h.setContent(p,s.getRoot());t.focus();var u=function(){var v=t.getSelectedParticipantIDs();if(v.length)r(v);o.close(n);};Event.listen(s.getNode('doneButton'),'click',u);}};e.exports=m;});
__d("ChatTabSheetPolicy",[],function(a,b,c,d,e,f){var g={canReplaceOpenSheet:function(h,i){if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;});
__d("ChatTabSheetView",["event-extensions","Animation","ChatTabSheetPolicy","CSS","DOM","Style","ChatTabTemplates","Vector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('ChatTabSheetPolicy'),i=b('CSS'),j=b('DOM'),k=b('Style'),l=b('ChatTabTemplates'),m=b('Vector'),n=b('copyProperties'),o=5000,p=function(q,r,s){this._threadID=q;this._rootElement=r;this._tabMainElement=s;this._openSheet=null;};n(p.prototype,{destroy:function(){j.empty(this._rootElement);},_openCommon:function(q,r){if(this._openSheet&&!h.canReplaceOpenSheet(this._openSheet,q))return;this.clear(function(){this._openSheet=q;var s=l[':fb:mercury:chat:tab-sheet:loading'].build().getRoot();j.setContent(this._rootElement,s);i.show(s);i.show(this._rootElement);q.render();if(r){i.addClass(this._tabMainElement,'sheetSlide');var t=m.getElementDimensions(this._rootElement).y;k.set(this._rootElement,'bottom',t+'px');this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){i.removeClass(this._tabMainElement,'sheetSlide');}.bind(this)).go();}if(!q.isPermanent()){var u=o;if(q.getCloseTimeout)u=q.getCloseTimeout();this._sheetCloseHandler=this.close.bind(this,q).defer(u,false);if(q.timeoutCanBeReset)q.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},resetTimeout:function(q,r){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=this.close.bind(this,q).defer(r,false);},set:function(q){return this._openCommon(q,false);},open:function(q){return this._openCommon(q,true);},close:function(q,r){if(this._openSheet!=q)return;if(!this._openSheet){r&&r();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}i.addClass(this._tabMainElement,'sheetSlide');var s=m.getElementDimensions(this._rootElement).y;this._animation=new g(this._rootElement).to('bottom',s+'px').duration(100).ease(g.ease.begin).ondone(function(){j.empty(this._rootElement);i.hide(this._rootElement);i.removeClass(this._tabMainElement,'sheetSlide');this._openSheet=null;r&&r();}.bind(this)).go();},clear:function(q){this.close(this._openSheet,q);}});e.exports=p;});
__d("MultiChatController",["Arbiter","AsyncSignal","copyProperties","Form","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncSignal'),i=b('copyProperties'),j=b('Form'),k=b('MercuryMessages'),l=b('MercuryServerRequests'),m=b('MercuryThreads');function n(){}i(n,{subscribe:function(o,p){o.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(o,p);}.bind(this));},createGroupThreadFromChooserDialog:function(o,p){var q=j.serialize(o.getRoot()),r=JSON.parse(q.profileChooserItems),s=[];for(var t in r)if(r[t])s.push(t);var u=n.createThreadForFBIDs(s);l.subscribe('update-thread-ids',function(v,w){for(var x in w)if(w[x]==u)new h('/ajax/groups/chat/log',{group_id:p,message_id:x}).send();});o.hide();},createThreadForTokens:function(o){if(!o.length)return;var p;if(o.length==1){p='user:'+o[0].split(':')[1];}else p='root:'+k.generateNewClientMessageID((new Date()).getTime());m.createNewLocalThread(p,o);g.inform('chat/open-tab',{thread_id:p});return p;},createThreadForFBIDs:function(o){var p=[];for(var q=0;q<o.length;q++)p.push("fbid:"+o[q]);return n.createThreadForTokens(p);}});e.exports=n;});
__d("ChatAddFriendsTabSheet",["ChatAddFriendsTabSheetRawRenderer","ChatTabSheetView","MercuryConstants","MercuryMessages","MultiChatController","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('ChatAddFriendsTabSheetRawRenderer'),h=b('ChatTabSheetView'),i=b('MercuryConstants'),j=b('MercuryMessages'),k=b('MultiChatController'),l=b('MercuryThreads'),m=b('copyProperties');function n(q,r,s){this._threadID=q;this._rootElement=r;this._sheetView=s;}m(n.prototype,{render:function(){l.getThreadMeta(this._threadID,function(q){var r=q.is_canonical_user?o:p;g.render(this,this._sheetView,this._rootElement,q,r.curry(q));}.bind(this));},isPermanent:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);}});function o(q,r){var s=q.participants;k.createThreadForTokens(s.concat(r));}function p(q,r){var s=q.thread_id;if(l.isEmptyLocalThread(s)){l.addParticipantsToThreadLocally(s,r);}else j.sendMessage(j.constructLogMessageObject(i.MercurySourceType.CHAT_WEB,s,i.MercuryLogMessageType.SUBSCRIBE,{added_participants:r}));}e.exports=n;});
__d("ChatAvailabilityTabSheetRawRenderer",["AvailableListConstants","CSS","DOM","GenderConst","MercuryConfig","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('CSS'),i=b('DOM'),j=b('GenderConst'),k=b('MercuryConfig'),l=b('ChatTabTemplates'),m={render:function(q,r,s){var t=l[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),u=null;switch(q){case g.ACTIVE:h.addClass(t.getRoot(),'active');u=n(s);break;case g.MOBILE:h.addClass(t.getRoot(),'mobile');u=o(s);break;case g.OFFLINE:u=p(s);break;}i.setContent(t.getNode('text'),u);i.setContent(r,t.getRoot());}};function n(q){return i.tx._("{name} is now available.",{name:q.firstName});}function o(q){return i.tx._("Your messages will be sent to {name}'s phone.",{name:q.firstName});}function p(q){switch(q.gender){case j.FEMALE_SINGULAR:case j.FEMALE_SINGULAR_GUESS:if(k.ChatControlLanguageChangeGK){return i.tx._("{name} isn't on chat, but you can still send her a message.",{name:q.firstName});}else return i.tx._("{name} is offline, but you can still send her a message.",{name:q.firstName});case j.MALE_SINGULAR:case j.MALE_SINGULAR_GUESS:if(k.ChatControlLanguageChangeGK){return i.tx._("{name} isn't on chat, but you can still send him a message.",{name:q.firstName});}else return i.tx._("{name} is offline, but you can still send him a message.",{name:q.firstName});default:if(k.ChatControlLanguageChangeGK){return i.tx._("{name} isn't on chat, but you can still send them a message.",{name:q.firstName});}else return i.tx._("{name} is offline, but you can still send them a message.",{name:q.firstName});}}e.exports=m;});
__d("ChatAvailabilityTabSheet",["Arbiter","AvailableList","AvailableListConstants","ChatAvailabilityTabSheetRawRenderer","ChatConfig","MercuryThreads","ShortProfiles","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChatAvailabilityTabSheetRawRenderer'),k=b('ChatConfig'),l=b('MercuryThreads'),m=b('ShortProfiles'),n=b('copyProperties');function o(p,q,r,s){this._handledAvailability=q;this._sheetView=s;this._rootElement=r;this._canonicalUser=l.getCanonicalUserInThread(p);if(this._canonicalUser){this._currentAvailability=i.ACTIVE;this._handleAvailabilityChange();g.subscribe(i.ON_AVAILABILITY_CHANGED,this._handleAvailabilityChange.bind(this));}}o.createSheets=function(p,q,r){var s={};if(k.get('roger.ui')){s[i.OFFLINE]=new o(p,i.OFFLINE,q,r);return s;}[i.ACTIVE,i.OFFLINE,i.MOBILE].forEach(function(t){s[t]=new o(p,t,q,r);});return s;};n(o.prototype,{render:function(){!this._canonicalUser;m.get(this._canonicalUser,j.render.curry(this._currentAvailability,this._rootElement));},isPermanent:function(){return false;},getType:function(){switch(this._handledAvailability){case i.ACTIVE:return 'availability_active_type';case i.MOBILE:return 'availability_mobile_type';case i.OFFLINE:return 'availability_offline_type';default:throw new Error("Invalid handled availability");}},getCloseTimeout:function(){return 5000;},_handleAvailabilityChange:function(){var p=h.get(this._canonicalUser);if(p==this._currentAvailability)return;this._currentAvailability=p;if(p==this._handledAvailability)this._sheetView.open(this);}});e.exports=o;});
__d("ChatMessengerUpsellConfig",["AsyncRequest","KeyedCallbackManager"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('KeyedCallbackManager'),i=new h(),j={get:function(k,l){var m=i.executeOrEnqueue(k,l),n=i.getUnavailableResources(m);if(n.length)new g().setURI('/ajax/chat/messenger_upsell/config.php').setHandler(this._setPromoConfig.bind(this)).send();},_setPromoConfig:function(k){var l=k.payload;if(l){i.setResource('impression_count',l.number_of_impressions);i.setResource('max_impressions',l.max_impressions);i.setResource('promo_timeout',l.promo_timeout);i.setResource('post_click_timeout',l.post_click_timeout);i.setResource('should_show_orca_promotion',true);}else i.setResource('should_show_orca_promotion',false);},getNow:function(k){return i.getResource(k);},setImpressionCount:function(k,l){new g().setURI('/ajax/chat/messenger_upsell/update_impressions.php').setData({impressions:l,friend_id:k}).send();i.setResource('impression_count',l);if(l>=i.getResource('max_impressions'))i.setResource('should_show_orca_promotion',false);}};e.exports=j;});
__d("ChatMessengerPromoTabSheet",["event-extensions","AsyncRequest","ChatConfig","MercuryConstants","DOM","MercuryParticipants","MercuryThreads","ChatTabTemplates","ChatMessengerUpsellConfig","URI","copyProperties","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('ChatConfig'),i=b('MercuryConstants'),j=b('DOM'),k=b('MercuryParticipants'),l=b('MercuryThreads'),m=b('ChatTabTemplates'),n=b('ChatMessengerUpsellConfig'),o=b('URI'),p=b('copyProperties'),q=b('tx');function r(s,t,u){this._threadID=s;this._rootElement=t;this._sheetView=u;this._sheetHasBeenDisplayed=false;this._canonicalUser=l.getCanonicalUserInThread(s);this._timeoutResetCallback=null;this._template;}p(r.prototype,{render:function(){this._template=m[':fb:mercury:chat:tab-sheet:promo-sheet'].build();var s=k.getIDForUser(this._canonicalUser);k.get(s,function(t){j.setContent(this._template.getNode('text'),q._("{name} is using Messenger. Get the app to chat on the go.",{name:t.short_name}));}.bind(this));this._button=this._template.getNode('installButton');Event.listen(this._template.getNode('installButton'),'click',this.installButtonClickHandler.bind(this));j.setContent(this._rootElement,this._template.getRoot());},rerender:function(){j.empty(this._rootElement);j.setContent(this._template.getNode('text'),"A link has been sent to your phone to install Messenger");j.remove(this._template.getNode('installButton'));j.setContent(this._rootElement,this._template.getRoot());n.get('post_click_timeout',function(s){this._timeoutResetCallback(this,s);}.bind(this));},installButtonClickHandler:function(){var s=new o('/ajax/marketing/messenger_send_to_mobile').setQueryData({fb_source:'web_chat_upsell'});new g().setURI(s).setMethod('POST').setHandler(function(v){this.rerender();}.bind(this)).send();var t=n.getNow('impression_count'),u=t*100;n.setImpressionCount(this._canonicalUser,u);},isPermanent:function(){return false;},timeoutCanBeReset:function(){return true;},setResetTimeoutCallback:function(s){this._timeoutResetCallback=s;},getType:function(){return 'messenger_promo_type';},getCloseTimeout:function(){return n.getNow('promo_timeout');},_displayUpsellCallback:function(s){if(!s)return;this._sheetView.open(this);this._sheetHasBeenDisplayed=true;var t=n.getNow('impression_count');n.setImpressionCount(this._canonicalUser,t+1);return;},displayPromo:function(s){var t=i.MercurySourceType;if(!s||(s.source!=t.CHAT_ORCA&&s.source!=t.TITAN_ORCA)||k.getUserID(s.author)!=this._canonicalUser||this._sheetHasBeenDisplayed)return;n.get('should_show_orca_promotion',function(u){this._displayUpsellCallback(u);}.bind(this));}});e.exports=r;});
__d("ChatNewMessagesTabSheet",["event-extensions","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('DOM'),i=b('ChatTabTemplates'),j=b('copyProperties');function k(l,m,n){this._threadID=l;this._rootElement=m;this._sheetView=n;}j(k.prototype,g,{render:function(){var l=i[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();h.setContent(l.getNode('text'),h.tx._("Scroll down to see new messages."));h.setContent(this._rootElement,l.getRoot());Event.listen(l.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=k;});
__d("ChatNoRecipientsTabSheet",["DOM","MercuryParticipants","ChatTabTemplates","MercuryThreadInformer","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryParticipants'),i=b('ChatTabTemplates'),j=b('MercuryThreadInformer'),k=b('MercuryThreads'),l=b('copyProperties');function m(n,o,p){this._threadID=n;this._rootElement=o;this._sheetView=p;j.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}l(m.prototype,{render:function(){var n=i[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(n.getNode('text'),g.tx._("All recipients have left this conversation. Please close the stale tab."));g.setContent(this._rootElement,n.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){k.getThreadMeta(this._threadID,function(n){var o=h.user,p=n.participants.filter(function(q){return q!=o;});if(p.length<1){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=m;});
__d("ChatOfflineTabSheet",["event-extensions","ChatPrivacyActionController","ChatTabSheetView","ChatVisibility","CSS","DOM","JSLogger","MercuryConfig","MercuryParticipants","MercuryThreads","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ChatPrivacyActionController'),h=b('ChatTabSheetView'),i=b('ChatVisibility'),j=b('CSS'),k=b('DOM'),l=b('JSLogger'),m=b('MercuryConfig'),n=b('MercuryParticipants'),o=b('MercuryThreads'),p=b('ChatTabTemplates'),q=b('copyProperties'),q=b('copyProperties');function r(s,t,u){this._rootElement=t;this._sheetView=u;this._logger=l.create('blackbird');this._canonicalUser=o.getCanonicalUserInThread(s);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}q(r.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var s=p[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),t='fbid:'+this._canonicalUser;n.get(t,function(u){var v='fbChatGoOnlineLink',w=m.ChatControlLanguageChangeGK?k.tx._("turn on chat"):k.tx._("go online"),x=k.create('a',{href:'#',className:v},w),y;if(m.ChatControlLanguageChangeGK){y=k.tx._("To chat with {name} and other friends, {link}.",{name:u.short_name,link:x});}else y=k.tx._("You are now offline. To chat with {name} and other friends, {link}.",{name:u.short_name,link:x});k.setContent(s.getNode('text'),y);j.addClass(s.getRoot(),'chatOffline');k.setContent(this._rootElement,s.getRoot());Event.listen(this._rootElement,'click',function(event){if(j.hasClass(event.getTarget(),v)){if(i.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));}.bind(this));},_handlePrivacyChange:function(s){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(s){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=r;});
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ChatTabTemplates'),i=b('copyProperties');function j(k,l,m){this._threadID=k;this._rootElement=l;this._sheetView=m;}i(j.prototype,{render:function(){var k=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(k.getNode('text'),g.tx._("Please wait until the upload is complete before you send your message."));g.setContent(this._rootElement,k.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=j;});
__d("ChatUserBlockedTabSheet",["event-extensions","ChatPrivacyActionController","ChatTabSheetView","CSS","DOM","GenderConst","JSLogger","MercuryConfig","MercuryParticipants","MercuryThreads","ChatTabTemplates","copyProperties","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ChatPrivacyActionController'),h=b('ChatTabSheetView'),i=b('CSS'),j=b('DOM'),k=b('GenderConst'),l=b('JSLogger'),m=b('MercuryConfig'),n=b('MercuryParticipants'),o=b('MercuryThreads'),p=b('ChatTabTemplates'),q=b('copyProperties'),r=b('tx');function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=o.getCanonicalUserInThread(t);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}q(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=p[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;n.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=m.ChatControlLanguageChangeGK?r._("You turned off chat for {name} but you can still send her a message. ",{name:v.short_name}):r._("{name} sees you as offline on chat, but you can still send her a message. ",{name:v.short_name});break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=m.ChatControlLanguageChangeGK?r._("You turned off chat for {name} but you can still send him a message. ",{name:v.short_name}):r._("{name} sees you as offline on chat, but you can still send him a message. ",{name:v.short_name});break;default:w=m.ChatControlLanguageChangeGK?r._("You turned off chat for {name} but you can still send them a message. ",{name:v.short_name}):r._("{name} sees you as offline on chat, but you can still send them a message. ",{name:v.short_name});}j.setContent(t.getNode('text'),w);var x=m.ChatControlLanguageChangeGK?r._("Turn on chat for {name}?",{name:v.short_name}):r._("Go Online to {name}",{name:v.short_name});j.setContent(t.getNode('actionLink'),x);i.addClass(t.getRoot(),'blocked');j.setContent(this._rootElement,t.getRoot());Event.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(t){case g.BLOCKED:this._sheetView.open(this);break;case g.NORMAL:case g.OFFLINE:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;});
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatAvailabilityTabSheet","ChatMessengerPromoTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatTabSheetView","ChatUserBlockedTabSheet","copyProperties","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatAddFriendsTabSheet'),h=b('ChatAvailabilityTabSheet'),i=b('ChatMessengerPromoTabSheet'),j=b('ChatNewMessagesTabSheet'),k=b('ChatNoRecipientsTabSheet'),l=b('ChatOfflineTabSheet'),m=b('ChatUploadWarningTabSheet'),n=b('ChatTabSheetView'),o=b('ChatUserBlockedTabSheet'),p=b('copyProperties'),q=b('MercuryThreads'),r=function(s,t,u){this._sheetView=new n(s,t,u);this._addFriendsTabSheet=new g(s,t,this._sheetView);this._userBlockedTabSheet=new o(s,t,this._sheetView);this._offlineTabSheet=new l(s,t,this._sheetView);this._messengerPromoTabSheet=new i(s,t,this._sheetView);this._newMessagesTabSheet=new j(s,t,this._sheetView);this._availabilityTabSheets=h.createSheets(s,t,this._sheetView);this._uploadWarningTabSheet=new m(s,t,this._sheetView);if(!q.getCanonicalUserInThread(s))this._noRecipientsTabSheet=new k(s,t,this._sheetView);};p(r.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},displayMessengerPromoTabSheet:function(s){this._messengerPromoTabSheet.displayPromo(s);},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(s){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',s);},destroy:function(){this._sheetView.destroy();this._offlineTabSheet.destroy();this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();}});e.exports=r;});
__d("MessagesEmoticonView",["event-extensions","function-extensions","DOM","InputSelection","Parent","TextAreaControl","Toggler","copyProperties","endsWith","startsWith"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('DOM'),h=b('InputSelection'),i=b('Parent'),j=b('TextAreaControl'),k=b('Toggler'),l=b('copyProperties'),m=b('endsWith'),n=b('startsWith'),o={smile:':)',frown:':(',tongue:':P',grin:'=D',gasp:':o',wink:';)',glasses:'8)',sunglasses:'B|',grumpy:'>:(',unsure:':/',cry:":'(",devil:'3:)',angel:'O:)',kiss:':*',heart:'<3',kiki:'^_^',squint:'-_-',confused:'o.O',upset:'>:o',pacman:':v',robot:':|]',colonthree:':3',penguin:'<(")',putnam:':putnam:',shark:'(^^^)','42':':42:',like:'(y)',confused_rev:'O.o'};function p(r,s,t){var u=i.byClass(r,'emoteIcon');if(!u)return;var v='name_',w=null;u.className.split(' ').forEach(function(da){if(n(da,v))w=da.substring(v.length);});if(!o[w])return;var x=j.getInstance(s),y=x.getValue(),z=o[w],aa=y.substring(0,t.start),ba=y.substring(t.end);if(t.start>0&&!m(aa,' '))z=' '+z;if(!n(ba,' '))z+=' ';var ca=aa+z+ba;t.start+=z.length;t.end=t.start;x.setValue(ca);h.set(s,t.start,t.end);}function q(r,s){var t={start:0,end:0};function u(){t=h.get(s);}var v=g.find(r,'.uiToggleFlyout');this._subscription=k.subscribe('show',function(w,x){if(x.active&&g.contains(r,x.active))h.set(s,t.start,t.end);});this._eventListeners=[Event.listen(v,'click',function(event){k.hide(r);p(event.getTarget(),s,t);}),Event.listen(s,'keyup',u),Event.listen(s,'click',u)];}l(q.prototype,{destroy:function(){this._subscription.unsubscribe();while(this._eventListeners.length)this._eventListeners.pop().remove();}});l(q,{create:function(r,s){return new q(r,s);}});e.exports=q;});
__d("ChatTabView",["event-extensions","function-extensions","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AvailableList","AvailableListConstants","ChatBehavior","ChatConfig","ChatContextualDialogController","ChatPrivacyActionController","ChatQuietLinks","ChatTabMessagesView","ChatTabSheetController","ChatVisibility","CSS","Dialog","Dock","DOM","JSLogger","Keys","MercuryConfig","MercuryConstants","MercuryFileUploader","MercuryMessages","MercuryParticipants","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreads","MercuryTypingReceiver","MessagesEmoticonView","NubController","Parent","PresencePrivacy","SubscriptionsHandler","ChatTabTemplates","TextAreaControl","Tooltip","TypingIndicator","URI","UserAgent","VideoCallCore","copyProperties","setIntervalAcrossTransitions","tx"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('AvailableList'),l=b('AvailableListConstants'),m=b('ChatBehavior'),n=b('ChatConfig'),o=b('ChatContextualDialogController'),p=b('ChatPrivacyActionController'),q=b('ChatQuietLinks'),r=b('ChatTabMessagesView'),s=b('ChatTabSheetController'),t=b('ChatVisibility'),u=b('CSS'),v=b('Dialog'),w=b('Dock'),x=b('DOM'),y=b('JSLogger'),z=b('Keys'),aa=b('MercuryConfig'),ba=b('MercuryConstants'),ca=b('MercuryFileUploader'),da=b('MercuryMessages'),ea=b('MercuryParticipants'),fa=b('MercuryServerRequests'),ga=b('MercuryThreadInformer'),ha=b('MercuryThreadMetadataRawRenderer'),ia=b('MercuryThreadMetadataRenderer'),ja=b('MercuryThreads'),ka=b('MercuryTypingReceiver'),la=b('MessagesEmoticonView'),ma=b('NubController'),na=b('Parent'),oa=b('PresencePrivacy'),pa=b('SubscriptionsHandler'),qa=b('ChatTabTemplates'),ra=b('TextAreaControl'),sa=b('Tooltip'),ta=b('TypingIndicator'),ua=b('URI'),va=b('UserAgent'),wa=b('VideoCallCore'),xa=b('copyProperties'),ya=b('setIntervalAcrossTransitions'),za=b('tx'),ab=y.create('tab_view'),bb={};function cb(rb,sb){var tb=x.create('div');sb=sb.filter(function(ub){return ub!=ea.user;});ea.getMulti(sb,function(ub){for(var vb in ub){var wb=ub[vb],xb=qa[':fb:mercury:chat:multichat-tooltip-item'].build();x.setContent(xb.getNode('name'),wb.name);var yb=ea.getUserID(vb),zb=yb&&k.get(yb)==l.ACTIVE;u.conditionShow(xb.getNode('icon'),zb);u.conditionClass(xb.getNode('name'),'tooltipItemWithIcon',zb);x.appendContent(tb,xb.getRoot());}sa.set(rb,tb,'above','center');});}var db={},eb=null,fb=false;function gb(rb,sb,tb){if(tb){db[rb]=sb;if(!eb)eb=ya(hb,600);}else{u.removeClass(sb,'highlightTitle');delete db[rb];}}function hb(){for(var rb in db){var sb=db[rb];if(sb.parentNode){u.conditionClass(sb,'highlightTitle',fb);}else delete db[rb];}fb=!fb;if(!Object.keys(db).length){clearInterval(eb);eb=null;}}function ib(rb){var sb=fa.tokenizeThreadID(rb);switch(sb.type){case 'user':return qa[':fb:mercury:chat:user-tab'].build();case 'group':return qa[':fb:mercury:chat:group-tab'].build();}return qa[':fb:mercury:chat:multichat-tab'].build();}function jb(rb){var sb=rb._fileUploader&&rb._fileUploader.getAttachments();return sb&&sb.length;}function kb(rb){var sb=rb._tabTemplate.getNode('input'),tb=sb.value||'';if(!/^\s*$/.test(tb)||jb(rb))ja.getThreadMeta(rb._threadID,function(ub){var vb=da.constructUserGeneratedMessageObject(tb,ba.MercurySourceType.CHAT_WEB,rb._threadID);if(n.get('send_files_from_chat')){var wb=rb._fileUploader.getAttachments();if(wb&&wb.length){vb.has_attachment=true;vb.raw_attachments=wb;}}if(ja.isEmptyLocalThread(rb._threadID)){var xb=fa.tokenizeThreadID(rb._threadID);vb.message_id=xb.value;vb.specific_to_list=ub.participants;}da.sendMessage(vb);if(n.get('send_files_from_chat'))lb(rb);rb._getNode('input').value='';rb._typingIndicator&&rb._typingIndicator.resetState();rb._messagesView&&rb._messagesView.scrollToBottom();}.bind(rb));}function lb(rb){rb._fileUploader.removeAttachments();}function mb(rb){rb._blocked=true;rb._sheetController.openUploadWarningTabSheet();}function nb(){if(this._blocked){if(this._fileUploader.isUploading())return;this._blocked=false;kb(this);this._sheetController.closeUploadWarningTabSheet();}}function ob(){d(['Dock'],function(rb){rb.resizeAllFlyouts();});this._attachmentsDiv.scrollTop=this._attachmentsDiv.scrollHeight;}function pb(rb,sb){if(sb)fa.ensureThreadIsFetched(sb);this._threadID=rb;this._eventListeners=[];this._tabTemplate=ib(rb);this._tabElem=this._tabTemplate.getRoot();if(!(this._getNode instanceof Function))ab.log('getnode_undefined',{is_getnode_set:!!this._getNode,is_prototype_set:!!pb.prototype,is_window:window==this,is_chat_tab_view:this instanceof pb,ctor_name:this.constructor&&this.constructor.name});this._subscriptionsHandler=new pa();if(n.get('send_files_from_chat')){this._fileUploader=new ca(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('attachButtonForm'),this._tabTemplate.getNode('fileInput'),this._tabTemplate.getNode('attachID'));this._subscriptionsHandler.addSubscriptions(this._fileUploader.subscribe(['all-uploads-completed','upload-canceled'],nb.bind(this)),this._fileUploader.subscribe('dom-updated',ob.bind(this)));this._attachmentsDiv=this._getNode('attachmentShelf');}else if(this._tabTemplate.getNode('uploadFilesLink'))u.hide(this._tabTemplate.getNode('uploadFilesLink'));this._sheetController=new s(this._threadID,this._getNode('sheet'),this._tabElem);this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();}.bind(this));this._contextualDialogController=new o(this._threadID,this._getNode('videoCallLink'));this._messagesView=null;var tb=this._getNode('conversationLink');if(tb){u.hide(tb);ia.renderTitanLink(rb,tb,u.show.bind(u,tb));}if(!ja.getCanonicalUserInThread(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var ub=this._getCanonicalUserID();if(this._isTitleTextLinked())ea.get('fbid:'+ub,function(xb){if(xb.href){var yb=this._getNode('titlebarText');yb.setAttribute('href',xb.href);yb.removeAttribute('rel');u.removeClass(yb,'noLink');}}.bind(this));this._nubController=new ma().init(this._tabElem);ra.getInstance(this._getNode('input')).subscribe('resize',function(){this._nubController.flyoutContentChanged();}.bind(this));this._nubController.subscribe('resize',function(){this._emoticonsNode.style.left=(this._getNode('input').clientWidth+3)+'px';ra.getInstance(this._getNode('input')).update();}.bind(this));this._listen('closeButton','click',this._closeClicked);this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('uploadFilesLink','click',this._uploadFilesLinkClicked,true);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('videoCallLink','click',this._callClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._emoticonsNode=this._getNode('emoticons');this._emoticonView=new la(this._emoticonsNode,this._getNode('input'));if(va.firefox()){this._listen('input','keypress',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new p(ub,this._updatePrivacyLink.bind(this));this._eventListeners.push(Event.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}ja.getThreadMeta(this._threadID,function(xb){var yb=ub||(n.get('chat_multi_typ_send')&&!xb.is_canonical);if(yb)fa.getServerThreadID(this._threadID,function(zb){this._typingIndicator=new ta(ub,this._getNode('input'),'mercury-chat',null,zb);}.bind(this));}.bind(this));var vb=this._getNode('muteGroupLink');if(vb){var wb=ja.getCanonicalGroupInThread(this._threadID);if(wb)vb.setAttribute('ajaxify',ua(vb.getAttribute('ajaxify')).addQueryData({id:wb}));}q.removeEmptyHrefs(this._tabElem);bb[rb]=this;this.updateAvailableStatus();this.updateTab();}function qb(){for(var rb in bb){bb[rb].updateAvailableStatus();bb[rb].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],qb);oa.subscribe(['privacy-changed','privacy-availability-changed'],qb);m.subscribe(m.ON_CHANGED,function(){for(var rb in bb)ja.getThreadMeta(rb,function(sb){bb[rb]._updateUnreadCount(sb);});});ka.subscribe('state-changed',function(rb,sb){for(var tb in sb){var ub=sb[tb]&&sb[tb].length,vb=bb[tb];vb&&vb.showTypingIndicator(ub);}});ga.subscribe('threads-updated',function(rb,sb){for(var tb in bb)sb[tb]&&bb[tb].updateTab();});ga.subscribe('threads-deleted',function(rb,sb){for(var tb in bb)pb.inform('thread-deleted',tb);});xa(pb,h,{get:function(rb){return bb[rb];}});xa(pb.prototype,{getThreadID:function(){return this._threadID;},isVisible:function(){return u.shown(this._tabElem);},setVisibleState:function(rb,sb){var tb=u.shown(this._tabElem),ub=u.hasClass(this._tabElem,'opened');u.conditionShow(this._tabElem,rb);u.conditionClass(this._tabElem,'opened',sb);if(!(tb&&ub)&&rb&&sb){if(!this._messagesView)this._messagesView=new r(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('typingIndicator'));this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(tb&&ub&&!(rb&&sb))this._contextualDialogController.tabNotActive();},focus:function(){var rb=u.hasClass(this._tabElem,'opened')?'input':'dockButton';this._getNode(rb).focus();},isFocused:function(){var rb=document.activeElement;return na.byClass(rb,'fbMercuryChatTab')===this._tabElem;},setInput:function(rb){this._getNode('input').value=rb;},insertBefore:function(rb){x.insertBefore(rb._tabElem,this._tabElem);},appendTo:function(rb){x.appendContent(rb,this._tabElem);},nextTabIs:function(rb){var sb=rb&&rb._tabElem;return this._tabElem.nextSibling==sb;},destroy:function(){x.remove(this._tabElem);this._emoticonView&&this._emoticonView.destroy();while(this._eventListeners.length)this._eventListeners.pop().remove();this._messagesView&&this._messagesView.destroy();this._sheetController.destroy();if(n.get('send_files_from_chat'))this._fileUploader.destroy();this._subscriptionsHandler.release();this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();delete bb[this._threadID];w.unregisterNubController(this._nubController);},updateAvailableStatus:function(){var rb={active:false,mobile:false,greenphone:false},sb=this._getCanonicalUserID(),tb=true,ub=false;if(sb){var vb=k.get(sb);tb=!t.isOnline();ub=!oa.allows(sb);rb.active=(vb===l.ACTIVE);if(n.get('sidebar_mobile_icon_green')){rb.greenphone=vb===l.MOBILE;}else rb.mobile=vb===l.MOBILE;this._updateCallLink(vb);}u.conditionClass(this._tabElem,'chatOffline',tb);u.conditionClass(this._tabElem,'blocked',!tb&&ub);for(var wb in rb)u.conditionClass(this._tabElem,wb,!tb&&!ub&&rb[wb]);},updateTab:function(){ja.getThreadMeta(this._threadID,function(rb){if(!rb.is_subscribed){pb.inform('unsubscribed',this._threadID);return;}ia.renderAndSeparatedParticipantList(this._threadID,[this._getNode('name'),this._getNode('titlebarText')],{names_renderer:ha.renderShortNames,check_length:true});this._updateUnreadCount(rb);this.updateMultichatTooltip();this._updateArchiveWarning(rb);}.bind(this));},_updateArchiveWarning:function(rb){var sb=false;ea.get(ea.user,function(tb){sb=tb.employee;if(sb)ea.getMulti(rb.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_showArchiveWarningIfAllParticipantsAreEmployees:function(rb){var sb=true;for(var tb in rb)sb=sb&&rb[tb].employee;var ub=this._getNode('titanArchiveWarning');if(ub){if(this._titlebarTooltipAnchor)u.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',sb);u.conditionShow(ub,sb);}},updateMultichatTooltip:function(){ja.getThreadMeta(this._threadID,function(rb){if(!rb.is_canonical)cb(this._titlebarTooltipAnchor,rb.participants);}.bind(this));},_getNode:function(rb){return this._tabTemplate.getNode(rb);},_getCanonicalUserID:function(){return ja.getCanonicalUserInThread(this._threadID);},_listen:function(rb,event,sb,tb){var ub=this._getNode(rb);if(ub){this._eventListeners.push(Event.listen(ub,event,sb.bind(this)));}else if(!tb)throw new Error('Could not find node "'+rb+'"');},_closeClicked:function(rb){pb.inform('closed-tab',this._threadID);rb.prevent();},_nubClicked:function(){return pb.inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===z.RETURN||event.keyCode===z.SPACE){pb.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===z.ESC){pb.inform('esc-pressed',this._threadID);event.kill();}else if(event.keyCode===z.TAB&&!event.ctrlKey){var rb=pb.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!rb&&event.kill();}},_isTitleTextLinked:function(){var rb=this._getCanonicalUserID();return rb&&n.get('chat_tab_title_link_timeline');},_titleClicked:function(event){var rb=event.getTarget(),sb=na.byClass(rb,'titlebarText'),tb=sb&&this._isTitleTextLinked();if(!tb&&!na.byClass(rb,'uiSelector')&&!na.byClass(rb,'addToThread'))pb.inform('lower-activated',this._threadID);},_callClicked:function(rb){var sb=this._getCanonicalUserID();if(wa.availableForCall(sb)){var tb='chat_tab_icon';if(rb.target&&u.hasClass(rb.target,'video_call_promo')){tb='chat_tab_icon_promo';}else if(rb.target&&u.hasClass(rb.target,'video_call_tour'))tb='chat_tab_icon_tour';pb.inform('video-call-clicked',{threadID:this._threadID,userID:sb,clickSource:tb});}return false;},_uploadFilesLinkClicked:function(){this._tabTemplate.getNode('fileInput').click();},_addFriendLinkClicked:function(){this._sheetController.openAddFriendsSheet();},_clearHistory:function(){var rb=ja.getThreadMetaNow(this._threadID);if(rb){var sb=this._getCanonicalUserID();fa.clearChat(this._threadID,sb,rb.timestamp);}},_unsubscribeLinkClicked:function(){var rb=[];rb.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});rb.push(v.CANCEL);new v().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(rb).show();},_reportSpamClicked:function(){var rb=this._getCanonicalUserID(),sb=ua('/ajax/chat/report.php').addQueryData({id:rb}).addQueryData({src:'top_report_link'});i.send(new j(sb));},_focusTab:function(){u.addClass(this._tabElem,'focusedTab');pb.inform('focused',this._threadID);this._contextualDialogController.tabFocused();},_blurTab:function(){u.removeClass(this._tabElem,'focusedTab');},_inputKeyDown:function(event){if(event.keyCode===z.RETURN&&!event.shiftKey){if(n.get('send_files_from_chat')){var rb=this._fileUploader.isUploading();if(rb){mb(this);return;}}kb(this);event.kill();}if(event.keyCode===z.DOWN&&event.shiftKey&&this._getNode('input').value===''){pb.inform('lower-activated',this._threadID);event.kill();return;}this._handleHotkeyPressed(event);},_chatConvClicked:function(rb){if(na.byTag(rb.getTarget(),'a')||x.getSelection())return;this.focus();},showTypingIndicator:function(rb){var sb=ja.getThreadMetaNow(this._threadID),tb=this._getCanonicalUserID()||(n.get('chat_multi_typ')&&sb&&!sb.is_canonical);if(tb)u.conditionClass(this._tabElem,'typing',rb);},_updateUnreadCount:function(rb){var sb=rb.unread_count;if(typeof sb!='undefined'){var tb=!!sb&&(!m.showsTabUnreadUI||m.showsTabUnreadUI()),ub=this._getNode('numMessages');u.conditionShow(ub,tb);u.conditionClass(this._tabElem,'highlightTab',tb);gb(this._threadID,this._tabElem,tb);x.setContent(ub,sb);}},_updateCallLink:function(rb){var sb=this._getNode('videoCallLink');if(t.isOnline()){var tb=this._getCanonicalUserID(),ub='fbid:'+tb;ea.get(ub,function(vb){if(wa.availableForCall(tb)){sa.set(sb,za._("Start a video call with {firstname}",{firstname:vb.short_name}));this._updateCallBackLinks(this._tabElem,true);}else{sa.set(sb,za._("{firstname} is currently unavailable for video calling",{firstname:vb.short_name}));this._hideVideoCallouts();this._updateCallBackLinks(this._tabElem,false);}}.bind(this));}else{sa.set(sb,"You must be online to make a call.");this._hideVideoCallouts();this._updateCallBackLinks(document.body,false);}},_updateCallBackLinks:function(rb,sb){var tb=x.scry(rb,'a.callBackLink');if(sb){tb.forEach(u.show);}else tb.forEach(u.hide);},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(rb){if(rb==p.OFFLINE){x.setContent(this._privacyLink,"Go online");}else{var sb=this._getCanonicalUserID(),tb='fbid:'+sb;ea.get(tb,function(ub){var vb=null;if(rb==p.BLOCKED){if(aa.ChatControlLanguageChangeGK){vb=za._("Turn On Chat for {name}",{name:ub.short_name});}else vb=za._("Go Online to {name}",{name:ub.short_name});}else if(aa.ChatControlLanguageChangeGK){vb=za._("Turn Off Chat for {name}",{name:ub.short_name});}else vb=za._("Go Offline to {name}",{name:ub.short_name});x.setContent(this._privacyLink,vb);}.bind(this));}},_unsubscribeToThread:function(){if(ja.isEmptyLocalThread(this._threadID)){pb.inform('unsubscribed',this._threadID);}else{var rb=da.constructLogMessageObject(ba.MercurySourceType.CHAT_WEB,this._threadID,ba.MercuryLogMessageType.UNSUBSCRIBE,{});da.sendMessage(rb);}return true;},_emoticonView:null});e.exports=pb;});
__d("ChatNewMessageHandler",["ChatActivity","ChatTabModel","ChatTabView","JSLogger","MercuryAssert","MercuryBrowserAlerts","MercuryThreads","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('ChatTabModel'),i=b('ChatTabView'),j=b('JSLogger'),k=b('MercuryAssert'),l=b('MercuryBrowserAlerts'),m=b('MercuryThreads'),n=b('MercuryUnseenState'),o=j.create('chat_new_message'),p={_raiseTab:function(q,r){var s=h.getTab(q),t=false;if(s){t=s.raised;}else{h.raiseTab(q,false);t=true;}r.to_new_tab=!s;r.to_raised_tab=!!t;},_notify:function(q,r,s){var t=i.get(q);s.view_is_visible=t&&t.isVisible();s.view_is_focused=t&&t.isFocused();if(!s.view_is_visible)o.log('message_to_hidden');s.is_active=g.isActive();l.messageReceived(r);},newMessage:function(q,r){k.isThreadID(q);var s={thread_id:q,message_id:r.message_id};this._raiseTab(q,s);this._notify(q,r,s);o.log('message',s);}};l.subscribe('before-alert',function(q,event){var r=event.threadID,s=i.get(r),t=h.getTab(r);if(t&&t.raised&&s&&s.isVisible()&&s.isFocused()){m.changeThreadReadStatus(r,true);n.markThreadSeen(r);event.cancelAlert();}});e.exports=p;});
__d("ChatTabPresence",["Arbiter","AvailableList","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('ChatTabModel'),j=b('MercuryThreads'),k={};function l(m){var n=j.getCanonicalUserInThread(m);if(n)h.updateForID(n);}i.subscribe('chat/tabs-changed',function(event,m){m.tabs.forEach(function(n){if(n.raised&&!k[n.id])l(n.id);});k={};m.tabs.forEach(function(n){if(n.raised)k[n.id]=true;});});e.exports={};});
__d("ChatTabPolicy",["ChatBehavior","ChatConfig","FBDesktopPlugin","JSLogger","MercuryAssert","MercuryConstants","MercuryParticipants","MercuryThreads","MercuryUnseenState","PresencePrivacy","ShortProfiles"],function(a,b,c,d,e,f){var g=b('ChatBehavior'),h=b('ChatConfig'),i=b('FBDesktopPlugin'),j=b('JSLogger'),k=b('MercuryAssert'),l=b('MercuryConstants'),m=b('MercuryParticipants'),n=b('MercuryThreads'),o=b('MercuryUnseenState'),p=b('PresencePrivacy'),q=b('ShortProfiles'),r=j.create('tab_policy');function s(t,u){o.markThreadSeen(t,u);}e.exports={messageIsAllowed:function(t,u,v){var w=t.thread_id,x=u.message_id;k.isThreadID(w);k.isParticipantID(u.author);var y;if(t.mode==l.MercuryThreadMode.OBJECT_ORIGINATED){y={thread_id:w,message_id:x,mode:t.mode};r.log('message_object_originated',y);return;}var z=l.MercurySourceType;if(u.source==z.EMAIL||u.source==z.TITAN_EMAIL_REPLY){y={thread_id:w,message_id:x,source:u.source};r.log('message_source_not_allowed',y);return;}var aa=m.getUserID(u.author);if(!aa){r.log('message_bad_author',{thread_id:w,message_id:x,user:aa});return;}if(u.action_type!=l.MercuryActionType.USER_GENERATED_MESSAGE){y={thread_id:w,message_id:x,type:u.action_type};r.log('message_non_user_generated',y);return;}if(t.is_canonical_user&&!g.notifiesUserMessages()){r.log('message_jabber',{thread_id:w,message_id:x});s(w,true);return;}if(i.shouldSuppressMessages()){r.log('message_desktop',{thread_id:w,message_id:x});return;}if(t.folder!=l.MessagingTag.INBOX){r.log('message_folder',{thread_id:w,message_id:x,folder:t.folder});return;}q.get(aa,function(ba){if(!p.allows(aa)){r.log('message_privacy',{thread_id:w,message_id:x,user:aa});return;}if(ba.type!='friend'){r.log('message_non_friend',{thread_id:w,message_id:x,user:aa});return;}v();});}};});
__d("ChatTabViewSelector",["event-extensions","Arbiter","CSS","DataStore","DOM","Menu","MercuryThreadInformer","MercuryThreads","NubController","ChatTabTemplates","MercuryThreadMetadataRenderer","Toggler","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('Menu'),l=b('MercuryThreadInformer'),m=b('MercuryThreads'),n=b('NubController'),o=b('ChatTabTemplates'),p=b('MercuryThreadMetadataRenderer'),q=b('Toggler'),r=b('copyProperties');function s(t){var u=o[':fb:chat:tab:selector'].build(),v=u.getRoot(),w=u.getNode('menu'),x=j.find(w,'.uiMenuInner'),y={},z=new n().init(v);h.hide(v);j.insertBefore(t,v);function aa(da){var ea=0;for(var fa in y){var ga=y[fa],ha=m.getThreadMetaNow(fa),ia=ga.getNode('unreadCount'),ja=(ha&&ha.unread_count)||0;ea+=ja;if(ja>9)ja='+';h.conditionClass(ia,'invisible_elem',!ja);j.setContent(ia,ja);}var ka=u.getNode('numMessages');h.conditionShow(ka,ea);j.setContent(ka,ea);}this.setTabData=function(da){y={};if(da.length<1){h.hide(v);return;}h.show(v);j.empty(x);da.forEach(function(ea){var fa=o[':fb:chat:tab:selector:item'].build();y[ea.id]=fa;var ga=fa.getNode('content');p.renderAndSeparatedParticipantList(ea.id,ga);j.prependContent(x,fa.getRoot());i.set(fa.getRoot(),'threadID',ea.id);var ha=fa.getNode('closeButton');Event.listen(ha,'click',function(event){s.inform('selector/close-tab',ea.id);event.kill();});});z.flyoutContentChanged();j.setContent(u.getNode('numTabs'),da.length);aa();};function ba(event,da){if(da.menu!=w)return;var ea=i.get(da.item,'threadID');s.inform('selected',ea);q.hide(v);}function ca(event,da){k.register(w);}k.subscribe('select',ba.bind(this));q.listen('show',v,function(){g.inform('layer_shown',{type:'ChatTabSelector'});ca();});q.listen('hide',v,function(){g.inform('layer_hidden',{type:'ChatTabSelector'});});l.subscribe('threads-updated',aa);}r(s,new g());e.exports=s;});
__d("ChatTabController",["ChatTabPresence","Arbiter","ChatActivity","ChatConfig","ChatNewMessageHandler","ChatTabMessagesView","ChatTabModel","ChatTabPolicy","ChatTabView","ChatTabViewSelector","JSLogger","MercuryParticipants","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MercuryUnseenState","Style","UserAgent","VideoCallCore"],function(a,b,c,d,e,f){b('ChatTabPresence');var g=b('Arbiter'),h=b('ChatActivity'),i=b('ChatConfig'),j=b('ChatNewMessageHandler'),k=b('ChatTabMessagesView'),l=b('ChatTabModel'),m=b('ChatTabPolicy'),n=b('ChatTabView'),o=b('ChatTabViewSelector'),p=b('JSLogger'),q=b('MercuryParticipants'),r=b('MercuryServerRequests'),s=b('MercuryThreadInformer'),t=b('MercuryThreads'),u=b('MercuryUnseenState'),v=b('Style'),w=b('UserAgent'),x=b('VideoCallCore'),y=i.get('tab_auto_close_timeout')||7200000,z=p.create('tab_controller');function aa(ka){t.changeThreadReadStatus(ka,true);ba(ka);}function ba(ka){u.markThreadSeen(ka);}function ca(){var ka=l.get();ka.tabs.forEach(function(la){ba(la.id);});}function da(ka,la,ma){var na=l.get().tabs;ka+=la?1:-1;while(ka>=0&&ka<na.length){var oa=na[ka],pa=n.get(oa.id);if(pa&&pa.isVisible()&&(!ma||oa.raised)){pa.focus();return true;}ka+=la?1:-1;}return false;}function ea(ka){function la(oa){var pa=ka.shouldPromoteOnRaise(oa);g.inform("chat/promote-tab",oa);if(pa){l.raiseAndPromoteTab(oa,true);}else l.raiseTab(oa,true);var qa=n.get(oa);qa&&qa.focus();}function ma(oa,pa){var qa=ka.getMaxTabsToShow(),ra=l.indexOf(oa);l.closeTabAndDemote(oa,qa-2,pa);return ra;}o.subscribe('selected',function(oa,pa){la(pa);});g.subscribe('chat/open-tab',function(oa,pa){la(pa.thread_id);});g.subscribe('page_transition',function(oa,pa){l.closeFragileTabs();});r.subscribe('model-update-completed',ca);n.subscribe('focused',function(event,oa){aa(oa);});h.subscribe('idle',function(oa,pa){if(pa>y){var qa=l.get().tabs;qa.forEach(function(ra){var sa=ra.id;t.getThreadMeta(sa,function(ta){if(!ta.unread_count){z.log('autoclose_idle_seen',{thread_id:sa,idleness:pa});l.closeTab(sa,'autoclose_idle_seen');}});});}});n.subscribe('nub-activated',function(oa,pa){la(pa);});n.subscribe('lower-activated',function(oa,pa){l.lowerTab(pa);var qa=n.get(pa);qa&&qa.focus();});function na(oa,pa){x.showOutgoingCallDialog(pa.userID,pa.clickSource);l.lowerTab(pa.threadID);}n.subscribe('video-call-clicked',na);k.subscribe('video-call-clicked',na);n.subscribe('closed-tab',function(oa,pa){z.log('close_view',{thread_id:pa});ma(pa,'close_view');return false;});n.subscribe('thread-deleted',function(oa,pa){z.log('close_thread_deleted',{thread_id:pa});ma(pa,'close_thread_deleted');return false;});n.subscribe('unsubscribed',function(oa,pa){z.log('close_view_unsubscribed',{thread_id:pa});ma(pa,'close_view_unsubscribed');return false;});n.subscribe('esc-pressed',function(oa,pa){z.log('close_esc',{thread_id:pa});var qa=ma(pa,'close_esc');(function(){da(qa-1,true,true)||da(qa,false,true);}).defer();});o.subscribe('selector/close-tab',function(oa,pa){z.log('close_chat_from_selector',{thread_id:pa});ma(pa,'close_chat_from_selector');});s.subscribe('messages-received',function(oa,pa){for(var qa in pa){var ra=pa[qa];for(var sa=0;sa<ra.length;sa++){var ta=ra[sa];if(ta.author!=q.user){if(!ta.is_unread){z.log('message_already_read',{action_id:ta.action_id,thread_id:ta.thread_id});continue;}t.getThreadMeta(qa,function(ua){m.messageIsAllowed(ua,ta,function(){j.newMessage(qa,ta);});});}}}});s.subscribe('thread-read-changed',function(oa,pa){for(var qa in pa)if(!pa[qa].mark_as_read){z.log('autoclose_marked_unread',{thread_id:qa});l.closeTab(qa,'autoclose_marked_unread');}});n.subscribe('tab-pressed',function(oa,pa){return !da(l.indexOf(pa.id),pa.shiftPressed);});g.subscribe(p.DUMP_EVENT,function(oa,pa){pa.chat_controller={auto_close_timeout:y};});}if(w.firefox()){var fa=function(){return v.get(document.body,'overflowX')+' '+v.get(document.body,'overflowY');},ga=fa(),ha=function(){var ka=fa();if(ka!==ga){ga=ka;g.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var ia=new MutationObserver(ha),ja={attributes:true,attributeFilter:['class','style']};ia.observe(document.documentElement,ja);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))ha();},false);}e.exports=ea;});
__d("ChatTabViewCoordinator",["Arbiter","ChatConfig","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","VideoCallCore"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatConfig'),i=b('ChatTabModel'),j=b('ChatTabView'),k=b('ChatTabViewSelector'),l=b('CSS'),m=b('VideoCallCore');function n(o,p){var q=new k(o),r={},s=false;function t(){var y=i.get(),z={};y.tabs.forEach(function(ba){z[ba.id]=1;});for(var aa in r)if(!z[aa]){r[aa].destroy();delete(r[aa]);}u(y);v(y);}function u(y){var z=null;y.tabs.forEach(function(aa){var ba=aa.id,ca=false;if(!r[ba]){r[ba]=new j(ba,aa.server_id);ca=true;}if(ca||!r[ba].nextTabIs(z))if(z){r[ba].insertBefore(z);}else r[ba].appendTo(o);z=r[ba];});}function v(y){var z=p.getTabsToShow(y),aa=[],ba=false;y.tabs.forEach(function(ca){if(!z[ca.id]){r[ca.id].setVisibleState(false,ca.raised);aa.push(ca);}});y.tabs.forEach(function(ca){if(z[ca.id]){r[ca.id].setVisibleState(true,ca.raised);ba|=ca.raised;}});q.setTabData(aa);x(ba);}function w(y){for(var z=0,aa=y.tabs.length;z<aa;z++){var ba=y.tabs[z];if(ba.raised)if(ba.id===y.promoted||z<p.getMaxTabsToShow()-1)return true;}return false;}function x(y){if(!y&&s){g.inform('layer_hidden',{type:'ChatTab'});s=false;}else if(y&&!s){g.inform('layer_shown',{type:'ChatTab'});s=true;}}if(m.isSupported())l.addClass(o,'videoCallEnabled');p.subscribe('tabs-changed',t);t();}e.exports=n;});
__d("TabsViewport",["event-extensions","ArbiterMixin","ChatConfig","ChatTabModel","Class","CSS","Dock","DOM","Parent","Vector","areObjectsEqual","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('ChatConfig'),i=b('ChatTabModel'),j=b('Class'),k=b('CSS'),l=b('Dock'),m=b('DOM'),n=b('Parent'),o=b('Vector'),p=b('areObjectsEqual'),q=b('copyProperties');function r(s){this._root=s;Event.listen(window,'resize',this._recalculateWidth.bind(this));l.subscribe('resize',this._recalculateWidth.bind(this));i.subscribe('chat/tabs-changed',this._recalculateTabs.shield(this,true));this._recalculateWidth();this._initialized=true;}q(r.prototype,g,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var s=r._getAvailableDockWidth(this._root),t=Math.max(1,Math.floor(s/264)),u=t!=this._maxShown;if(!this._viewState||u||s<=this._viewState.usedWidth||s>this._viewState.widthToShowNext){this._availableWidth=s;this._maxShown=t;this._viewState=null;this._recalculateTabs(u);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(s){var t=r._getTabsToShow(i.get(),this._availableWidth);if(s||!p(this._viewState,t)){this._viewState=t;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},shouldPromoteOnRaise:function(s){if(!this._viewState.tabsToShow[s])return true;if(this._viewState.nextToHide!=s)return false;var t=i.getTab(s),u=t&&t.raised;return !u&&(this._availableWidth-this._viewState.usedWidth<100);}});q(r,{_getAvailableDockWidth:function(s){var t=o.getViewportDimensions().x;t-=230;t-=50;var u=n.byClass(s,'fbDock'),v=o.getElementDimensions(u),w=n.byClass(s,'fbDockChat'),x=o.getElementDimensions(w),y=v.x-x.x;t-=y;t-=20;return Math.max(t,0);},_getTabsToShow:function(s,t){var u=164,v=264;t=Math.max(t,v+1);function w(la){return la.raised?v:u;}var x=JSON.parse(JSON.stringify(s.tabs)),y=-1,z=null;if(s.promoted)x.forEach(function(la,ma){if(la.id===s.promoted){y=ma;z=la;}});var aa=0,ba=0,ca=!z;x.forEach(function(la,ma){var na=w(la);la.leftmostOffset=aa+v;aa+=na;if(la.leftmostOffset<t)ba++;ca|=ma==y;la.alreadyPlacedPromoted=ca;});function da(la,ma,na){var oa={};for(var pa=0;pa<ma;pa++){var qa=la[pa];if(!qa.alreadyPlacedPromoted&&pa==ma-1){oa[na]=true;}else oa[qa.id]=true;}return oa;}var ea=da(x,ba,s.promoted),fa=da(x,ba-1,s.promoted),ga=null;for(var ha in ea)if(!fa[ha])ga=ha;var ia=x[ba-1],ja=ia?ia.leftmostOffset:0,ka=Infinity;if(ba<x.length)ka=x[ba].leftmostOffset;return {nextToHide:ga,tabsToShow:ea,usedWidth:ja,widthToShowNext:ka};}});e.exports=r;});
__d("MercuryStateCheck",["Arbiter","ChannelConstants","MercuryConstants","MercuryFolders","MercuryServerRequests","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryConstants'),j=b('MercuryFolders'),k=b('MercuryServerRequests'),l=b('URI'),m=b('copyProperties'),n=m(new g(),{initialize:function(){g.subscribe(h.ON_INVALID_HISTORY,o);d(['ChannelConnection'],function(p){p.subscribe(p.CONNECTED,function(q,r){if(!r.init)o();});});}});function o(){var p;if(l.getRequestURI().getPath().search(/messages/)!==-1){p=j.getSupportedFolders();}else p=[i.MessagingTag.INBOX];k.fetchMissedMessages(p);}n.initialize();e.exports=n;});