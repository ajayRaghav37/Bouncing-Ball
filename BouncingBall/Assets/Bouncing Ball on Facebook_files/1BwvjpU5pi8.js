/*1352798847,178142517*/

if (self.CavalryLogger) { CavalryLogger.start_js(["RehkB"]); }

__d("MenuXSeparator",["Class","copyProperties","CSS","DOM","MenuXItemInterface"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('MenuXItemInterface');function l(m){this.parent.construct(this,m);this._data=m;}g.extend(l,k);h(l.prototype,{render:function(){var m='uiMenuXSeparator';if(this._data.className)m+=' '+this._data.className;return j.create('li',{className:m,role:'separator'});}});e.exports=l;});
__d("legacy:DocRPC",["DocRPC"],function(a,b,c,d){a.DocRPC=b('DocRPC');},3);
function PaymentsFlowsBase(a){this.context_id=a;DocRPC.publish(this,'paymentFlowAPI');}copyProperties(PaymentsFlowsBase.prototype,{DIALOG_ENDPOINT:'/fbml/ajax/dialog/',ASYNC_ENDPOINT:'/ajax/flows/',oscifPrices:{},methodConfigs:{},itemUpdateNeeded:false,context_id:null,anySelectedMethod:{},useIconRendering:false,logActivity:function(a){Banzai.post('payments',a,Banzai.VITAL);},onPurchaseSubmit:function(a,b){this.disableButton(this.ADD_CREDITS_BUTTON);if(!a)a=this.getPaymentMethod();Arbiter.inform("GiftCredits.SHOW_CANCEL_SURVEY");var c=this.methodConfigs[a];if(c&&c.open_popup){if(!b.add_num_credits)b.add_num_credits=this.getAddNumCredits();this.openPopup(c,b);return false;}var d=this.getPricepointDropdown(a),e={};if(d)e.provider_add_num_credits=d.value;this.submitDialogRequest(e);return false;},forceFlowStep:function(a,b){b=b?b:{};b.force_flow_step=a;this.submitDialogRequest(b);return false;},updatePricepoints:function(){var a=this.getFormData(),b=function(c){DOM.setContent(ge(PaymentsFlows.BANK_PRICEPOINTS),c.getPayload());};if(!a.currency)return;this.submitAsyncRequest({currency:a.currency,update_pricepoints:1},b);},updateItem:function(){var a=function(c){DOM.setContent(ge(PaymentsFlows.ITEM_ID),c.getPayload());},b=this.getPaymentMethod();this.submitAsyncRequest({payment_method:b,amount:this.getAddNumCredits(),country_update:this.getCountryUpdate(b),update_item:1},a);},oscifUpdateMobileCountry:function(){var a=function(d){var e=d.getPayload();if(e){var f=e.item_update,g=e.dropdowns_update,h=e.mobile_input_update,i=e.is_price_only?ge(PaymentsFlows.ITEM_PRICE_ID):ge(PaymentsFlows.ITEM_ID);i&&DOM.setContent(i,f);var j=ge(PaymentsFlows.MOBILE_DROPDOWN_CONTAINER);j&&DOM.replace(j,g);var k=ge(PaymentsFlows.MOBILE_INPUT_CONTAINER);k&&DOM.replace(k,h);}},b=this.getPaymentMethod(),c=this.getCountryUpdate(b);this.submitAsyncRequest({payment_method:b,amount:this.getAddNumCredits(),country_update:c,update_item_and_dropdowns:1},a);},onUpdatePaymentMethod:function(a,b){this.anySelectedMethod[a]=1;for(var c in this.anySelectedMethod){var d=this.getDropdownContainer(c);d&&CSS.conditionShow(d,a==c);var e=ge(PaymentsFlows.MOBILE_INPUT_CONTAINER);e&&CSS.conditionShow(e,a=='mobile');}var f=DOM.scry(this.getContainer(),'.selected');if(f.length>0)for(var g=0;g<f.length;g++)CSS.removeClass(f[g],'selected');if(b){this.itemUpdateNeeded&&this.updateItem(a);}else{var h=this.getContainer(),i=DOM.scry(h,'.default_pricepoint'),j=false;for(var g=0;g<i.length;g++)j=j||i[g].id.lastIndexOf(a)!=-1;i=DOM.scry(h,'.local_cur_amt');for(var k=0;k<i.length;k++)CSS.conditionShow(i[k],j);}},setPaymentMethodConfig:function(a){this.methodConfigs=a;},setOscifPriceConfig:function(a){this.oscifPrices=a;},setItemUpdateNeeded:function(a){this.itemUpdateNeeded=a;},setUseIconRendering:function(a){this.useIconRendering=a;},setPaymentMethod:function(a){this.paymentMethod=a;if(ge('payment_method_input'))ge('payment_method_input').value=a;},getPaymentMethod:function(){if(this.paymentMethod){return this.paymentMethod;}else{var a=this.getFormData();return a.payment_method;}},getAddNumCredits:function(){var a=this.getFormData();if(a.add_num_credits)return a.add_num_credits;return this.getOscifAddNumCredits();},getOscifAddNumCredits:function(){var a=this.getPaymentMethod(),b=this.getPricepointDropdown(a);if(!b){return this.oscifPrices.price;}else return parseInt(b.value,10);},getCountryUpdate:function(a){country_update=ge(a+'_country_dropdown');if(country_update)country_update=country_update.value;return country_update;},getContainer:function(){return ge('payment_body_and_buttons');},getPricepointDropdown:function(a){return ge(a+'_dropdown');},getDropdownContainer:function(a){return ge(a+'_dropdown_container');},revealFlows:function(){CSS.show('flows_content');CSS.hide('flows_show_more');if(this.useIconRendering)this.hideButton(this.ADD_CREDITS_BUTTON);this.submitAsyncRequest({change_payment_method:true});},submitAsyncRequest:function(a,b){a.context=this.getFormData().context;new AsyncRequest().setURI(this.ASYNC_ENDPOINT).setHandler(b).setData(a).send();},ADD_CREDITS_BUTTON:'add_credits',OSCIF_BALANCE_CHECKBOX:'sweep_balance',OSCIF_CHECKBOX_TOOLTIP:'checkbox-tooltip',OSCIF_PRICE_TOOLTIP:'price-tooltip',OSCIF_PRICE:'price',BANK_POPUP_BLOCK_MESSAGE:'popup_message',SECURITY_VERI_TEXT:'password_popup',SECURITY_VERI_FAILED_TEXT:'password_failed',BANK_PRICEPOINTS:'payment_pricepoints',ITEM_ID:'fbpayments_item',ITEM_PRICE_ID:'fbpayments_item_price',MOBILE_DROPDOWN_CONTAINER:'mobile_dropdown_container',MOBILE_INPUT_CONTAINER:'mobile_input_container',BOOST_PRICE:'boost_price',BOOST_BUTTON:'boost',SYNC_BUTTON:'sync_card',openPopup:function(a,b){},processPopup:function(a){},processIFrame:function(a){},getFormData:function(){},submitDialogRequest:function(a){},enableButton:function(a){},disableButton:function(a){},showButton:function(a){},hideButton:function(a){},changeButtonText:function(a,b){},showSecurityVeriFailed:function(){ge(this.SECURITY_VERI_TEXT)&&CSS.hide(this.SECURITY_VERI_TEXT);ge(this.SECURITY_VERI_FAILED_TEXT)&&CSS.show(this.SECURITY_VERI_FAILED_TEXT);},iFrameTimerId:0,iFrameTimeout:5000,checkPayThreshold:10,checkPayInterval:2000,checkPayCount:0,checkPaymentStatus:function(){var a=function(){ge('checking_payment_status')&&CSS.show('checking_payment_status');var c=PaymentsFlows.checkPayCount>=PaymentsFlows.checkPayThreshold,d={force_async_notify:+c,payment_provider_completed:1,check_pay_count:PaymentsFlows.checkPayCount};if(c){PaymentsFlows.checkPayCount=0;PaymentsFlows.submitDialogRequest(d,'checkPayment');}else PaymentsFlows.submitAsyncRequest(d,b);},b=function(c){var d=c.getPayload();ge('checking_payment_status')&&CSS.hide('checking_payment_status');PaymentsFlows.checkPayCount++;if(d.awaiting_payment){ge('payment_progress_bar')&&DOM.setContent($('payment_progress_bar'),d.progress_bar);setTimeout(a,PaymentsFlows.checkPayInterval);}else{PaymentsFlows.checkPayCount=0;new Dialog().setTitle(d.title).setBody(d.body).setButtons(d.buttons).setWideDialog(true).show();}};setTimeout(a,this.checkPayInterval);},iFrameInit:function(a){if(a){var b=function(){c.unsubscribe();clearTimeout(PaymentsFlows.iFrameTimerId);},c=Arbiter.subscribe('Connect.Unsafe.PAYMENT_PROVIDER_INIT',b.bind(this)),d=function(){b();var e={payment_provider_error:1,payment_provider_ec:1,payment_provider_msg:'Provider timed out'};PaymentsFlows.forceFlowStep('WalletFlow',e);};d.defer(this.iFrameTimeout);}}});
function PaymentsFlowsAsync(a){this.parent.construct(this,a);}Class.extend(PaymentsFlowsAsync,'PaymentsFlowsBase');copyProperties(PaymentsFlowsAsync.prototype,{forceFlowStep:function(a,b){this.closePopup();return this.parent.forceFlowStep(a,b);},popup:null,pollingInterval:100,popupTimerId:0,_setupPopupOpenChecks:function(a,b){this.popupTimerId=setInterval(function(){if(!a())this.onPopupClose(b);}.bind(this),this.pollingInterval);if(!a()){this.showBlockedPopupMessage();this.enableButton(b);}else this.hideBlockedPopupMessage();},_showPopup:function(a,b){var c=800,d=550,e=1,f=1,g=1;if(b!=null)if(b.is_paypal_digital_goods_flow){c=420;d=550;e=0;f=0;g=0;}else if(b.is_paypal){c=955;d=750;}else if(b.is_promotion){c=550;d=800;}var h=0,i=0;if(window.screenLeft){h=window.screenLeft;i=window.screenTop;}else if(window.screenX){h=window.screenX;i=window.screenY;}var j=Vector2.getViewportDimensions().x,k=Vector2.getViewportDimensions().y;h=h+(j-c)/2;i=i+(k-d)/2;this.popup=window.open(a.toString(),'CreditsFlowPopupWindow','location=yes,'+'top='+i+','+'left='+h+','+'width='+c+','+'height='+d+','+'resizable='+e+','+'toolbar='+f+','+'menubar='+g+','+'scrollbars=yes',true);},openPopup:function(a,b){var c;if(b.is_sync_flow){uri=URI("/giftcredits/index.php");uri.setDomain(URI.getRequestURI().getDomain());uri.setProtocol('https');uri.addQueryData(uri.addQueryData({context_id:b.context_id}));uri.addQueryData({is_redirect_secure:URI.getRequestURI().isSecure()});c=this.SYNC_BUTTON;this.disableButton(c);}else{var d=a.popup_url;uri=URI(d);if(!a.use_payment_engine){uri.addQueryData(b);uri.addQueryData({use_payment_engine:a.use_payment_engine});}c=this.ADD_CREDITS_BUTTON;}this._showPopup(uri,a);this._setupPopupOpenChecks(function(){return this.popup&&(!this.popup.closed);}.bind(this),c);return false;},onPopupClose:function(a){if(this.popupTimerId!==0){clearInterval(this.popupTimerId);this.popupTimerId=0;}this.enableButton(a);},closePopup:function(a){this.onPopupClose(this.ADD_CREDITS_BUTTON);if(this.popup){this.popup.close();if(!this.popup.closed){var b=new URI('/payments/message.php');if(!a)b.addQueryData('cancel',1);this.popup.location=b.toString();}this.popup=null;}},processGiftcardIFrame:function(a){if(a.gc_result_code==="0"&&a.gc_fwd_url){window.goURI(a.gc_fwd_url);return false;}return true;},processIFrame:function(a){if(!this.processGiftcardIFrame(a))return;this.closePopup(!a.cancel);this.enableButton(this.ADD_CREDITS_BUTTON);if(!a.cancel){if(a.change_method){this.forceFlowStep('WalletFlow');}else this.submitDialogRequest(a);}else{if(a.cancel_dialog){this.submitDialogRequest({cancel:'cancel'});return false;}this.showSecurityVeriFailed();}},processPopup:function(a){if(!a.cancel&&a.context_id!=this.context_id)return;this.processIFrame(a);},getFormData:function(){var a=Dialog.getCurrent();return a.getFormData();},submitDialogRequest:function(a){var b=Dialog.getCurrent(),c=b.getBody();Form.createHiddenInputs(a,c);b._submitForm('POST',this.DIALOG_ENDPOINT);},getButtonElem:function(a){var b=Dialog.getCurrent();return b.getButtonElement(a);},enableButton:function(a){var b=this.getButtonElem(a);b&&Button.setEnabled(b,true);},disableButton:function(a){var b=this.getButtonElem(a);b&&Button.setEnabled(b,false);},showButton:function(a){var b=this.getButtonElem(a);b&&CSS.show(DOM.find(b,'^.uiButton'));},hideButton:function(a){var b=this.getButtonElem(a);b&&CSS.hide(DOM.find(b,'^.uiButton'));},changeButtonText:function(a,b){var c=Dialog.getCurrent(),d=c.getButtonElement(a);d&&Button.setLabel(d,b);},showBlockedPopupMessage:function(){var a=ge(this.BANK_POPUP_BLOCK_MESSAGE);if(a)CSS.show(a);},hideBlockedPopupMessage:function(){var a=ge(this.BANK_POPUP_BLOCK_MESSAGE);if(a)CSS.hide(a);}});
GiftCredits={dialog:null,callback:null,purchaseLock:false,purchaseLockExpiryThreshold:5000,purchaseLockTimeoutId:null,cancelSurveyId:null,cancelSurveyShow:false,promoAppId:null,getPurchaseCreditPrompt:function(a,b,c,d){GiftCredits.main(a,null,null,null,c,null,null,null,'BuyCredits',{},d);},redeemGiftcard:function(a,b){GiftCredits.main(a,null,null,document.location.toString(),null,null,null,null,'RedeemGiftcard',{},b);},getPrompt:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){GiftCredits.main(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q);},main:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(GiftCredits.isPurchaseLocked())return false;GiftCredits.setPurchaseLock(true);var r={_path:'pay',method:'pay',display:'async',app_id:a,receiver:b,api_key:g,credits_purchase:n,action:i,next:d,dev_purchase_params:JSON.stringify(j),additional_params:JSON.stringify(k),order_info:JSON.stringify(c),product:l,package_id:m,canvas_url_path:document.location.pathname,request_id:o,sdk:p,quantity:q},s=new AsyncRequest().setURI('/fbml/ajax/dialog/').setData(r).setMethod('GET').setReadOnly(true).setStatusElement('commerce_get_more_loading');GiftCredits.callback=e;GiftCredits.dialog=new Dialog().setAsync(s).setModal(true).setCancelHandler(GiftCredits.onCancel).setCloseHandler(function(t){GiftCredits.setPurchaseLock(false);e(t);}).show();},onCancel:function(a){var b=Dialog.getCurrent();if(b&&!(b.getButtonElement(Dialog.CANCEL)||a))return false;GiftCredits.setPurchaseLock(false);if(GiftCredits.callback){var c={error_code:1383010,error_message:'User canceled the order.'};GiftCredits.callback({response:JSON.stringify(c)});}if(a)GiftCredits.dialog.hide();if(GiftCredits.cancelSurveyId&&GiftCredits.cancelSurveyShow){var d=new AsyncRequest("/survey/surveyDialog").setData({survey_id:GiftCredits.cancelSurveyId});new Dialog().setAsync(d).show();}else if(GiftCredits.promoAppId){var e=URI('/payments/promotion/').setSubdomain('www').setQueryData({app_id:GiftCredits.promoAppId,placement:'cancel_button',package_name:'zero_promo'});new PaymentsFlowsAsync(0)._showPopup(e,{is_promotion:true});}},setCancelSurveyShow:function(a){GiftCredits.cancelSurveyShow=a;},isPurchaseLocked:function(){return GiftCredits.purchaseLock;},setPurchaseLock:function(a){GiftCredits.purchaseLock=a;if(a){GiftCredits.purchaseLockTimeoutId=setTimeout(function(){GiftCredits.setPurchaseLock(false);},GiftCredits.purchaseLockExpiryThreshold);}else clearTimeout(GiftCredits.purchaseLockTimeoutId);return true;}};function triggerCreditsPromptFromXd(a,b){callback=function(c){var d=URI('?'+URI(b.channel).getFragment()).getQueryData(),e=URI(d.origin),f=e.getDomain()+(e.getPort()?':'+e.getPort():'');d.response=c.response;XdArbiter.send(d,null,[f]);};GiftCredits.getPrompt(b.app_id,b.receiver,b.order_info,b.back_url,callback,null,null,null,b.action,b.dev_purchase_params,b.additional_params,b.product,b.subscription_id,b.credits_purchase,b.request_id,b.sdk,b.quantity);}onloadRegister_DEPRECATED(function(){Arbiter.subscribe('Connect.Unsafe.Pay.Prompt',triggerCreditsPromptFromXd);});
__d("FavIcon",["DOM"],function(a,b,c,d,e,f){var g=b('DOM'),h;function i(){if(g.contains(document.head,"link")){var k=g.scry(document.head,"link");k.forEach(function(l){if(l.rel.indexOf('icon')!=-1||l.rel.indexOf('shortcut icon')!=-1)g.remove(l);});}}var j={set:function(k){if(h)g.remove(h);i();h=g.create('link',{type:'image/x-icon',rel:'icon',href:k});g.appendContent(g.find(document,'head'),h);}};e.exports=j;});
__d("PlatformCanvasController",["PlatformAppController","DOMEventListener","URI","CSS","DOM","DocumentTitle","FavIcon","HTML","ge","tx","startsWith","AsyncRequest","UserActivity","UIPagelet","PageTransitions"],function(a,b,c,d,e,f){var g=b('PlatformAppController'),h=b('DOMEventListener'),i=b('URI'),j=b('CSS'),k=b('DOM'),l=b('DocumentTitle'),m=b('FavIcon'),n=b('HTML'),o=b('ge'),p=b('tx'),q=b('startsWith'),r=b('AsyncRequest'),s=b('UserActivity'),t=b('UIPagelet'),u=b('PageTransitions'),v='iframe_canvas',w=240000,x=5000,y,z,aa,ba,ca;function da(la){var ma=o('pagelet_canvas_content');j.hide(ma);k.scry(ma,'iframe').forEach(function(na){na.src='';});k.setContent(o('canvas_throbber_text'),p._("Loading {app-name}",{'app-name':la}));}function ea(la,ma,na,oa,pa){var qa=o('pagelet_canvas_footer_content'),ra=o('pagelet_canvas_content'),sa=o('pagelet_canvas_ip_banner_content');k.setContent(ra,la);k.setContent(qa,ma);k.setContent(sa,pa);j.show(ra);l.set(na);m.set(oa);}function fa(la){if(la.getSubdomain()!='apps')return false;var ma,na=k.scry(document,'a[data-appname]');for(var oa=0;oa<na.length;oa++)if(na[oa].href==la){ma=na[oa].getAttribute('data-appname');break;}if(!ma)return false;da(ma);var pa=la.getPath().split('/')[1];if(o('pagelet_canvas_storybox'))new r().setURI(new i('/ajax/canvas/storybox')).setData({fb_app_name:pa}).setMethod('GET').setReadOnly(true).send();var qa=la.getUnqualifiedURI();new r().setURI(new i('/ajax/canvas.php')).setData({fb_app_name:pa,uri:qa.toString()}).setMethod('GET').setReadOnly(true).setStatusElement('canvas_throbber').setHandler(function(ra){var sa=ra.getPayload();j.conditionClass(document.body,'center_fixed_width_app',!sa.is_liquid);ea(sa.main_html,sa.footer_html,sa.page_title,sa.favicon,sa.start_now_banner_markup);u.transitionComplete();}).send();return true;}function ga(la){if(!q(la.getPath(),'/'+aa+'/')&&!q(la.getPath(),'/'+z+'/'))return false;la=la.getUnqualifiedURI();la.setPath('/'+la.getPath().split('/').slice(2).join('/'));return g.handleNavigation(la.toString());}function ha(la){return ga(la)||fa(la);}function ia(){var la=Date.now();if((y>0)&&(la-ba>=w)){ba=la;t.loadFromEndpoint('WebEgoPane','pagelet_ego_pane',{pid:9,data:[z,++ca]},{bundle:false});}}s.subscribe(function(){var la=Date.now();if(la-ba>=w-x)setTimeout(ia,x);});function ja(la,ma,na,oa){y=na;ba=Date.now();ca=0;if(z&&z!==la)ia();z=la;aa=ma;var pa=o(v);if(pa){g.setActiveIframe(o(v));h.add(pa,'load',function(){g.setNavigationEnabled(false);});}g.setInformAppOnLayerChange(!oa);g.setNavigationEnabled(false);u.registerHandler(ha);}var ka={setup:ja};e.exports=ka;});
__d("CanvasActivityLogger",["clickRefAction","userAction","event-extensions"],function(a,b,c,d,e,f){var g=b('clickRefAction'),h=b('userAction');b('event-extensions');var i={track:function(j){function k(l){g('canvas',j,l,'FORCE').set_namespace('canvas');h('canvas',j,l).uai();}Event.listen(j,'mouseover',k);Event.listen(j,'mouseout',k);}};e.exports=i;});
__d("CanvasResizer",["createArrayFrom","CSS","DOMEventListener","DOMPosition"],function(a,b,c,d,e,f){var g=b('createArrayFrom'),h=b('CSS'),i=b('DOMEventListener'),j=b('DOMPosition'),k;function l(){var n,o=document.documentElement;if(window.innerHeight){n=window.innerHeight;}else if(o&&o.clientHeight){n=o.clientHeight;}else n=document.body.clientHeight;for(var p=0;p<k.length;p++){var q=k[p];if(!h.hasClass(q,'noresize')){var r=j.getElementPosition(q,'document').y,s=n-r;q.style.height=s/(k.length-p)+'px';}}}i.add(window,'resize',l);var m={smartSizingFrameAdded:function(){k=[];var n=g(document.getElementsByTagName('iframe'));n.forEach(function(o){if(h.hasClass(o,'smart_sizing_iframe')&&!h.hasClass(o,'noresize')){h.removeClass(o,'canvas_iframe_util');k.push(o);}});l();}};e.exports=m;});