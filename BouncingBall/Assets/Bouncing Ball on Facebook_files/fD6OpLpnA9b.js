/*1352695593,178142525*/

if (self.CavalryLogger) { CavalryLogger.start_js(["KsMsX"]); }

function AppUseTracker(){if(!AppUseTracker.instance)AppUseTracker.instance=this;return AppUseTracker.instance;}copyProperties(AppUseTracker.prototype,{instance:null,endpoint:'/ajax/apps/usage_update.php',INITIAL_PING:0,ONGOING_PING:1,DISCOVERY_PING:2,ENDING_PING:3,_application_id:0,_is_game:0,_do_log_on_session_end:0,_createRequest:function(a){return new AsyncRequest().setURI(this.endpoint).setMethod('POST').setData({app:this._application_id,is_game:this._is_game,type:a,condition:this._signal_on_page_transition});},init:function(a,b,c,d,e,f){if(window!=window.top)return;this.cleanup();PageTransitions.registerHandler(this.catchPageTransition.bind(this));this._application_id=a;this._is_game=b;this._do_log_on_session_end=f;this._timers.push(setTimeout(function(){this._createRequest(this.INITIAL_PING).send();var g=this._createRequest(this.ONGOING_PING);this._timers.push(setInterval(g.send.bind(g),d));}.bind(this),c));if(e)this._timers.push(setTimeout(function(){this._createRequest(this.DISCOVERY_PING).send();}.bind(this),e));if(this._do_log_on_session_end)onbeforeunloadRegister(this.onBeforeUnload.bind(this));},catchPageTransition:function(a){if(this._do_log_on_session_end)this._createRequest(this.ENDING_PING).send();this.cleanup();},onBeforeUnload:function(){if(this._do_log_on_session_end)this._createRequest(this.ENDING_PING).setOption('asynchronous',false).send();this.cleanup();},cleanup:function(){if(this._timers)for(i=0;i<this._timers.length;i++)clearInterval(this._timers[i]);this._timers=[];this._do_log_on_session_end=0;}});
__d("XdArbiterBuffer",[],function(a,b,c,d,e,f){if(!a.XdArbiter)a.XdArbiter={_m:[],register:function(g){this._p=g;return (/^apps\./).test(location.hostname)?'canvas':'tab';},handleMessage:function(g){this._m.push(g);}};});
__d("CanvasIFrameLoader",["XdArbiterBuffer","$"],function(a,b,c,d,e,f){b('XdArbiterBuffer');var g=b('$'),h={loadFromForm:function(i){i.submit();}};e.exports=h;});
__d("PlatformDialog",["Arbiter","DOMEventListener"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOMEventListener'),i='platform/dialog/response',j={RESPONSE:i,cancel:function(k,l){h.add(k,'click',function(){window.location.assign(l);});},cancelAsync:function(k,l,m){k.subscribe('cancel',function(){g.inform(i,{identifier:l,response:m});});},closeWithArbiter:function(k,event,l,m,n,o,p){var q=window[k||'window'];event=event||i;var r={identifier:l,'return':m,response:n},s=o==(window.location.protocol=='https:');if(s){q.require('Arbiter').inform(event,r);}else if(q.postMessage){q.postMessage('FB_DIALOG_ARBITER:'+JSON.stringify({event:event,object:r}),'http'+(o?'s':'')+'://facebook.com');}else throw new Error('Unable to inform dialog response');p&&window.close();}};e.exports=j;});
__d("PlatformDialogClient",["Arbiter","AsyncDialog","AsyncRequest","DOMEventListener","PlatformDialog","PopupWindow","URI","guid"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('DOMEventListener'),k=b('PlatformDialog'),l=b('PopupWindow'),m=b('URI'),n=b('guid'),o=575;h.getLoadingDialog().enableModal().setWidth(o);j.add(window,'message',function(event){if((/\.facebook\.com$/).test(event.origin)&&(/^FB_DIALOG_ARBITER:/).test(event.data)){var q=JSON.parse(event.data.substr(18));g.inform(q.event,q.object);}});var p={async:function(q,r,s){s=s||function(){};var t=n();r.redirect_uri=m('/dialog/return/arbiter').addQueryData({identifier:t}).setSubdomain('www').getQualifiedURI().toString();r.method='async';var u=g.subscribe(k.RESPONSE,function(event,v){if(v.identifier==t){g.unsubscribe(u);s(v.response);}},g.SUBSCRIBE_NEW);h.send(new i('/dialog/'+q).setData(r).setMethod('GET').setReadOnly(true));},popup:function(q,r,event,s,t){r.redirect_uri=m('/dialog/return/arbiter').addQueryData({relation:'opener',event:event,'return':s,sign:t,close:true}).setSubdomain('www').getQualifiedURI().toString();r.method='popup';l.open(new m('/dialog/'+q).addData(r).toString(),210,o);}};e.exports=p;});
__d("Queue",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h={};function i(j){this._opts=g({interval:0,processor:null},j);this._queue=[];this._stopped=true;}g(i.prototype,{_dispatch:function(j){if(this._stopped||this._queue.length===0)return;if(!this._opts.processor){this._stopped=true;throw new Error('No processor available');}if(this._opts.interval){this._opts.processor.call(this,this._queue.shift());this._timeout=setTimeout(this._dispatch.bind(this),this._opts.interval);}else while(this._queue.length)this._opts.processor.call(this,this._queue.shift());},enqueue:function(j){if(this._opts.processor&&!this._stopped){this._opts.processor.call(this,j);}else this._queue.push(j);return this;},start:function(j){if(j)this._opts.processor=j;this._stopped=false;this._dispatch();return this;},dispatch:function(){this._dispatch(true);},stop:function(j){this._stopped=true;if(j)clearTimeout(this._timeout);return this;},merge:function(j,k){this._queue[k?'unshift':'push'].apply(this._queue,j._queue);j._queue=[];this._dispatch();return this;},getLength:function(){return this._queue.length;}});g(i,{get:function(j,k){var l;if(j in h){l=h[j];}else l=h[j]=new i(k);return l;},exists:function(j){return j in h;},remove:function(j){return delete h[j];}});e.exports=i;});
__d("XdArbiter",["Arbiter","QueryString","Queue"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('QueryString'),i=b('Queue'),j=/^apps\./.test(location.hostname)?'canvas':'tab',k={},l=[],m=new i(),n={setRpcHandler:function(p){m.start(p);},handleMessage:function(p,q){try{if(typeof p=='string'){if(/^FB_RPC:/.test(p)){m.enqueue([p.substring(7),{origin:q}]);return;}p=JSON.parse(p);}if(!p.method)return;if(typeof p.params=='string')p.params=JSON.parse(p.params);g.inform('Connect.Unsafe.'+p.method,p.params,g.BEHAVIOR_PERSISTENT);}catch(r){}},register:function(p,q){var r=q||j;k[r]=p;g.inform('XdArbiter.register',r,g.BEHAVIOR_PERSISTENT);this.scheduleDispatch();return r;},scheduleDispatch:function(){var p=this,q=42;function r(){var s=l.shift();if(s)p.send.apply(p,s);if(l.length)setTimeout(r,q);}setTimeout(r,q);},hasProxy:function(p){var q=p||j;return !!k[q];},send:function(p,q,r){var s=q||j;if(!k[s]){l.push([s,p,r]);return false;}if(typeof p!=='string')p=h.encode(p);k[s].proxyMessage(p,r);return true;}},o=a.XdArbiter;a.XdArbiter=n;if(o&&o._m.length){n.register(o._p);while(o._m.length)n.handleMessage(o._m.shift());}e.exports=n;});
__d("legacy:xd-arbiter",["XdArbiter"],function(a,b,c,d){var e=b('XdArbiter');},3);
__d("JSONRPC",["copyProperties","Log"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Log');function i(j){this._counter=0;this._callbacks={};this.remote={};this.local={};this._write=j;}g(i.prototype,{stub:function(j){this.remote[j]=function(){var k=Array.prototype.slice.call(arguments),l={jsonrpc:'2.0',method:j};if(typeof k[k.length-1]=='function'){l.id=++this._counter;this._callbacks[l.id]=k.pop();}l.params=k;this._write(JSON.stringify(l),{method:j});}.bind(this);},read:function(j,k){var l=JSON.parse(j),m=l.id;if(!l.method){if(!this._callbacks[m]){h.warn('Could not find callback %s',m);return;}var n=this._callbacks[m];delete this._callbacks[m];delete l.id;delete l.jsonrpc;n(l);return;}var o=this,p=this.local[l.method],q;if(m){q=function(t,u){var v={jsonrpc:'2.0',id:m};v[t]=u;setTimeout(function(){o._write(JSON.stringify(v),k);},0);};}else q=function(){};if(!p){h.error('Method "%s" has not been defined',l.method);q('error',{code:-32601,message:'Method not found',data:l.method});return;}l.params.push(q.bind(null,'result'));l.params.push(q.bind(null,'error'));try{var s=p.apply(k||null,l.params);if(typeof s!=='undefined')q('result',s);}catch(r){h.error('Invokation of RPC method %s resulted in the error: %s',l.method,r.message);q('error',{code:-32603,message:'Internal error',data:r.message});}}});e.exports=i;});
__d("ManagedError",[],function(a,b,c,d,e,f){function g(h,i){Error.prototype.constructor.call(this,h);this.message=h;this.innerError=i;}g.prototype=new Error();g.prototype.constructor=g;e.exports=g;});
__d("AssertionError",["ManagedError"],function(a,b,c,d,e,f){var g=b('ManagedError');function h(i){g.prototype.constructor.apply(this,arguments);}h.prototype=new g();h.prototype.constructor=h;e.exports=h;});
__d("Assert",["AssertionError","sprintf"],function(a,b,c,d,e,f){var g=b('AssertionError'),h=b('sprintf');function i(n,o){if(!n)throw new g(o);return n;}function j(n,o,p){var q;if(o===undefined){q='undefined';}else if(o===null){q='null';}else{var r=Object.prototype.toString.call(o);q=/\s(\w*)/.exec(r)[1].toLowerCase();}i(n.indexOf(q)!==-1,p||h('Expression is of type %s, not %s',q,n));return o;}function k(n,o,p){i(o instanceof n,p||'Expression not instance of type');return o;}function l(n,o){m['is'+n]=o;m['maybe'+n]=function(p,q){if(p!=null)o(p,q);};}var m={isInstanceOf:k,isTrue:i,type:j,define:function(n,o){n=n.substring(0,1).toUpperCase()+n.substring(1).toLowerCase();l(n,function(p,q){i(o(p),q);});}};['Array','Boolean','Date','Function','Null','Number','Object','Regexp','String','Undefined'].forEach(function(n){l(n,j.bind(null,n.toLowerCase()));});e.exports=m;});
__d("URL",["Assert","copyProperties","QueryString","Log"],function(a,b,c,d,e,f){var g=b('Assert'),h=b('copyProperties'),i=b('QueryString'),j=b('Log'),k=new RegExp('('+'(((\\w+):)?//)'+'(.*?@)?'+'([^~/?#:]+)'+'(:(\\d+))?'+')?'+'([^\\?$#]+)?'+'(\\?([^$#]+))?'+'(#([^$]+))?'),l=/[\0\\]/,m=/[^\w\-\.,;\/?:@=&%#$~+!*'\[\]()]+/g,n=/^[a-z0-9.][a-z0-9\-\.]+[a-z0-9.]$/,o=/\.facebook\.com$/;function p(q){g.isString(q,'The passed argument was of invalid type.');if(l.test(q))throw new URIError('The passed argument could not be parsed as a url.');if(this instanceof p===false)return new p(q);var r=q.replace(m,function(t){j.warn('Escaping unescaped character \\x%s from "%s"',t.charCodeAt(0).toString(16),q);return encodeURIComponent(t);}).match(k);if(!q||!r)throw new URIError('The passed argument could not be parsed as a url.');var s=!!location.hostname;this.setProtocol(r[4]||(s?location.protocol.replace(/:/,''):''));this.setDomain(r[6]||location.hostname);this.setPort(r[8]||(s&&!r[6]?location.port:''));this.setPath(r[9]||'');this.setSearch(r[11]||'');this.setFragment(r[13]||'');if(this._path.substring(0,1)!='/')this._path='/'+this._path;if(this._domain&&!n.test(decodeURIComponent(this._domain.toLowerCase()))){j.error('Invalid characters found in domain name: %s',this._domain);throw new URIError('Domain contained invalid characters.');}}h(p.prototype,{constructor:p,getProtocol:function(){return this._protocol;},setProtocol:function(q){this._protocol=q;return this;},getDomain:function(){return this._domain;},setDomain:function(q){this._domain=q;return this;},getPort:function(){return this._port;},setPort:function(q){this._port=q;return this;},getPath:function(){return this._path;},setPath:function(q){this._path=q;return this;},getSearch:function(){return this._search;},setSearch:function(q){this._search=q;return this;},getFragment:function(){return this._fragment;},setFragment:function(q){this._fragment=q;return this;},getParsedSearch:function(){return i.decode(this._search);},getParsedFragment:function(){return i.decode(this._fragment);},isFacebookURL:function(){return o.test(this._domain);},toString:function(){return (this._protocol?this._protocol+':':'')+(this._domain?'//'+this._domain:'')+(this._port?':'+this._port:'')+this._path+(this._search?'?'+this._search:'')+(this._fragment?'#'+this._fragment:'');},valueOf:function(){return this.toString();}});h(p,{getCurrent:function(){return new p(location.href);},getReferrer:function(){return document.referrer?new p(document.referrer):null;}});e.exports=p;});
__d("PlatformAppController",["Arbiter","AsyncDialog","AsyncRequest","Bootloader","CSS","Dialog","JSONRPC","PlatformDialogClient","URI","URL","Style","Vector","XdArbiter","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('Bootloader'),k=b('CSS'),l=b('Dialog'),m=b('JSONRPC'),n=b('PlatformDialogClient'),o=b('URI'),p=b('URL'),q=b('Style'),r=b('Vector'),s=b('XdArbiter'),t=b('ge'),u={test_flow:true},v,w=true,x=0,y=false,z,aa=false,ba=window._cstart,ca=0,da={},ea=new m(function(ra){s.send('FB_RPC:'+ra);});function fa(ra){var sa=parseInt(ra.x,10),ta=parseInt(ra.y,10);if(sa>=0&&ta>=0)window.scrollTo(sa,ta);}function ga(ra){var sa=t(ra.frame.replace(/_fb_https$/,''));if(sa){k.addClass(sa,'noresize');sa.style.height=ra.height+'px';}}function ha(){var ra=v,sa=0,ta=0;while(ra){sa+=parseInt(ra.offsetLeft,10);ta+=parseInt(ra.offsetTop,10);ra=ra.offsetParent;}var ua=r.getViewportDimensions(),va=r.getScrollPosition();return {clientWidth:ua.x,clientHeight:ua.y,scrollLeft:va.x,scrollTop:va.y,offsetLeft:sa,offsetTop:ta};}function ia(){var ra=(location.href.split('#')[1]||'');return decodeURIComponent(ra);}function ja(ra){location.hash=ra;}function ka(ra,sa,ta){if(u[ra.method]){n.async(ra.method,ra,sa);return;}var ua;if(ra.method=='permissions.oauth'||ra.method=='permissions.request'||ra.method=='oauth'){ra.method='permissions.request';ua='/connect/uiserver.php';if(ra.scope){ra.perms=ra.scope;delete ra.scope;}}else{ua='/fbml/ajax/dialog/'+ra.method.replace(/\./g,'_');delete ra.method;}delete ra.access_token;delete ra.next;if(!ra.redirect_uri||p(ra.redirect_uri).getDomain().toLowerCase()!==p(this.origin).getDomain().toLowerCase())ra.redirect_uri=this.origin;var va=new i().setMethod('GET').setReadOnly(true).setURI(o(ua).setQueryData(ra));new l().setAsync(va).setModal(true).setWideDialog(true).show().setCloseHandler(function(wa){sa(wa);});}function la(ra){y=ra;}function ma(ra,sa){aa=ra;z=sa;}ea.stub('navigate');function na(ra){if(y){ea.remote.navigate(ra);return true;}return false;}function oa(ra){var sa=ra.time-ba+ca;switch(ra.name){case 'StopIframeAppTtiTimer':ca=sa;return {time_delta_ms:sa,type:"tti"};case 'StartIframeAppTtiTimer':ba=ra.time;break;case 'RecordIframeAppTti':if(aa)j.loadModules(['CanvasIFrameLogger'],function(ta){ta.log(sa,ra.appId,z);});return {time_delta_ms:sa,type:"tti"};}}ea.local.setSize=ga;ea.local.getPageInfo=ha;ea.local.getHash=ia;ea.local.setHash=ja;ea.local.scrollTo=fa;ea.local.showDialog=ka;ea.local.setNavigationEnabled=la;ea.local.logTtiMessage=oa;s.setRpcHandler(function(ra){ea.read.apply(ea,ra);});ea.stub('hideFlashObjects');g.subscribe('layer_shown',function(){if(++x===1)if(w){ea.remote.hideFlashObjects();}else q.set(t('pagelet_canvas_content'),'visibility','hidden');});ea.stub('showFlashObjects');g.subscribe('layer_hidden',function(){if(--x===0){if(w){ea.remote.showFlashObjects();}else q.set(t('pagelet_canvas_content'),'visibility','');}else if(x<0)x=0;});function pa(ra){da[ra.name]=ra;var sa=t(ra.name);if(sa)v=sa;}var qa={setActiveIframe:function(ra){v=ra;},setInformAppOnLayerChange:function(ra){w=ra;},setNavigationEnabled:la,setTtiEnabled:ma,handleNavigation:na,init:pa,getFrameParams:function(ra){return da[ra];}};a.PlatformAppController=qa;e.exports=qa;});